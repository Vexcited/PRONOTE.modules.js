exports.DonneesListe_PageNotesPN=void 0;const DonneesListe_PageNotes_1=require("DonneesListe_PageNotes");const TypeNote_1=require("TypeNote");const ObjetTraduction_1=require("ObjetTraduction");const MoteurNotes_1=require("MoteurNotes");const MoteurNotesCP_1=require("MoteurNotesCP");const ObjetFenetre_1=require("ObjetFenetre");const ObjetFenetre_DocumentsEleve_1=require("ObjetFenetre_DocumentsEleve");const ObjetChaine_1=require("ObjetChaine");const Enumere_EvenementSaisieNotes_1=require("Enumere_EvenementSaisieNotes");const Enumere_EleveDansDevoir_1=require("Enumere_EleveDansDevoir");const Saisie_Notes_css_1=;const ObjetListe_1=require("ObjetListe");var EGenreCommandeMenuCtxPageNotesPN;(function(EGenreCommandeMenuCtxPageNotesPN){EGenreCommandeMenuCtxPageNotesPN["modifierCommentaireSurNote"]="modifierCommentaireSurNote";})(EGenreCommandeMenuCtxPageNotesPN||(EGenreCommandeMenuCtxPageNotesPN={}));class DonneesListe_PageNotesPN extends DonneesListe_PageNotes_1.DonneesListe_PageNotes{constructor(aDonnees,aParam){aParam.moteurNotesCP=new MoteurNotesCP_1.MoteurNotesCP(new MoteurNotes_1.MoteurNotes());super(aDonnees,aParam);} composeEleveProjetAcc(aArticle,aSurExportCSV,aPourImpression){if(this.param.optionsAffichage.afficherProjetsAccompagnement&&!aSurExportCSV&&!aPourImpression){const lHintProjetAcc=aArticle.projetsAccompagnement||'';const lAvecPiecesJointes=(!!aArticle.avecDocsProjetsAccompagnement);if(lHintProjetAcc.length>0||lAvecPiecesJointes){const lClass=['AlignementMilieuVertical','InlineBlock'];let lJSXNode=false;if(lAvecPiecesJointes){lClass.push('AvecMain');lJSXNode=(aNode) =>{$(aNode).eventValidation(() =>{if(aArticle.avecDocsProjetsAccompagnement){const lInstanceFenetre=ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_DocumentsEleve_1.ObjetFenetre_DocumentsEleve,{pere:{}});lInstanceFenetre.setDonnees(aArticle);}});};} return IE.jsx.str(IE.jsx.fragment,null,IE.jsx.str("span",{style:"float:right;"},IE.jsx.str("span",{title:lHintProjetAcc,class:lClass,"ie-node":lJSXNode,role:lJSXNode?'button':false,tabindex:lJSXNode?'-1':false},IE.jsx.str("i",{class:"icon_projet_accompagnement Texte12",role:"presentation"}))),aArticle.getLibelle(),";");}} return aArticle.getLibelle();} getTraductionMoyenneClasse(){return this.param.avecColonneClasse?(ObjetTraduction_1.GTraductions.getValeur('Notes.MoyenneGroupe')+' :'):(ObjetTraduction_1.GTraductions.getValeur('Notes.MoyenneClasse')+' :');} devoirDansPeriode(aDevoir,aEleve,aNumeroPeriode){const lMoteurNotesProduit=this.moteurNotesCP.getMoteurNotesProduit();return!!lMoteurNotesProduit&&lMoteurNotesProduit.devoirDansPeriode.call(this,aDevoir,aEleve,aNumeroPeriode);} eleveDansDevoir(aEleve,aDevoir){const lMoteurNotesProduit=this.moteurNotesCP.getMoteurNotesProduit();return!!lMoteurNotesProduit&&lMoteurNotesProduit.eleveDansDevoir.call(this,aEleve,aDevoir);} getTitrePeriodes(){const lMoteurNotesProduit=this.moteurNotesCP.getMoteurNotesProduit();return!!lMoteurNotesProduit&&lMoteurNotesProduit.getTitrePeriodes({avecSemestre:this.avecSemestre,avecTrimestre:this.avecTrimestre});} getNoteMaxDevoir(){let lValeurNoteMax;if(this.avecSaisieSuperieurAuBareme()){lValeurNoteMax=this.moteurNotesCP.getNoteMaximaleDeDevoir();} else{lValeurNoteMax=this.moteurNotesCP.getBaremeDevoirMaximal();} return new TypeNote_1.TypeNote(lValeurNoteMax);} avecSaisieSuperieurAuBareme(){return true;} avecLigneTitreBouton(){return this.avecCompetences||this.avecCommentaireSurNoteEleve;} jsxGetClassBoutonLigneTitre(aIndex){const lDevoir=this.listeDevoirs.get(aIndex);if(lDevoir){if(lDevoir.avecCommentaireSurNoteEleve&&lDevoir.evaluation){return'icon_comment_vide mix-icon_pastille_evaluation i-top';} if(lDevoir.avecCommentaireSurNoteEleve){return'icon_comment_vide i-medium';} if(lDevoir.evaluation){return'icon_pastille_evaluation i-medium';}} return'';} jsxBoutonLigneTitre(aIndex){return{event:() =>{const lDevoir=this.listeDevoirs.get(aIndex);if(lDevoir){if(lDevoir.avecCommentaireSurNoteEleve&&lDevoir.evaluation){this.surCompetences(aIndex);return false;} if(lDevoir.avecCommentaireSurNoteEleve){this.surCommentaireSurNote(aIndex);return false;} if(lDevoir.evaluation){this.surCompetences(aIndex);return false;}} return false;},getTitle:() =>{const H=[],lDevoir=this.listeDevoirs.get(aIndex);if(lDevoir){if(lDevoir.avecCommentaireSurNoteEleve&&lDevoir.evaluation){H.push(ObjetTraduction_1.GTraductions.getValeur('Notes.HintBtnAffSaisieCommentaireETNiveauAcqComp'));} else if(lDevoir.avecCommentaireSurNoteEleve){H.push(ObjetTraduction_1.GTraductions.getValeur('Notes.HintBtnAffSaisieNoteCommentaireSurnote'));} else if(lDevoir.evaluation){H.push(ObjetTraduction_1.GTraductions.getValeur('Notes.HintBtnSaisieNivAcq'));}} if(lDevoir.evaluation&&lDevoir.evaluation.listeCompetences){lDevoir.evaluation.listeCompetences.parcourir((aCompetence) =>{H.push(aCompetence.code+' : '+aCompetence.getLibelle());});return ObjetChaine_1.GChaine.enleverEntites(H.join('\n'));} return H.join('');}};} getTitreBouton(aDevoir,aIndex,aStrIeNodeEditionDevoir,aAriaLabel){return{getLibelleHtml:() =>{return[`<div ${aStrIeNodeEditionDevoir?`${aStrIeNodeEditionDevoir} aria-label="${aAriaLabel}" data-tooltip`:''} class="${Saisie_Notes_css_1.StylesSaisieNotes.devoir} ${Saisie_Notes_css_1.StylesSaisieNotes.devoirPN} AvecMain ${ObjetListe_1.ObjetListe.StyleElementInteractifTitreSansTri}">&nbsp;</div>`,(aDevoir.evaluation||aDevoir.avecCommentaireSurNoteEleve?IE.jsx.str("ie-btnicon",{"ie-model":this.jsxBoutonLigneTitre.bind(this,aIndex),"ie-class":this.jsxGetClassBoutonLigneTitre.bind(this,aIndex),class:[Saisie_Notes_css_1.StylesSaisieNotes.devoir,Saisie_Notes_css_1.StylesSaisieNotes.btnDevoirSuperpose,ObjetListe_1.ObjetListe.StyleElementInteractifTitreSansTri],"aria-haspopup":"dialog"}):'')
].join('');}};} getSuffixe(aEleveDevoir){if(aEleveDevoir&&aEleveDevoir.commentaire&&aEleveDevoir.commentaire.length&&aEleveDevoir.Note&&!aEleveDevoir.Note.estUneNoteVide()){return IE.jsx.str("i",{role:"img",class:"icon_comment_vide",style:"position:absolute; left:0px; bottom:0px;",title:`${ObjetTraduction_1.GTraductions.getValeur('Notes.remarque')}: ${aEleveDevoir.commentaire}`});} return;} surCommentaireSurNote(I){this.enEdition=false;this.param.callbackEvnt({genreEvnt:Enumere_EvenementSaisieNotes_1.EGenreEvenementSaisieNotes.CommentaireSurNote,devoir:this.listeDevoirs.get(I)});} avecMenuContextuel(aParams){const lDevoir=this.listeDevoirs.get(aParams.declarationColonne.rangColonne);let lAvecMenuCtx=false;if(lDevoir){lAvecMenuCtx=lDevoir.avecCommentaireSurNoteEleve;} return super.avecMenuContextuel(aParams)||lAvecMenuCtx;} initialisationObjetContextuel(aParams){if(!aParams.menuContextuel){return;} const lEleve=aParams.article;if(lEleve){for(const x in lEleve.dansDevoir){if(lEleve.dansDevoir[x]===Enumere_EleveDansDevoir_1.EGenreEleveDansDevoir.Non&&lEleve.listeDevoirs&&lEleve.listeDevoirs.getElementParNumero(x)&&lEleve.listeDevoirs.getElementParNumero(x).note&&lEleve.listeDevoirs.getElementParNumero(x).note.getNote()){aParams.menuContextuel.addCommande(1,ObjetTraduction_1.GTraductions.getValeur('Notes.MenuContext.SupprimerLesNotesNonComptabilises'),true);break;}}} const lDevoir=this.listeDevoirs.get(aParams.declarationColonne.rangColonne);if(lDevoir&&lDevoir.avecCommentaireSurNoteEleve&&this.avecEdition(aParams)){const lEleveDeDevoir=lDevoir.listeEleves.getElementParNumero(lEleve.getNumero());if(lEleveDeDevoir&&(lEleveDeDevoir.note&&!lEleveDeDevoir.note.estUneNoteVide())||(lEleveDeDevoir.Note&&!lEleveDeDevoir.Note.estUneNoteVide())){const lLibelleCommande=lEleveDeDevoir.commentaire&&lEleveDeDevoir.commentaire.length>0?ObjetTraduction_1.GTraductions.getValeur('Notes.ActionEditerCommentaireSurnote'):ObjetTraduction_1.GTraductions.getValeur('Notes.ActionAjouterCommentaireSurnote');aParams.menuContextuel.addCommande(EGenreCommandeMenuCtxPageNotesPN.modifierCommentaireSurNote,lLibelleCommande,true);}} if(aParams.menuContextuel.getListeLignes().count()>0){aParams.menuContextuel.setDonnees();}} evenementMenuContextuel(aParams){switch(aParams.numeroMenu){case EGenreCommandeMenuCtxPageNotesPN.modifierCommentaireSurNote:{const lDevoir=this.listeDevoirs.get(aParams.declarationColonne.rangColonne);if(lDevoir&&lDevoir.listeEleves){const lEleveDeDevoir=lDevoir.listeEleves.getElementParNumero(aParams.article.getNumero());if(lEleveDeDevoir){this.param.callbackEvnt({genreEvnt:Enumere_EvenementSaisieNotes_1.EGenreEvenementSaisieNotes.EditionCommentaireSurNote,eleveDeDevoir:lEleveDeDevoir,devoir:lDevoir});}} break;} default:super.evenementMenuContextuel(aParams);break;}}} exports.DonneesListe_PageNotesPN=DonneesListe_PageNotesPN;