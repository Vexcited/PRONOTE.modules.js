exports.TUtilitaireDocumentSignature=void 0;const ObjetTraduction_1=require("ObjetTraduction");const ObjetFenetre_1=require("ObjetFenetre");const UtilitairePartenaire_1=require("UtilitairePartenaire");const ObjetRequeteURLSignataire_1=require("ObjetRequeteURLSignataire");const Type_ThemeBouton_1=require("Type_ThemeBouton");const ObjetElement_1=require("ObjetElement");const Enumere_BoiteMessage_1=require("Enumere_BoiteMessage");const ObjetDate_1=require("ObjetDate");const TypeEtatSignatureSignataire_1=require("TypeEtatSignatureSignataire");const TypeEtatSignatureDocument_1=require("TypeEtatSignatureDocument");const Enumere_Ressource_1=require("Enumere_Ressource");const ObjetChaine_1=require("ObjetChaine");const Divers_css_1=;const Casier_module_css_1=;const TypeOrigineCreationRoleSignataire_1=require("TypeOrigineCreationRoleSignataire");const ObjetTraduction_2=require("ObjetTraduction");const MethodesObjet_1=require("MethodesObjet");const TradTypeOrigineCreationRoleSignataire=ObjetTraduction_2.TraductionsModule.getModule('TypeOrigineCreationRoleSignataire',{OCRS_Professeur:'',OCRS_Responsable:'',OCRS_Eleve:'',OCRS_ChefEtablissement:'',OCRS_ChefEntreprise:'',OCRS_MaitreDeStage:'',OCRS_Personnel:'',OCRS_ResponsableOuEleveMajeur:'',OCRS_ReferentStage:'',OCRS_ImpVisaDirecteur:'',OCRS_ImpVisaEnseignant:'',OCRS_ImpChefEtablissement:'',OCRS_ImpChefEtabAdjoint:'',OCRS_ImpCPE:'',OCRS_ImpVisaFamille:''});class TUtilitaireDocumentSignature{static getLibelleDeTypeRole(aTypeRole){switch(aTypeRole){case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_Professeur:return TradTypeOrigineCreationRoleSignataire.OCRS_Professeur;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_Responsable:return TradTypeOrigineCreationRoleSignataire.OCRS_Responsable;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_Eleve:return TradTypeOrigineCreationRoleSignataire.OCRS_Eleve;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_ChefEtablissement:return TradTypeOrigineCreationRoleSignataire.OCRS_ChefEtablissement;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_ChefEntreprise:return TradTypeOrigineCreationRoleSignataire.OCRS_ChefEntreprise;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_MaitreDeStage:return TradTypeOrigineCreationRoleSignataire.OCRS_MaitreDeStage;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_Personnel:return TradTypeOrigineCreationRoleSignataire.OCRS_Personnel;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_ResponsableOuEleveMajeur:return TradTypeOrigineCreationRoleSignataire.OCRS_ResponsableOuEleveMajeur;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_ReferentStage:return TradTypeOrigineCreationRoleSignataire.OCRS_ReferentStage;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_ImpVisaDirecteur:return TradTypeOrigineCreationRoleSignataire.OCRS_ImpVisaDirecteur;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_ImpVisaEnseignant:return TradTypeOrigineCreationRoleSignataire.OCRS_ImpVisaEnseignant;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_ImpChefEtablissement:return TradTypeOrigineCreationRoleSignataire.OCRS_ImpChefEtablissement;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_ImpChefEtabAdjoint:return TradTypeOrigineCreationRoleSignataire.OCRS_ImpChefEtabAdjoint;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_ImpCPE:return TradTypeOrigineCreationRoleSignataire.OCRS_ImpCPE;case TypeOrigineCreationRoleSignataire_1.TypeOrigineCreationRoleSignataire.OCRS_ImpVisaFamille:return TradTypeOrigineCreationRoleSignataire.OCRS_ImpVisaFamille;default:return'';}} static estASigner(aDocument){return aDocument.etatDocument===TypeEtatSignatureDocument_1.TypeEtatSignatureDocument.ESD_EnCours&&aDocument.etatSignature===TypeEtatSignatureSignataire_1.TypeEtatSignatureSignataire.ESS_MiseEnSignature;} static enCoursDeSignature(aDocument){return aDocument.etatDocument===TypeEtatSignatureDocument_1.TypeEtatSignatureDocument.ESD_EnCours&&aDocument.etatSignature===TypeEtatSignatureSignataire_1.TypeEtatSignatureSignataire.ESS_EnCours;} static aSignee(aDocument){return aDocument.etatSignature===TypeEtatSignatureSignataire_1.TypeEtatSignatureSignataire.ESS_Signee;} static documentVisualisable(aDocument){return aDocument.etatDocument===TypeEtatSignatureDocument_1.TypeEtatSignatureDocument.ESD_Finalisee||aDocument.etatDocument===TypeEtatSignatureDocument_1.TypeEtatSignatureDocument.ESD_Archivee;} static documentArchive(aDocument){return aDocument.etatDocument===TypeEtatSignatureDocument_1.TypeEtatSignatureDocument.ESD_Archivee;} static documentFinalise(aDocument){return aDocument.etatDocument===TypeEtatSignatureDocument_1.TypeEtatSignatureDocument.ESD_Finalisee;} static documentEnCours(aDocument){return aDocument.etatDocument===TypeEtatSignatureDocument_1.TypeEtatSignatureDocument.ESD_EnCours;} static isDocumentSignature(aDocument){return aDocument.getGenre()===Enumere_Ressource_1.EGenreRessource.DocumentSignature;} static composeTitreSelonEtat(aDocument){if(this.estASigner(aDocument)||this.enCoursDeSignature(aDocument)){return IE.jsx.str("span",{class:"flex-contain flex-center"},IE.jsx.str("span",null,aDocument.getLibelle()),IE.jsx.str("i",{role:"img",class:"icon_external_link p-left-l","aria-label":ObjetTraduction_1.GTraductions.getValeur('Casier.VersLienSignature')}));} else if(!this.documentArchive(aDocument)){return IE.jsx.str("span",{class:"flex-contain flex-center"},IE.jsx.str("span",null,aDocument.getLibelle()),IE.jsx.str("i",{role:"img",class:"icon_external_link p-left-l","aria-label":ObjetTraduction_1.GTraductions.getValeur('Casier.VersLienSignature')}));} if(aDocument.estUnElementInformatif){return IE.jsx.str("span",{class:Casier_module_css_1.StylesCasier.colorInformationDocumentsasigner},aDocument.getLibelle());} else{return aDocument.getLibelle();}} static composeHeaderDocumentsASigner(aPourParentEleves,aCallBack){let lJSXNode=false;if(aCallBack){lJSXNode=(aNode) =>{$(aNode).eventValidation((aEvent) =>{aCallBack();aEvent.stopPropagation();});};} return IE.jsx.str("div",{class:"a-savoir-message"},ObjetTraduction_1.GTraductions.getValeur('Casier.infoDocumentsSignes',[IE.jsx.str("a",{class:"AvecMain Lien","ie-node":lJSXNode,role:lJSXNode?'button':false},aPourParentEleves?ObjetTraduction_1.GTraductions.getValeur('documentsATelecharger.mesDocuments'):ObjetTraduction_1.GTraductions.getValeur('Casier.mesDocuments'))]));} static composeHtmlMessagePourListe(aDocument,aCallBack){const H=[];if(aDocument.estUnElementInformatif){let lJSXNode=false;if(aCallBack){lJSXNode=(aNode) =>{$(aNode).eventValidation((aEvent) =>{aCallBack();aEvent.stopPropagation();});};} H.push(IE.jsx.str("div",{class:['ie-sous-titre']},ObjetTraduction_1.GTraductions.getValeur('Casier.infoDocumentsSignes',[IE.jsx.str("span",{class:"AvecMain Lien","ie-node":lJSXNode,role:lJSXNode?'button':false},ObjetTraduction_1.GTraductions.getValeur('Casier.mesDocuments'))])));} else if(TUtilitaireDocumentSignature.estASigner(aDocument)||TUtilitaireDocumentSignature.enCoursDeSignature(aDocument)){const lLibelle=this.getLibelleDate(aDocument);if(lLibelle){H.push(IE.jsx.str("div",{class:"ie-sous-titre"},lLibelle));} if(TUtilitaireDocumentSignature.enCoursDeSignature(aDocument)){H.push(IE.jsx.str("div",{class:['ie-sous-titre','text-right']},ObjetTraduction_1.GTraductions.getValeur('Casier.enCoursDeSignature')));} else{let lLibelle=ObjetTraduction_1.GTraductions.getValeur('Casier.aSigner');if(aDocument.typeRole!==undefined){const lStrRole=this.getLibelleDeTypeRole(aDocument.typeRole);if(lStrRole){lLibelle=ObjetTraduction_1.GTraductions.getValeur('Casier.aSignerEnTantQue',[lStrRole]);}} H.push(IE.jsx.str("div",{class:['flex-contain','justify-end','flex-center','taille-m','color-red-foncee']},IE.jsx.str("span",null,lLibelle),IE.jsx.str("i",{class:"icon_justifier p-left-l",role:"presentation"})));}} else if(this.aSignee(aDocument)){const lLibelle=this.getLibelleDate(aDocument);if(lLibelle){H.push(IE.jsx.str("div",{class:"ie-sous-titre"},lLibelle));} const lNombre=aDocument.nombreTotal&&aDocument.nombreSigne?aDocument.nombreTotal-aDocument.nombreSigne:0;if(this.documentEnCours(aDocument)&&lNombre){H.push(IE.jsx.str("div",{class:['ie-sous-titre','text-right']},ObjetTraduction_1.GTraductions.getValeur('Casier.EnAttenteSignatures',[lNombre])));} else if(!this.documentArchive(aDocument)){H.push(IE.jsx.str("div",{class:['ie-sous-titre','text-right']},ObjetTraduction_1.GTraductions.getValeur('Casier.EnAttenteFinalisation')));}} else{const lLibelle=this.getLibelleDate(aDocument);if(lLibelle){H.push(IE.jsx.str("div",{class:"ie-sous-titre"},lLibelle));} if(this.documentFinalise(aDocument)){H.push(IE.jsx.str("div",{class:['ie-sous-titre','text-right']},ObjetTraduction_1.GTraductions.getValeur('Casier.EnAttenteFinalisation')));}} return H.join('');} static getLibelleEnvoie(aDocument){const cFormatDate='%J %MMM';const lLibelle=[];if(aDocument.dateEnvoi||aDocument.demandeur){if(aDocument.demandeur){lLibelle.push(ObjetTraduction_1.GTraductions.getValeur('Casier.envoyePar',[aDocument.demandeur.getLibelle()]));} if(aDocument.dateEnvoi){if(!aDocument.demandeur){lLibelle.push(ObjetTraduction_1.GTraductions.getValeur('Casier.diffuseLe',[ObjetDate_1.GDate.formatDate(aDocument.dateEnvoi,cFormatDate)]));} else{lLibelle.push(ObjetTraduction_1.GTraductions.getValeur('Le'),ObjetDate_1.GDate.formatDate(aDocument.dateEnvoi,cFormatDate));}}} return lLibelle.join(' ');} static getLibelleDate(aDocument){const cFormatDate='%J %MMM';if(this.aSignee(aDocument)){const lResult=[];const lEnvoie=this.getLibelleEnvoie(aDocument);if(lEnvoie){lResult.push(lEnvoie);} if(aDocument.dateSignature){lResult.push(ObjetTraduction_1.GTraductions.getValeur('Casier.signeLe',[ObjetDate_1.GDate.formatDate(aDocument.dateSignature,cFormatDate)]));} return lResult.join('; ');} else{return this.getLibelleEnvoie(aDocument);}} static composeHTMLDocumentASigner(aDocument){return IE.jsx.str("div",{class:"flex-contain cols"},IE.jsx.str("span",{class:['m-bottom-l',Divers_css_1.StylesDivers.bold]},ObjetTraduction_1.GTraductions.getValeur('Casier.RedirectionPourSignaturer')),IE.jsx.str("span",{class:"m-bottom-l"},ObjetTraduction_1.GTraductions.getValeur('Casier.RedirectionSignatureInfoSupp')),IE.jsx.str("span",{class:"m-bottom-l"},ObjetTraduction_1.GTraductions.getValeur('Casier.InfoPriseEnCompteSignature')));} static ouvrirFenetreInfoSignature(aInstancePere,aDocument,aCallBack){const lArrHtml=[];lArrHtml.push();ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_1.ObjetFenetre,{pere:aInstancePere,evenement:function(aGenreBouton){if(aGenreBouton===1){UtilitairePartenaire_1.TUtilitairePartenaire.ouvrirPatience();const lObj={typeAction:ObjetRequeteURLSignataire_1.TypeActionSignataire.signer,signataire:aDocument.signataire};new ObjetRequeteURLSignataire_1.ObjetRequeteURLSignataire(aInstancePere,TUtilitaireDocumentSignature.actionSurRequeteURLSignataire.bind(this,aCallBack||false)).lancerRequete(lObj);}},initialiser:aInstance =>{aInstance.setOptionsFenetre({titre:aDocument.getLibelle(),largeur:420,hauteur:200,listeBoutons:[{libelle:ObjetTraduction_1.GTraductions.getValeur('Annuler'),theme:Type_ThemeBouton_1.TypeThemeBouton.secondaire},{theme:Type_ThemeBouton_1.TypeThemeBouton.primaire,libelle:`<span class="link-icon-after">${ObjetTraduction_1.GTraductions.getValeur('Suivant')}</span>`,valider:true}]});}}).afficher(TUtilitaireDocumentSignature.composeHTMLDocumentASigner(aDocument));} static actionSurRequeteURLSignataire(aCallBack,aJSON){if(aJSON.message){UtilitairePartenaire_1.TUtilitairePartenaire.fermerPatience();GApplication.getMessage().afficher({type:Enumere_BoiteMessage_1.EGenreBoiteMessage.Information,titre:'',message:aJSON.message});} else if(aJSON.url){UtilitairePartenaire_1.TUtilitairePartenaire.ouvrirUrl(aJSON.url);if(aCallBack&&MethodesObjet_1.MethodesObjet.isFunction(aCallBack)){aCallBack();}} else{UtilitairePartenaire_1.TUtilitairePartenaire.fermerPatience();}} static eventVoirDocument(aInstancePere,aDocument){if(TUtilitaireDocumentSignature.documentVisualisable(aDocument)){this.ouvrirDocument(aInstancePere,aDocument);} else{TUtilitaireDocumentSignature.ouvrirFenetreInfoDocumentSignature(aInstancePere,aDocument);}} static ouvrirDocument(aInstancePere,aDocument){if(TUtilitaireDocumentSignature.documentArchive(aDocument)&&aDocument.archive){const lElement=new ObjetElement_1.ObjetElement(aDocument.archive.getLibelle(),aDocument.getNumero(),aDocument.archive.getGenre());const lURL=ObjetChaine_1.GChaine.creerUrlBruteLienExterne(lElement);if(lURL){window.open(lURL);}} else{TUtilitaireDocumentSignature.ouvrirLienDocument(aInstancePere,aDocument);}} static composeHTMLDocumentSigne(aInstancePere,aDocument){const cFormatDate='%J %MMM';return IE.jsx.str("div",{class:"flex-contain cols"},IE.jsx.str("span",null,ObjetTraduction_1.GTraductions.getValeur('Casier.DocumentSigneLe',[ObjetDate_1.GDate.formatDate(aDocument.dateSignature,cFormatDate)])),IE.jsx.str("span",{class:"m-bottom-l"},ObjetTraduction_1.GTraductions.getValeur('Casier.VersionDefinitiveSignatures')),IE.jsx.str("span",{class:"m-bottom-l"},ObjetTraduction_1.GTraductions.getValeur('Casier.InfosSignatures',[aDocument.nombreSigne,aDocument.nombreTotal])),IE.jsx.str("span",{class:"m-bottom-l"},IE.jsx.str("a",{"ie-node":TUtilitaireDocumentSignature.jsxNodeLien.bind(aInstancePere,aDocument),class:"link-icon-after AvecMain"},aDocument.getLibelle())));} static ouvrirFenetreInfoDocumentSignature(aInstancePere,aDocument){ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_1.ObjetFenetre,{pere:aInstancePere,initialiser:aInstance =>{aInstance.setOptionsFenetre({titre:ObjetTraduction_1.GTraductions.getValeur('Casier.DocumentSigne'),largeur:420,hauteur:200,listeBoutons:[ObjetTraduction_1.GTraductions.getValeur('Fermer')]});}}).afficher(TUtilitaireDocumentSignature.composeHTMLDocumentSigne(aInstancePere,aDocument));} static jsxNodeLien(aDocument,aNode){$(aNode).eventValidation(() =>{TUtilitaireDocumentSignature.ouvrirLienDocument(this,aDocument);});} static ouvrirLienDocument(aInstancePere,aDocument){UtilitairePartenaire_1.TUtilitairePartenaire.ouvrirPatience();const lObj={typeAction:ObjetRequeteURLSignataire_1.TypeActionSignataire.voirDocument,document:aDocument};new ObjetRequeteURLSignataire_1.ObjetRequeteURLSignataire(aInstancePere,TUtilitaireDocumentSignature.actionSurRequeteURLSignataire.bind(this,false)).lancerRequete(lObj);}} exports.TUtilitaireDocumentSignature=TUtilitaireDocumentSignature;