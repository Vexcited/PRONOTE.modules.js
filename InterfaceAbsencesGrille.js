exports.InterfaceAbsencesGrille=void 0;const ObjetDroitsPN_1=require("ObjetDroitsPN");const TypeFusionTitreListe_1=require("TypeFusionTitreListe");const ObjetAbsencesGrille_1=require("ObjetAbsencesGrille");const ObjetRequeteAbsencesGrille_1=require("ObjetRequeteAbsencesGrille");const ObjetRequeteSaisieAbsencesGrille_1=require("ObjetRequeteSaisieAbsencesGrille");const ObjetFenetre_ListeMemosEleves_1=require("ObjetFenetre_ListeMemosEleves");const MethodesObjet_1=require("MethodesObjet");const ObjetChaine_1=require("ObjetChaine");const ObjetHtml_1=require("ObjetHtml");const ObjetStyle_1=require("ObjetStyle");const Enumere_Action_1=require("Enumere_Action");const Enumere_BoiteMessage_1=require("Enumere_BoiteMessage");const Enumere_EvenementListe_1=require("Enumere_EvenementListe");const Enumere_EvenementObjetSaisie_1=require("Enumere_EvenementObjetSaisie");const Enumere_StructureAffichage_1=require("Enumere_StructureAffichage");const ObjetCalendrier_1=require("ObjetCalendrier");const ObjetDate_1=require("ObjetDate");const ObjetFenetre_1=require("ObjetFenetre");const ObjetFenetre_Liste_1=require("ObjetFenetre_Liste");const ObjetGrilleGabarit_1=require("ObjetGrilleGabarit");const ObjetIdentite_1=require("ObjetIdentite");const ObjetListe_1=require("ObjetListe");const ObjetElement_1=require("ObjetElement");const ObjetListeElements_1=require("ObjetListeElements");const ObjetMenuContextuel_1=require("ObjetMenuContextuel");const ObjetTraduction_1=require("ObjetTraduction");const ObjetTri_1=require("ObjetTri");const TypeDomaine_1=require("TypeDomaine");const DonneesListe_AbsencesGrille_1=require("DonneesListe_AbsencesGrille");const Enumere_Ressource_1=require("Enumere_Ressource");const InterfacePage_1=require("InterfacePage");const InterfacePageAvecMenusDeroulants_1=require("InterfacePageAvecMenusDeroulants");const ObjetFenetre_Infirmerie_1=require("ObjetFenetre_Infirmerie");const ObjetFenetre_SelectionMotif_1=require("ObjetFenetre_SelectionMotif");const ObjetFenetre_SuiviUnique_1=require("ObjetFenetre_SuiviUnique");const ObjetRequetePageEmploiDuTemps_1=require("ObjetRequetePageEmploiDuTemps");const DonneesListe_SelectionMotifs_1=require("DonneesListe_SelectionMotifs");const TypeHttpSaisieAbsencesGrille_1=require("TypeHttpSaisieAbsencesGrille");const TypeRessourceAbsence_1=require("TypeRessourceAbsence");const UtilitaireInitCalendrier_1=require("UtilitaireInitCalendrier");const Cache_1=require("Cache");const UtilitaireAbsencesGrille_1=require("UtilitaireAbsencesGrille");const UtilitaireBoutonBandeau_1=require("UtilitaireBoutonBandeau");const AccessApp_1=require("AccessApp");const GlossaireAbsencesGrille_1=require("GlossaireAbsencesGrille");const fonts_css_1=;class InterfaceAbsencesGrille extends InterfacePage_1.InterfacePage{constructor(...aParams){super(...aParams);this.appSco=(0,AccessApp_1.getApp)();this.etatUtilSco=this.appSco.getEtatUtilisateur();this.parametresSco=this.appSco.getObjetParametres();this.idMessage=this.Nom+'_message';this.idConteneurGrille=this.Nom+'_grille';this.idConteneurListeAnnee=this.Nom+'_listeAnnee';this.idPage=this.Nom+'_page';let lInfosAffichage=this.etatUtilSco.getOnglet().absencesGrille;if(!lInfosAffichage){lInfosAffichage=this.etatUtilSco.getOnglet().absencesGrille={choixAbsence:Enumere_Ressource_1.EGenreRessource.Absence,motifAbsenceSelectionne:null,motifRetardSelectionne:null,listeAnneeVisible:false};} this.parametres={affichage:lInfosAffichage,eleve:{absencesGrille:null,joursStage:null,listeAbsences:null,titre:''},largeurListeAnnee:250};} construireInstances(){this.identTripleCombo=this.add(InterfacePageAvecMenusDeroulants_1.ObjetAffichagePageAvecMenusDeroulants,this._evenementSurDernierMenuDeroulant,(aInstance) =>{aInstance.setParametres([Enumere_Ressource_1.EGenreRessource.Classe,Enumere_Ressource_1.EGenreRessource.Eleve]);});this.IdentCalendrier=this.add(ObjetCalendrier_1.ObjetCalendrier,this._evenementSurCalendrier,this._initialiserCalendrier);this.IdentGrille=this.add(ObjetAbsencesGrille_1.ObjetAbsencesGrille,null,this._initialiserGrille);this.identListe=this.add(ObjetListe_1.ObjetListe,this._evenemnentSurListe,this._initialiserListe);this.construireFicheEleveEtFichePhoto();} setParametresGeneraux(){this.GenreStructure=Enumere_StructureAffichage_1.EStructureAffichage.Autre;this.avecBandeau=true;this.AddSurZone=[];this.AddSurZone.push(this.identTripleCombo);const lJsxHtml=() => this.parametres.eleve?this.parametres.eleve.titre:'';this.AddSurZone.push({html:IE.jsx.str("div",{"ie-html":lJsxHtml,class:"NoWrap"})});this.AddSurZone.push({separateur:true});this.AddSurZone.push({html:UtilitaireBoutonBandeau_1.UtilitaireBoutonBandeau.getHtmlBtnAfficherCoursAnnules(() =>{return{event:() =>{this.etatUtilSco.setAvecCoursAnnule(!this.etatUtilSco.getAvecCoursAnnule());this._actualiserGrille();},getSelection:() =>{return this.etatUtilSco.getAvecCoursAnnule();},getTitle:() =>{return this.etatUtilSco.getAvecCoursAnnule()?ObjetTraduction_1.GTraductions.getValeur('EDT.MasquerCoursAnnules'):ObjetTraduction_1.GTraductions.getValeur('EDT.AfficherCoursAnnules');}};},() => UtilitaireBoutonBandeau_1.UtilitaireBoutonBandeau.getClassesMixIconAfficherCoursAnnules(this.etatUtilSco.getAvecCoursAnnule()))});this.addSurZoneFicheEleve();this.addSurZonePhotoEleve();this.AddSurZone.push({html:UtilitaireBoutonBandeau_1.UtilitaireBoutonBandeau.getHtmlBtnAfficherMasquerZone(this.jsxModeleBoutonAfficherListeAnnees.bind(this))});} getPrioriteAffichageBandeauLargeur(){return[];} jsxModeleBoutonAfficherListeAnnees(){return{event:() =>{this.parametres.affichage.listeAnneeVisible=!this.parametres.affichage.listeAnneeVisible;if(this.parametres.affichage.listeAnneeVisible){this.parametres.eleve.listeAbsences=null;this._actualiserAbsences();} else{this._actualiserGrille();}},getTitle:() =>{return ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.HintAfficherListeRecapitulative');},getSelection:() =>{return!!this.parametres.affichage.listeAnneeVisible;}};} construireStructureAffichageAutre(){return IE.jsx.str(IE.jsx.fragment,null,IE.jsx.str("div",{style:"height:100%; display:none;",class:"interface_affV interface_affV_padding",id:this.idPage},IE.jsx.str("div",{id:this.getInstance(this.IdentCalendrier).getNom(),style:"width: 100%;"}),this._composeSelecteurAbsences(),IE.jsx.str("div",{id:this.idConteneurGrille,class:"interface_affV_client",style:"position:relative;"},IE.jsx.str("div",{id:this.getInstance(this.IdentGrille).getNom(),class:"AlignementHaut",style:"height:100%;"}),IE.jsx.str("div",{id:this.idConteneurListeAnnee,style:"display:none;"})),IE.jsx.str("div",{class:"AlignementHaut EspaceHaut",id:this.getInstance(this.identListe).getNom(),style:{width:'100%',height:250}})),IE.jsx.str("div",{class:"Espace",id:this.idMessage}));} _evenementAfficherMessage(AGenreMessage){this.afficherBandeau(false);ObjetHtml_1.GHtml.setDisplay(this.idPage,false);ObjetHtml_1.GHtml.setDisplay(this.idMessage,true);const LMessage=typeof(AGenreMessage)==='number'?ObjetTraduction_1.GTraductions.getValeur('Message')[AGenreMessage]:AGenreMessage;ObjetHtml_1.GHtml.setHtml(this.idMessage,this.composeMessage(LMessage));} recupererDonnees(){this.afficherPage();} afficherPage(){this.setEtatSaisie(false);} _creerColonnesListe(){const lDomaine=this.etatUtilSco.getDomaineSelectionne(),lColonnes=[{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.date,titre:[
ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.SemaineDuAu',[ObjetDate_1.GDate.formatDate(IE.Cycles.dateDebutCycle(lDomaine.getPremierePosition()),'%JJ/%MM/%AA'),ObjetDate_1.GDate.formatDate(IE.Cycles.dateFinCycle(lDomaine.getDernierePosition()),'%JJ/%MM/%AA')]),ObjetTraduction_1.GTraductions.getValeur('Date')
],taille:ObjetListe_1.ObjetListe.initColonne(100,150,450)},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.duree,titre:ObjetTraduction_1.GTraductions.getValeur('Duree'),taille:60},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.motif,titre:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.Motif'),taille:ObjetListe_1.ObjetListe.initColonne(100,100,300)},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.heuresCours,titre:{libelleHtml:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.HeureCours'),title:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.HeureCours')},taille:50},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.absenceOuverte,titre:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.AbsenceOuverte'),hint:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.AbsenceOuverte'),taille:22},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.DJBrutes,titre:[
ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.NbDemiJournee'),{libelle:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.DJBrutes'),title:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.DJBrutes')} ],taille:50},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.DJCalc,titre:[TypeFusionTitreListe_1.TypeFusionTitreListe.FusionGauche,ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.DJCalc')],hint:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.DJCalc'),taille:50},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.DJBulletin,titre:[TypeFusionTitreListe_1.TypeFusionTitreListe.FusionGauche,ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.DJBulletin')],hint:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.DJBulletin'),taille:50},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.justifie,titre:[
ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.Statuts'),{libelle:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.Justifie'),title:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.Justifie')} ],taille:50},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.horsEtab,titre:[TypeFusionTitreListe_1.TypeFusionTitreListe.FusionGauche,ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.HorsEtab')],hint:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.HorsEtab'),taille:50},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.sante,titre:[TypeFusionTitreListe_1.TypeFusionTitreListe.FusionGauche,ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.Sante')],taille:50},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.regle,titre:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.RA'),hint:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.RA'),taille:22},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.certificat,titre:{getLibelleHtml:() => IE.jsx.str("i",{class:fonts_css_1.StylesFonts.icon_piece_jointe,role:"img","aria-label":ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.Certificat')}),title:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.Certificat')},taille:20},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.matiere,titre:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.Matiere'),taille:ObjetListe_1.ObjetListe.initColonne(100,150,250)},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.accompagnateur,titre:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.Accompagnateur'),taille:ObjetListe_1.ObjetListe.initColonne(100,150,250)},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.commentaire,titre:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.Commentaire'),taille:ObjetListe_1.ObjetListe.initColonne(100,150,250)},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.publieWeb,titre:'[Image_Publie]',hint:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.PublicationEspaceParent'),taille:22},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.suivi,titre:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.Suivi'),taille:ObjetListe_1.ObjetListe.initColonne(100,170,250)} ];return lColonnes;} _initialiserListe(aListe){aListe.setOptionsListe({colonnes:this._creerColonnesListe(),ariaLabel:GlossaireAbsencesGrille_1.TradGlossaireAbsencesGrille.labelListe,scrollHorizontal:true});} _actualiserListeDomaine(){const lListe=this.getInstance(this.identListe);let lColoneesCachees=[];const lColonnesAbsences=[
DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.heuresCours,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.absenceOuverte,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.DJBrutes,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.DJCalc,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.DJBulletin,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.horsEtab,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.sante
];switch(this.parametres.affichage.choixAbsence){case Enumere_Ressource_1.EGenreRessource.Absence:lColoneesCachees=[
DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.duree,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.matiere,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.accompagnateur,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.commentaire,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.publieWeb
];break;case Enumere_Ressource_1.EGenreRessource.Retard:lColoneesCachees=[
DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.accompagnateur,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.commentaire,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.publieWeb,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.certificat
].concat(lColonnesAbsences);break;case Enumere_Ressource_1.EGenreRessource.Exclusion:lColoneesCachees=[
DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.justifie,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.regle,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.certificat,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.matiere,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.accompagnateur,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.commentaire,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.suivi
].concat(lColonnesAbsences);break;case Enumere_Ressource_1.EGenreRessource.Infirmerie:lColoneesCachees=[
DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.motif,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.justifie,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.regle,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.certificat,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.matiere,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.suivi
].concat(lColonnesAbsences);break;} if(!this.parametres.eleve.listeAbsences.avecColAbsenceOuverte){lColoneesCachees.push(DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.absenceOuverte);} if(!this.parametres.eleve.listeAbsences.avecGestionStatutAbsenceRetard){lColoneesCachees.push(DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.horsEtab,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.sante);} clearTimeout(this.parametres._timerListe);this.parametres._timerListe=setTimeout(() =>{const lSelections=lListe.getListeElementsSelection();lListe.setOptionsListe({colonnes:this._creerColonnesListe(),colonnesCachees:lColoneesCachees});if(this.parametres.eleve.listeAbsences){lListe.setDonnees(new DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille(this.parametres.eleve.listeAbsences.liste).setOptions({estSurDomaine:true,choixAbsence:this.parametres.affichage.choixAbsence,saisie:this._saisieAbsence.bind(this)}));lListe.setListeElementsSelection(lSelections);}},0);} _initialiserListeAnnee(aListe){aListe.setOptionsListe({colonnes:[{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.date,titre:ObjetTraduction_1.GTraductions.getValeur('Date'),taille:'100%'},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.motif,titre:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.Motif'),taille:70},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.regle,titre:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.RA'),hint:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.RA'),taille:22},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.absenceOuverte,titre:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.AbsenceOuverte'),hint:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.hint.AbsenceOuverte'),taille:22},{id:DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.matiere,titre:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.Matiere'),taille:50} ]});} _actualiserListeAnnee(){let lColoneesCachees=[];switch(this.parametres.affichage.choixAbsence){case Enumere_Ressource_1.EGenreRessource.Absence:lColoneesCachees=[
DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.matiere
];break;case Enumere_Ressource_1.EGenreRessource.Retard:lColoneesCachees=[
DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.matiere,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.absenceOuverte
];break;case Enumere_Ressource_1.EGenreRessource.Exclusion:lColoneesCachees=[
DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.regle,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.absenceOuverte
];break;case Enumere_Ressource_1.EGenreRessource.Infirmerie:lColoneesCachees=[
DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.motif,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.matiere,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.regle,DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.absenceOuverte
];break;} if(!this.parametres.eleve.listeAbsences.avecColAbsenceOuverte){lColoneesCachees.push(DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.absenceOuverte);} const lListe=this.listeAnnee;clearTimeout(this.parametres._timerListeAnnee);this.parametres._timerListeAnnee=setTimeout(() =>{const lSelections=lListe.getListeElementsSelection();lListe.setOptionsListe({colonnesCachees:lColoneesCachees});lListe.setDonnees(new DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille(this.parametres.eleve.listeAbsences.liste));lListe.setListeElementsSelection(lSelections);},0);} _colonneToGenreSaisie(aColonne){switch(aColonne){case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.absenceOuverte:return TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_AbsenceOuverte;case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.regle:return TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_Reglement;case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.justifie:return TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_MotifRecevable;case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.horsEtab:return TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_HorsEtab;case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.sante:return TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_Sante;case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.publieWeb:return TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_PublicationWeb;default:;} return-1;} _ouvrirFenetreSelectionMotif(aListeMotifs,aEstunRetard,aCallback){const lFenetre=ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_SelectionMotif_1.ObjetFenetre_SelectionMotif,{pere:this},{titre:aEstunRetard?ObjetTraduction_1.GTraductions.getValeur('AbsenceVS.SelectionnerUnMotifRetard'):ObjetTraduction_1.GTraductions.getValeur('AbsenceVS.SelectionnerUnMotifAbsence'),callback:function(aNumeroBouton,aMotif){if(aNumeroBouton!==1){return;} if(aCallback){aCallback(aMotif);}}});lFenetre.setDonnees(aListeMotifs,false);} _reponseAbsencesGrillePassageInfirmerie(aPassage ,aJSONReponse){if(!aJSONReponse.detailsPassage){return;} const lPassage=MethodesObjet_1.MethodesObjet.dupliquer(aPassage),lDetailsPassage=aJSONReponse.detailsPassage,lSelf=this;lPassage.Accompagnateur=lPassage.accompagnateur||new ObjetElement_1.ObjetElement();lPassage.DateDebut=lDetailsPassage.dateDebut;lPassage.DateFin=lDetailsPassage.dateFin;lPassage.estPubliee=lDetailsPassage.estPubliee;lPassage.estConfidentiel=lDetailsPassage.estConfidentiel;lDetailsPassage.listeEleves.addElement(new ObjetElement_1.ObjetElement('&lt;'+ObjetTraduction_1.GTraductions.getValeur('Aucun')+'&gt;',0));const lFenetre=ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_Infirmerie_1.ObjetFenetre_Infirmerie,{pere:lSelf,evenement:function(aNumeroBouton){if(aNumeroBouton!==1){return;} this._saisieAbsence({genreSaisie:TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_PassageInfirmerie,article:aPassage,heureDebut:lPassage.DateDebut,heureFin:lPassage.DateFin,accompagnateur:lPassage.Accompagnateur,commentaire:lPassage.commentaire,publicationWeb:lPassage.estPubliee,estConfidentiel:lPassage.estConfidentiel});},initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:ObjetTraduction_1.GTraductions.getValeur('AbsenceVS.Titre_FenetreInfirmerie'),largeur:380});}});lFenetre.setDonnees(lDetailsPassage.listeEleves,{numeroEleve:this.etatUtilSco.Navigation.getRessource(Enumere_Ressource_1.EGenreRessource.Eleve).getNumero(),borneMin:lDetailsPassage.dateMin,borneMax:lDetailsPassage.dateMax,absence:lPassage,avecEditionPublication:!lPassage.estConfidentiel,avecBoutonSupprimer:false,avecCommentaireAutorise:aJSONReponse.avecCommentaireAutorise});} _evenemnentSurListe(aParams){let lListeMotifs;switch(aParams.genreEvenement){case Enumere_EvenementListe_1.EGenreEvenementListe.Edition:switch(aParams.idColonne){case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.motif:switch(aParams.article.getGenre()){case TypeRessourceAbsence_1.TypeRessourceAbsence.TR_Exclusion:this._ouvrirFenetreMotifsExclusion((aListeMotifs) =>{this._saisieAbsence({genreSaisie:TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_Motif,article:aParams.article,listeMotifsExclusion:aListeMotifs});},aParams.article.listeMotifs);break;case TypeRessourceAbsence_1.TypeRessourceAbsence.TR_Absence:case TypeRessourceAbsence_1.TypeRessourceAbsence.TR_AbsenceRepas:case TypeRessourceAbsence_1.TypeRessourceAbsence.TR_AbsenceInternat:case TypeRessourceAbsence_1.TypeRessourceAbsence.TR_RetardInternat:case TypeRessourceAbsence_1.TypeRessourceAbsence.TR_Retard:{const lEstUnRetard=[TypeRessourceAbsence_1.TypeRessourceAbsence.TR_Retard,TypeRessourceAbsence_1.TypeRessourceAbsence.TR_RetardInternat].includes(aParams.article.getGenre());lListeMotifs=MethodesObjet_1.MethodesObjet.dupliquer(lEstUnRetard?Cache_1.GCache.listeMotifsRetards:Cache_1.GCache.listeMotifsAbsenceEleve);lListeMotifs.setTri([
ObjetTri_1.ObjetTri.init((D) =>{return!D.ssMotif;}),ObjetTri_1.ObjetTri.init('Libelle')
]);this._ouvrirFenetreSelectionMotif(lListeMotifs,lEstUnRetard,(aMotif) =>{this._saisieAbsence({genreSaisie:TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_Motif,article:aParams.article,motifModifie:aMotif});});break;} default:;} break;case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.duree:case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.accompagnateur:case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.commentaire:new ObjetRequeteAbsencesGrille_1.ObjetRequeteAbsencesGrille(this,this._reponseAbsencesGrillePassageInfirmerie.bind(this,aParams.article)).lancerRequete({eleve:this.etatUtilSco.Navigation.getRessource(Enumere_Ressource_1.EGenreRessource.Eleve),domaine:this.etatUtilSco.getDomaineSelectionne(),genreAbsence:this.parametres.affichage.choixAbsence,avecDetailPassageInfirmerie:true,passageInfirmerie:aParams.article});break;case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.absenceOuverte:this._saisieAbsence({genreSaisie:this._colonneToGenreSaisie(aParams.idColonne),absence:aParams.article,estAbsenceOuverte:aParams.article.absenceOuverte,avecConfirmationFermeture:true});break;case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.suivi:ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_SuiviUnique_1.ObjetFenetre_SuiviUnique,{pere:this,evenement:function(){this.parametres.eleve.listeAbsences=null;this._actualiserAbsences();}},{titre:ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.liste.titre.Suivi')}).setDonnees(this.etatUtilSco.Navigation.getRessource(Enumere_Ressource_1.EGenreRessource.Eleve),aParams.article);break;default:{const lGenre=this._colonneToGenreSaisie(aParams.idColonne);if(lGenre>=0){this._saisieAbsence({genreSaisie:lGenre,article:aParams.article});}}} break;case Enumere_EvenementListe_1.EGenreEvenementListe.ApresEdition:{const lArticle=aParams.article;switch(aParams.idColonne){case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.duree:if(![TypeRessourceAbsence_1.TypeRessourceAbsence.TR_Retard,TypeRessourceAbsence_1.TypeRessourceAbsence.TR_RetardInternat].includes(lArticle.getGenre())){return;} if(lArticle.editDureeModifie===lArticle.editDuree){return;} if(!MethodesObjet_1.MethodesObjet.isNumber(lArticle.editDureeModifie)||lArticle.editDureeModifie<1||lArticle.editDureeModifie>99){this.appSco.getMessage().afficher({message:ObjetTraduction_1.GTraductions.getValeur('ErreurMinMaxEntier',[1,99])});return;} this._saisieAbsence({genreSaisie:TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_Duree,article:lArticle,duree:lArticle.editDureeModifie});break;case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.DJBulletin:if(lArticle.DJBulletin_modifie===lArticle.DJBulletin||lArticle.DJBulletin_modifie===0&&!lArticle.DJBulletin){return;} if(!MethodesObjet_1.MethodesObjet.isNumber(lArticle.DJBulletin_modifie)||lArticle.DJBulletin_modifie<0||lArticle.DJBulletin_modifie>=100){this.appSco.getMessage().afficher({message:ObjetTraduction_1.GTraductions.getValeur('ErreurMinMaxEntier',[0,100])});return;} this._saisieAbsence({genreSaisie:TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_DJBulletin,article:lArticle,DJBulletin:lArticle.DJBulletin_modifie});break;default:;} break;} case Enumere_EvenementListe_1.EGenreEvenementListe.Suppression:if(aParams.listeSuppressions&&aParams.listeSuppressions.count()>0){this._saisieAbsence({genreSaisie:TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_Suppression,articles:aParams.listeSuppressions});} break;}} _evenemnentSurListeAnnee(aParametres){switch(aParametres.genreEvenement){case Enumere_EvenementListe_1.EGenreEvenementListe.Edition:switch(aParametres.idColonne){case DonneesListe_AbsencesGrille_1.DonneesListe_AbsencesGrille.colonnes.regle:this._saisieAbsence({genreSaisie:TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_Reglement,article:aParametres.article});break;} break;case Enumere_EvenementListe_1.EGenreEvenementListe.SelectionDblClick:{const lArticle=aParametres.article;if(lArticle&&lArticle.semaine){const lDomaine=new TypeDomaine_1.TypeDomaine();lDomaine.setValeur(true,lArticle.semaine);if(!lDomaine.egal(this.etatUtilSco.getDomaineSelectionne())){this.parametres.eleve.listeAbsences=null;this.getInstance(this.IdentCalendrier).setSelection(lDomaine.getPremierePosition());}} break;}}} _getListeCacheDAbsence(aGenre){switch(aGenre){case Enumere_Ressource_1.EGenreRessource.Absence:return Cache_1.GCache.listeMotifsAbsenceEleve;case Enumere_Ressource_1.EGenreRessource.Retard:return Cache_1.GCache.listeMotifsRetards;}} _getAccesseurMotifDAbsence(aGenre){switch(aGenre){case Enumere_Ressource_1.EGenreRessource.Absence:return'motifAbsenceSelectionne';case Enumere_Ressource_1.EGenreRessource.Retard:return'motifRetardSelectionne';}} _getContenuComboMotif(aLibelle,aCouleur){const H=[];H.push('<span class="InlineBlock AlignementMilieuVertical" style="width: 12px; height: 12px; '+ObjetStyle_1.GStyle.composeCouleurBordure('black')+' '+ObjetStyle_1.GStyle.composeCouleurFond(aCouleur)+'">','&nbsp;','</span>');H.push('<span class="PetitEspaceGauche AlignementMilieuVertical">',aLibelle,'</span>');return H.join('');} _selectionnerMotifAbsence(aMotif){this.parametres.affichage[this._getAccesseurMotifDAbsence(this.parametres.affichage.choixAbsence)]=aMotif;this.getInstance(this.IdentGrille).setOptions({motifAbsence:this.parametres.affichage[this._getAccesseurMotifDAbsence(this.parametres.affichage.choixAbsence)]});} avecComboMotif(aGenreRessource){return this.parametres.affichage.choixAbsence===aGenreRessource&&!!this._getListeCacheDAbsence(aGenreRessource);} jsxGetModelCombo(aLabel,aGenreRessource){const lInstance=this;return{init:function(aInstance){aInstance.setOptionsObjetSaisie({celluleAvecTexteHtml:true,longueur:200,labelWAICellule:aLabel,getContenuCellule(aElement){return{libelleHtml:lInstance._getContenuComboMotif(aElement.getLibelle(),aElement.couleur)};},getContenuElement(aLigne){return lInstance._getContenuComboMotif(aLigne.element.getLibelle(),aLigne.element.couleur);}});},getDonnees:function(aDonnees){if(!aDonnees){if(!lInstance.avecComboMotif(aGenreRessource)){return null;} const lListeModele=lInstance._getListeCacheDAbsence(lInstance.parametres.affichage.choixAbsence);if(!lListeModele){return new ObjetListeElements_1.ObjetListeElements();} const lListe=MethodesObjet_1.MethodesObjet.dupliquer(lListeModele);lListe.setTri([ObjetTri_1.ObjetTri.init((D) =>{return!D.nonConnu;}),ObjetTri_1.ObjetTri.init('Libelle')]);lListe.trier();const lAccesseur=lInstance._getAccesseurMotifDAbsence(lInstance.parametres.affichage.choixAbsence);if(!lInstance.parametres.affichage[lAccesseur]){lInstance.parametres.affichage[lAccesseur]=lListe.get(0);const lGrille=lInstance.getInstance(lInstance.IdentGrille);lGrille.setOptions({motifAbsence:lInstance.parametres.affichage[lAccesseur]});lGrille.EnAffichage=true;} return lListe;}},getIndiceSelection:function(aInstance){return aInstance.getListeElements().getIndiceParElement(lInstance.parametres.affichage[lInstance._getAccesseurMotifDAbsence(lInstance.parametres.affichage.choixAbsence)]);},event:function(aParametres,aCombo){if(aParametres.genreEvenement===Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie.selection&&aCombo.InteractionUtilisateur){lInstance._selectionnerMotifAbsence(aParametres.element);}}};} _demandeMemos(){ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_ListeMemosEleves_1.ObjetFenetre_ListeMemosEleves,{pere:this,evenement:(aNumeroBouton,aEstValorisation) =>{if(aNumeroBouton===0&&aEstValorisation){}}}).setParametresMemosEleves({estValorisation:false}).setDonnees(this.etatUtilSco.Navigation.getRessource(Enumere_Ressource_1.EGenreRessource.Eleve));} _construireGroupe(aLibelle,aContenu){const H=[];H.push('<fieldset class="Bordure" style="margin:0; padding:0;">');H.push('<legend class="Legende">',aLibelle,'</legend>');H.push('<div style="padding :2px 10px;">');H.push(aContenu);H.push('</div>');H.push('</fieldset>');return H.join('');} jsxModelRadioChoixAbsence(aGenre){return{getValue:() =>{return this.parametres.affichage.choixAbsence===aGenre;},setValue:(aValue) =>{this.parametres.affichage.choixAbsence=aGenre;const lCalendrier=this.getInstance(this.IdentCalendrier),lAvecMultiSelection=aGenre===Enumere_Ressource_1.EGenreRessource.Absence,lDomaine=this.etatUtilSco.getDomaineSelectionne();lCalendrier.setOptionsCalendrier({avecMultiSemainesContinues:lAvecMultiSelection});this.parametres.eleve.listeAbsences=null;if(!lAvecMultiSelection&&lDomaine.getNbrValeurs()>1){lCalendrier.setSelection(lDomaine.getPremierePosition());} else{this._actualiserAbsences();}},getName:() =>{return`${this.Nom}_rbChoixAbsence`;}};} _composeSelecteurAbsences(){const H=[];let lContenu;H.push('<div class="EspaceHaut EspaceBas">');H.push('<div class="InlineBlock AlignementHaut">');lContenu=[];lContenu.push(IE.jsx.str("div",{class:"InlineBlock GrandEspaceDroit AlignementMilieuVertical"},IE.jsx.str("ie-radio",{"ie-model":this.jsxModelRadioChoixAbsence.bind(this,Enumere_Ressource_1.EGenreRessource.Absence)}," ",ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.absence'))));lContenu.push(IE.jsx.str("div",{class:"InlineBlock GrandEspaceDroit AlignementMilieuVertical"},IE.jsx.str("ie-radio",{"ie-model":this.jsxModelRadioChoixAbsence.bind(this,Enumere_Ressource_1.EGenreRessource.Retard)}," ",ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.retard'))));if(this.appSco.droits.get(ObjetDroitsPN_1.TypeDroits.absences.avecSaisieExclusion)){lContenu.push(IE.jsx.str("div",{class:"InlineBlock GrandEspaceDroit AlignementMilieuVertical"},IE.jsx.str("ie-radio",{"ie-model":this.jsxModelRadioChoixAbsence.bind(this,Enumere_Ressource_1.EGenreRessource.Exclusion)}," ",ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.exclusion'))));} if(this.appSco.droits.get(ObjetDroitsPN_1.TypeDroits.fonctionnalites.gestionInfirmerie)){lContenu.push(IE.jsx.str("div",{class:"InlineBlock GrandEspaceDroit AlignementMilieuVertical"},IE.jsx.str("ie-radio",{"ie-model":this.jsxModelRadioChoixAbsence.bind(this,Enumere_Ressource_1.EGenreRessource.Infirmerie)}," ",ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.infirmerie'))));} lContenu.push(IE.jsx.str("div",{class:"InlineBlock AlignementMilieuVertical",style:"width:230px;"},IE.jsx.str("ie-combo",{"ie-model":this.jsxGetModelCombo.bind(this,ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.absence'),Enumere_Ressource_1.EGenreRessource.Absence),"ie-if":() => this.avecComboMotif(Enumere_Ressource_1.EGenreRessource.Absence)}),IE.jsx.str("ie-combo",{"ie-model":this.jsxGetModelCombo.bind(this,ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.retard'),Enumere_Ressource_1.EGenreRessource.Retard),"ie-if":() => this.avecComboMotif(Enumere_Ressource_1.EGenreRessource.Retard)})));lContenu.push(IE.jsx.str("div",{class:"InlineBlock AlignementMilieuVertical"},IE.jsx.str("div",{style:"height:25px;"},"\u00A0")));H.push(this._construireGroupe(GlossaireAbsencesGrille_1.TradGlossaireAbsencesGrille.typeSaisie,lContenu.join('')));H.push('</div>');if(this.appSco.droits.get(ObjetDroitsPN_1.TypeDroits.dossierVS.consulterMemosEleve)){const lJsxEvventMemo=() =>{this._demandeMemos();};H.push(IE.jsx.str("div",{class:"InlineBlock EspaceGauche AlignementHaut"},this._construireGroupe(ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.titreMemo'),IE.jsx.str("div",{"ie-eventvalidation":lJsxEvventMemo,tabindex:"0",role:"button","aria-haspopup":"dialog",class:"Gras AvecMain",style:"line-height: 24px;"},IE.jsx.str("i",{class:"icon_post_it_rempli InlineBlock AlignementMilieuVertical",style:"font-size:1.3em;",role:"presentation"}),IE.jsx.str("div",{class:"InlineBlock EspaceGauche AlignementMilieuVertical SouligneSurvol",style:ObjetStyle_1.GStyle.composeCouleurTexte(GCouleur.themeCouleur.foncee)},ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.afficherMemos'))))));} H.push(IE.jsx.str("div",{class:"InlineBlock GrandEspaceGauche AlignementMilieuVertical",style:"padding:23px 0 0 15px;"},IE.jsx.str("div",{class:"InlineBlock AlignementMilieuVertical Image_AppelFait"}),IE.jsx.str("div",{class:"InlineBlock AlignementMilieuVertical EspaceGauche"},ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.AppelFait'))));H.push('</div>');return H.join('');} _construireListeAnnee(){if(this.parametres.affichage.listeAnneeVisible&&this.listeAnnee){this._actualiserListeAnnee();return;} if(this.listeAnnee){this.listeAnnee.free();} this.listeAnnee=null;$('#'+this.idConteneurListeAnnee.escapeJQ()).ieHtml('').hide();if(this.parametres.affichage.listeAnneeVisible){this.listeAnnee=ObjetIdentite_1.Identite.creerInstance(ObjetListe_1.ObjetListe,{pere:this,evenement:this._evenemnentSurListeAnnee});const lJsxGetTitreListeAnnee=() =>{return ObjetChaine_1.GChaine.enleverEntites(ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.SurLAnnee')+' '+(this.parametres.eleve.listeAbsences?this.parametres.eleve.listeAbsences.titre:''));};const lHtml=IE.jsx.str(IE.jsx.fragment,null,IE.jsx.str("div",{"ie-texte":lJsxGetTitreListeAnnee,style:"position:absolute; top:5px; right:0; width:{this.parametres.largeurListeAnnee}px;"}),IE.jsx.str("div",{id:this.listeAnnee.getNom(),style:"position:absolute; top:22px; bottom:5px; right:0; width:', {this.parametres.largeurListeAnnee}px;"}));$('#'+this.idConteneurListeAnnee.escapeJQ()).show().ieHtml(lHtml);this.listeAnnee.recupererDonnees();this._initialiserListeAnnee(this.listeAnnee);this._actualiserListeAnnee();}} _initialiserCalendrier(AInstance){UtilitaireInitCalendrier_1.UtilitaireInitCalendrier.init(AInstance);} _initialiserGrille(AInstance){AInstance.setOptions({decorateurAbsences:new UtilitaireAbsencesGrille_1.TDecorateurAbsencesGrille(),avecSeparationDemiJAbsence:true});AInstance.moduleCours.setParametres({modeGrilleAbsence:true,couleurFondCours:'#AEAEAE'});} _evenementSurDernierMenuDeroulant(){ObjetHtml_1.GHtml.setDisplay(this.idMessage,false);ObjetHtml_1.GHtml.setDisplay(this.idPage,true);this.parametres.eleve={};this.surSelectionEleve();this.surResizeInterface();const lCalendrier=this.getInstance(this.IdentCalendrier);lCalendrier.surPostResize();lCalendrier.setFrequences(this.parametresSco.frequences,true);lCalendrier.setPeriodeDeConsultation(this.appSco.droits.get(ObjetDroitsPN_1.TypeDroits.cours.domaineConsultationEDT));const lDomaine=this.etatUtilSco.getDomaineSelectionne(),lAvecMultiSelection=this.parametres.affichage.choixAbsence===Enumere_Ressource_1.EGenreRessource.Absence;lCalendrier.setOptionsCalendrier({avecMultiSemainesContinues:lAvecMultiSelection});if(lAvecMultiSelection){lCalendrier.setDomaine(lDomaine);} else{lCalendrier.setSelection(lDomaine.getPremierePosition());}} _ouvrirFenetreMotifsExclusion(aCallback,aListeDejaSelectionnee){const lListeMotifsSelection=MethodesObjet_1.MethodesObjet.dupliquer(Cache_1.GCache.listeMotifsExclusion);lListeMotifsSelection.setTri([
ObjetTri_1.ObjetTri.init((D) =>{return!D.ssMotif;}),ObjetTri_1.ObjetTri.init('Libelle')
]).trier();if(aListeDejaSelectionnee){aListeDejaSelectionnee.parcourir((D) =>{const lElement=lListeMotifsSelection.getElementParNumero(D.getNumero());if(lElement){lElement.cmsActif=true;}});} const lFenetre=ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_Liste_1.ObjetFenetre_Liste,{pere:this,initialiser:false},{callback:function(aNumeroBouton){if(aNumeroBouton!==1){return;} const lListeMotifs=lListeMotifsSelection.getListeElements((aElement) =>{return aElement.cmsActif;}).setSerialisateurJSON({ignorerEtatsElements:true});if(aCallback){aCallback(lListeMotifs);}}});lFenetre.setOptionsFenetre({modeActivationBtnValider:lFenetre.modeActivationBtnValider.auMoinsUnEltSelectionne});const lParam={titres:[{estCoche:true},ObjetTraduction_1.GTraductions.getValeur('fenetreMotifs.motif'),'',ObjetTraduction_1.GTraductions.getValeur('fenetreMotifs.genre')],tailles:[20,'100%',15,120],editable:true};lFenetre.setOptionsFenetre({titre:ObjetTraduction_1.GTraductions.getValeur('fenetreMotifs.titre'),largeur:450,hauteur:400,listeBoutons:[ObjetTraduction_1.GTraductions.getValeur('Annuler'),ObjetTraduction_1.GTraductions.getValeur('Valider')]});lFenetre.paramsListe=lParam;lFenetre.initialiser();lFenetre.setDonnees(new DonneesListe_SelectionMotifs_1.DonneesListe_SelectionMotifs(lListeMotifsSelection),false);} _reponseSaisie(aDonnees ,aJSONReponse){const lInstance=this;if(aJSONReponse){if(aJSONReponse.donneesApresSaisie){this._reponseAbsencesGrille(aJSONReponse.donneesApresSaisie);return;} if(aJSONReponse.alert){this.appSco.getMessage().afficher({message:aJSONReponse.alert});this._actualiserAbsences();return;} if(aJSONReponse.confirm||aJSONReponse.confirm_continue){this.appSco.getMessage().afficher({type:Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,message:aJSONReponse.confirm||aJSONReponse.confirm_continue,callback:function(aAccepte){const lAccepte=aAccepte===Enumere_Action_1.EGenreAction.Valider;if(aJSONReponse.confirm_continue){lInstance._saisieAbsence(aDonnees,true,lAccepte);return;} if(lAccepte){lInstance._saisieAbsence(aDonnees,true);} else{lInstance._actualiserAbsences();}}});return;} if(aJSONReponse.demandeMotifsExclusion){this._ouvrirFenetreMotifsExclusion((aListeMotifs) =>{lInstance._saisieAbsence($.extend(aDonnees,{genreSaisie:TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_Grille,listeMotifsExclusion:aListeMotifs}),true);});return;}} ;this.parametres.eleve.absencesGrille=null;this.parametres.eleve.listeAbsences=null;this._actualiserAbsences();} _saisieAbsence(aDonnees,aConfirmation,aConfirmation_continue,aListeFichiersUpload){const lParametres=$.extend({genreSaisie:null,eleve:this.etatUtilSco.Navigation.getRessource(Enumere_Ressource_1.EGenreRessource.Eleve),domaine:this.etatUtilSco.getDomaineSelectionne(),genreAbsence:this.parametres.affichage.choixAbsence,avecListeAbsencesAnnee:!!this.parametres.affichage.listeAnneeVisible},aDonnees)
;if(aConfirmation){lParametres.confirmation=aConfirmation;} lParametres.confirmation_continue=aConfirmation_continue;switch(this.parametres.affichage.choixAbsence){case Enumere_Ressource_1.EGenreRessource.Absence:lParametres.motif=this.parametres.affichage[this._getAccesseurMotifDAbsence(this.parametres.affichage.choixAbsence)];break;case Enumere_Ressource_1.EGenreRessource.Retard:lParametres.motif=this.parametres.affichage[this._getAccesseurMotifDAbsence(this.parametres.affichage.choixAbsence)];break;} new ObjetRequeteSaisieAbsencesGrille_1.ObjetRequeteSaisieAbsencesGrille(this,this._reponseSaisie.bind(this,aDonnees)).addUpload({listeFichiers:aListeFichiersUpload}).lancerRequete(lParametres).catch(() =>{this._actualiserAbsences();});} _surMenuContextuelMotifAbsence(aMotif){if(!aMotif){return;} ObjetMenuContextuel_1.ObjetMenuContextuel.afficher({pere:this,evenement:() =>{this._selectionnerMotifAbsence(aMotif);this.$refreshSelf();},initCommandes:(aInstance) =>{aInstance.addCommande(0,ObjetTraduction_1.GTraductions.getValeur('grilleAbsence.SelectionnerLeMotifDeLAbsence'),aMotif.getNumero()!==this.parametres.affichage.motifAbsenceSelectionne.getNumero());}});} _callbackGabaritFin(aGrille,aParam){if(aParam.gabarit.placeDebut<0){return;} this._saisieAbsence({genreSaisie:TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_Grille,placeDebut:aGrille.getPlaceAbsence(aParam.gabarit.placeDebut,true),placeFin:aGrille.getPlaceAbsence(aParam.gabarit.placeFin,false),ajout:aParam.gabarit.ajout,genreAbsence:Enumere_Ressource_1.EGenreRessource.Absence});} _actualiserGrille(){let lGabarit=null;const lGrille=this.getInstance(this.IdentGrille);const lThis=this;lGrille.getDecorateurAbsences().setOptions({avecAbsencesDynamique:this.parametres.affichage.choixAbsence===Enumere_Ressource_1.EGenreRessource.Absence,rayureRetard:this.parametres.affichage.choixAbsence!==Enumere_Ressource_1.EGenreRessource.Retard,rayureAbsence:this.parametres.affichage.choixAbsence!==Enumere_Ressource_1.EGenreRessource.Absence,callbackAbsenceOuverte:function(aAbsence){lThis._saisieAbsence({genreSaisie:TypeHttpSaisieAbsencesGrille_1.TypeHttpSaisieAbsencesGrille.sag_AbsenceOuverte,absence:aAbsence,estAbsenceOuverte:aAbsence.absenceOuverte});}});if(this.parametres.affichage.choixAbsence===Enumere_Ressource_1.EGenreRessource.Absence){lGabarit=new ObjetGrilleGabarit_1.ObjetGrilleGabarit({avecRetaillageHoraire:false,avecDeplacement:false,gabaritMonoTranche:false,modeCreationSaisieParHoraire:true,tailleTrait:2,styleTrait:'dotted',couleurTrait:'red',zIndex:3,class:'',tailleBordureInterne:0,tailleBordureExterne:0,callbackPositionner:function(aParam){lGrille.actualisationGabarit(aParam);},callbackFinCreation:function(aParam){lThis._callbackGabaritFin(lGrille,aParam);}});} lGrille.setOptions({choixAbsence:this.parametres.affichage.choixAbsence,motifAbsence:this.parametres.affichage[this._getAccesseurMotifDAbsence(this.parametres.affichage.choixAbsence)],callbackSaisieAbsence:function(aDonnees){lThis._saisieAbsence(aDonnees);},callbackMenuContextuelMotifAbsence:this._surMenuContextuelMotifAbsence.bind(this),avecPiedTranche:(!!this.parametres.eleve.absencesGrille.avecDemiPension||!!this.parametres.eleve.absencesGrille.avecInternat)&&[Enumere_Ressource_1.EGenreRessource.Exclusion,Enumere_Ressource_1.EGenreRessource.Absence,Enumere_Ressource_1.EGenreRessource.Retard].includes(this.parametres.affichage.choixAbsence),largeurReserve:this.parametres.affichage.listeAnneeVisible?this.parametres.largeurListeAnnee:0,recreations:this.parametres.eleve.recreations||this.parametresSco.recreations});const lDomaine=this.etatUtilSco.getDomaineSelectionne();lGrille.setDonnees({numeroSemaine:lDomaine.getPremierePosition(),domaine:lDomaine.getNbrValeurs()>1?lDomaine:null,avecCoursAnnule:this.etatUtilSco.getAvecCoursAnnule(),listeCours:this.parametres.eleve.listeCours,gabarit:lGabarit,joursStage:this.parametres.eleve.joursStage});this._actualiserListeDomaine();this._construireListeAnnee();this.afficherBandeau(true);} _reponseAbsencesGrille(aDonnees){if(aDonnees.absencesGrille){this.parametres.eleve.absencesGrille=aDonnees.absencesGrille;} if(aDonnees.liste){this.parametres.eleve.listeAbsences=aDonnees.liste;} if(aDonnees.titre){this.parametres.eleve.titre=aDonnees.titre;} this.getInstance(this.IdentGrille).getDecorateurAbsences().setDonnees({absencesGrille:this.parametres.eleve.absencesGrille,domaine:this.etatUtilSco.getDomaineSelectionne()});this._actualiserGrille();} _actualiserAbsences(){new ObjetRequeteAbsencesGrille_1.ObjetRequeteAbsencesGrille(this,this._reponseAbsencesGrille).lancerRequete({eleve:this.etatUtilSco.Navigation.getRessource(Enumere_Ressource_1.EGenreRessource.Eleve),domaine:this.etatUtilSco.getDomaineSelectionne(),genreAbsence:this.parametres.affichage.choixAbsence,avecAbsencesGrille:!this.parametres.eleve.absencesGrille,avecListeAbsences:!this.parametres.eleve.listeAbsences,avecListeAbsencesAnnee:!!this.parametres.affichage.listeAnneeVisible});} _reponseEDT(aDonnees){$.extend(this.parametres.eleve,aDonnees);this._actualiserAbsences();} _evenementSurCalendrier(ASelection,aDomaine,AGenreDomaineInformation,aEstDansPeriodeConsultation,AIsToucheSelection){if(AIsToucheSelection){this.setFocusIdCourant();} else{this.setIdCourant(this.Instances[this.IdentCalendrier].IdPremierElement);this.setEtatIdCourant(false);this.etatUtilSco.setDomaineSelectionne(aDomaine);this.parametres.eleve.absencesGrille=null;this.parametres.eleve.listeAbsences=null;if(aDomaine.getNbrValeurs()!==1){this.parametres.eleve.listeCours=new ObjetListeElements_1.ObjetListeElements();this._actualiserAbsences();} else{new ObjetRequetePageEmploiDuTemps_1.ObjetRequetePageEmploiDuTemps(this,this._reponseEDT).lancerRequete({ressource:this.etatUtilSco.Navigation.getRessource(Enumere_Ressource_1.EGenreRessource.Eleve),numeroSemaine:aDomaine.getPremierePosition(),avecCoursSortiePeda:true,avecRetenuesEleve:true});}}}} exports.InterfaceAbsencesGrille=InterfaceAbsencesGrille;