exports.ObjetFenetre_EditionObservation=void 0;const ObjetCelluleDate_1=require("ObjetCelluleDate");const ObjetDate_1=require("ObjetDate");const ObjetChaine_1=require("ObjetChaine");const ObjetFenetre_1=require("ObjetFenetre");const ObjetTraduction_1=require("ObjetTraduction");const ObjetMoteurEditionObservation_1=require("ObjetMoteurEditionObservation");const ObjetMoteurAbsences_1=require("ObjetMoteurAbsences");const Enumere_Ressource_1=require("Enumere_Ressource");const ObjetFenetre_EditionObservation_css_1=;const TypeGenreObservationVS_1=require("TypeGenreObservationVS");const GestionnaireModale_1=require("GestionnaireModale");const AccessApp_1=require("AccessApp");const ObjetFenetre_Espace_css_1=;const Divers_css_1=;class ObjetFenetre_EditionObservation extends ObjetFenetre_1.ObjetFenetre{constructor(...aParams){super(...aParams);const lApplicationSco=(0,AccessApp_1.getApp)();this.parametresSco=lApplicationSco.getObjetParametres();this.moteurEdition=new ObjetMoteurEditionObservation_1.ObjetMoteurEditionObservation();this.donneesRecu=false;} construireInstances(){this.identDate=this.add(ObjetCelluleDate_1.ObjetCelluleDate,this.evenementSelecteurDate,this._initialiserSelecteurDate);} getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{fenetreBtn:{getDisabled:function(aBoutonRepeat){if(aBoutonRepeat.element.index===aInstance._getMoteurEditionObs().numBoutonValider){return!aInstance._getMoteurEditionObs().validationActif(aInstance._getMoteurEditionObs().observation.commentaire);} return false;}}});} jsxModeleTextAreaCommentaire(){return{getValue:() =>{return this.moteurEdition.observation&&this.moteurEdition.observation.commentaire?this.moteurEdition.observation.commentaire:'';},setValue:(aValue) =>{this.moteurEdition.observation.commentaire=aValue;},getDisabled:(aNode) =>{if(this.moteurEdition.disabled){aNode.placeholder='';} return this.moteurEdition.existeDateVisu||this.moteurEdition.disabled;}};} jsxIfDispenseALaMaison(){const lEstDispense=this._getMoteurEditionObs()&&this._getMoteurEditionObs().observation&&(this._getMoteurEditionObs().observation.getGenre()===Enumere_Ressource_1.EGenreRessource.Dispense);const lEstALaMaison=lEstDispense&&this._getMoteurEditionObs().observation.estEnseignementALaMaison;const lEstVS=lEstDispense&&!this._getMoteurEditionObs().observation.estSurCours;return lEstALaMaison||lEstVS;} jsxGetHtmlDispenseALaMaison(){const lHtml=[];if(this._getMoteurEditionObs()&&this._getMoteurEditionObs().observation&&(this._getMoteurEditionObs().observation.getGenre()===Enumere_Ressource_1.EGenreRessource.Dispense)&&this._getMoteurEditionObs().observation.estEnseignementALaMaison){lHtml.push(ObjetMoteurAbsences_1.ObjetMoteurAbsences.formatTraductionAbs(this._getMoteurEditionObs().observation,Enumere_Ressource_1.EGenreRessource.Dispense));} else if(this._getMoteurEditionObs()&&this._getMoteurEditionObs().observation&&(this._getMoteurEditionObs().observation.getGenre()===Enumere_Ressource_1.EGenreRessource.Dispense)&&!this._getMoteurEditionObs().observation.estSurCours){lHtml.push(ObjetTraduction_1.GTraductions.getValeur('AbsenceVS.DispenseLongue'));} return lHtml.join('');} jsxIfAvecVisibiliteDate(){return this._getMoteurEditionObs().avecDate;} jsxIfDispenseVisible(){return this._getMoteurEditionObs()&&this._getMoteurEditionObs().observation&&(this._getMoteurEditionObs().observation.getGenre()===Enumere_Ressource_1.EGenreRessource.Dispense);} jsxDisplayDocuments(){return this._getMoteurEditionObs()&&this._getMoteurEditionObs().observation&&(this._getMoteurEditionObs().observation.getGenre()===Enumere_Ressource_1.EGenreRessource.Dispense);} jsxGetHtmlDocuments(){const lHtml=[];if(this._getMoteurEditionObs()&&this._getMoteurEditionObs().observation&&(this._getMoteurEditionObs().observation.getGenre()===Enumere_Ressource_1.EGenreRessource.Dispense)&&this._getMoteurEditionObs().observation.documents){this._getMoteurEditionObs().observation.documents.parcourir((aDocument) =>{lHtml.push(ObjetChaine_1.GChaine.composerUrlLienExterne({documentJoint:aDocument,genreRessource:Enumere_Ressource_1.EGenreRessource.DocumentJoint}));});} return lHtml.join('');} jsxIfPubliable(){return this._getMoteurEditionObs().publiable;} jsxIfEstEncouragement(){return this.estEncouragement;} jsxModeleCheckboxPublie(){return{getValue:() =>{return this._getMoteurEditionObs()&&this._getMoteurEditionObs().observation&&this._getMoteurEditionObs().observation.estPubliee===true;},setValue:(aValue) =>{this._getMoteurEditionObs().observation.estPubliee=aValue;},getLibelle:() =>{const lHtml=[];lHtml.push(ObjetTraduction_1.GTraductions.getValeur('AbsenceVS.PublierParentsEleves'));return lHtml.join('');},getDisabled:() =>{return this._getMoteurEditionObs().existeDateVisu||this._getMoteurEditionObs().disabled;}};} jsxModeleCheckboxMiseEnevidence(){return{getValue:() =>{return this._getMoteurEditionObs()&&this._getMoteurEditionObs().observation&&!!this._getMoteurEditionObs().observation.dateFinMiseEnEvidence;},setValue:(aValue) =>{if(aValue){this.instanceSelecteurDateMettreEnEvidence.setActif(true);if(this._getMoteurEditionObs().dateMiseEnEvidenceOrigine){this._getMoteurEditionObs().observation.dateFinMiseEnEvidence=this._getMoteurEditionObs().dateMiseEnEvidenceOrigine;} else{let lDate=ObjetDate_1.GDate.getDateJour(null,true);lDate=ObjetDate_1.GDate.getJourSuivant(lDate,7);this._getMoteurEditionObs().observation.dateFinMiseEnEvidence=lDate;}} else{this.instanceSelecteurDateMettreEnEvidence.setActif(false);this._getMoteurEditionObs().observation.dateFinMiseEnEvidence=undefined;} this.instanceSelecteurDateMettreEnEvidence.setDonnees(this._getMoteurEditionObs().observation.dateFinMiseEnEvidence);},getDisabled:() =>{return this._getMoteurEditionObs().disabled;}};} jsxGetStyleVisibiliteMessageVisu(){return this._getMoteurEditionObs().existeDateVisu?{display:''}:{display:'none'};} jsxGetHtmlMessageVisu(){return this._getMoteurEditionObs().existeDateVisu?ObjetChaine_1.GChaine.format(ObjetTraduction_1.GTraductions.getValeur('AbsenceVS.ObservationLueWebLe'),[ObjetDate_1.GDate.formatDate(this._getMoteurEditionObs().observation.dateVisu,'%JJ/%MM/%AAAA')]):'';} jsxGetClassIconePublie(){const lObservation=this._getMoteurEditionObs().observation;return lObservation&&lObservation.estPubliee?'':' mix-icon_remove ';} jsxIdentiteDateMiseEnEvidence(){const lThis=this;return{class:ObjetCelluleDate_1.ObjetCelluleDate,pere:this,init:(aInstanceCelluleDate) =>{this.instanceSelecteurDateMettreEnEvidence=aInstanceCelluleDate;const lAvecDate=this._getMoteurEditionObs()&&this._getMoteurEditionObs().observation&&!!this._getMoteurEditionObs().observation.dateFinMiseEnEvidence;aInstanceCelluleDate.setActif(lAvecDate&&!this._getMoteurEditionObs().disabled);},start(aInstance){aInstance.setParametresFenetre(lThis.parametresSco.PremierLundi,ObjetDate_1.GDate.getDateCourante(),lThis.parametresSco.DerniereDate,null,null,null);aInstance.setOptionsFenetre({prioriteBlocageAbonnement:GestionnaireModale_1.GestionnaireModale.TypePrioriteBlocageInterface.message});aInstance.setPremiereDateSaisissable(ObjetDate_1.GDate.getDateCourante(),true);if(lThis._getMoteurEditionObs().observation.dateFinMiseEnEvidence){aInstance.setDonnees(lThis._getMoteurEditionObs().observation.dateFinMiseEnEvidence);}},evenement(aDate){lThis._getMoteurEditionObs().observation.dateFinMiseEnEvidence=aDate;}};} composeContenu(){if(!this.donneesRecu){return'';} const lMaxLength=this._getMoteurEditionObs()&&this._getMoteurEditionObs().maxlengthCommentaire?this._getMoteurEditionObs().maxlengthCommentaire:false;return IE.jsx.str(IE.jsx.fragment,null,IE.jsx.str("div",{"ie-if":this.jsxIfDispenseALaMaison.bind(this),"ie-texte":this.jsxGetHtmlDispenseALaMaison.bind(this),class:"field-contain"}),IE.jsx.str("div",{"ie-if":this.jsxIfAvecVisibiliteDate.bind(this),class:"field-contain dates-contain"},IE.jsx.str("label",{for:this.getNomInstance(this.identDate)},ObjetTraduction_1.GTraductions.getValeur('AbsenceVS.date')," :"),IE.jsx.str("div",{class:"date-wrapper",id:this.getNomInstance(this.identDate)})),IE.estMobile?IE.jsx.str("div",{class:"field-contain"},IE.jsx.str("ie-textareamax",{"aria-labelledby":this.IdTitre,maxlength:lMaxLength,"ie-compteurmax":lMaxLength,"ie-compteur":true,"ie-model":this.jsxModeleTextAreaCommentaire.bind(this),placeholder:ObjetTraduction_1.GTraductions.getValeur('AbsenceVS.saisissezUnCommentaire')})):IE.jsx.str("div",null,IE.jsx.str("ie-textareamax",{"aria-labelledby":this.IdTitre,"ie-model":this.jsxModeleTextAreaCommentaire.bind(this),style:"width:100%;height:150px;"})),IE.jsx.str("p",{"ie-if":this.jsxIfDispenseVisible.bind(this),class:"m-top"},ObjetTraduction_1.GTraductions.getValeur('AbsenceVS.dispense.commentaireDeLaDispense')),IE.jsx.str("div",{class:ObjetFenetre_EditionObservation_css_1.StylesObjetFenetre_EditionObservation.feoDocuments,"ie-display":this.jsxDisplayDocuments.bind(this),"ie-html":this.jsxGetHtmlDocuments.bind(this)}),IE.jsx.str("div",{"ie-if":this.jsxIfPubliable.bind(this),class:[ObjetFenetre_Espace_css_1.StylesObjetFenetre_Espace.publicTeam]},IE.jsx.str("span",{class:"icon-contain only-mobile"},IE.jsx.str("i",{role:"presentation",class:"icon_info_sondage_publier i-medium i-as-deco","ie-class":this.jsxGetClassIconePublie.bind(this)})),IE.jsx.str("ie-checkbox",{"ie-model":this.jsxModeleCheckboxPublie.bind(this)})),IE.jsx.str("div",{class:['m-bottom-l',Divers_css_1.StylesDivers.flexContain,Divers_css_1.StylesDivers.justifyEnd],"ie-style":this.jsxGetStyleVisibiliteMessageVisu.bind(this)},IE.jsx.str("div",{class:['color-red-moyen','semi-bold'],"ie-html":this.jsxGetHtmlMessageVisu.bind(this)})),IE.jsx.str("div",{"ie-if":this.jsxIfEstEncouragement.bind(this),class:[ObjetFenetre_Espace_css_1.StylesObjetFenetre_Espace.publicTeam,Divers_css_1.StylesDivers.flexContain]},IE.jsx.str("ie-checkbox",{"ie-model":this.jsxModeleCheckboxMiseEnevidence.bind(this)},ObjetTraduction_1.GTraductions.getValeur('AbsenceVS.MettreEnEvidenceJusquAu')),IE.jsx.str("div",{class:"m-left","ie-identite":this.jsxIdentiteDateMiseEnEvidence.bind(this)})));} setDonnees(aParam){this.donneesRecu=true;this.moteurEdition.init(aParam);this.estEncouragement=aParam.typeObservation===TypeGenreObservationVS_1.TypeGenreObservationVS.OVS_Encouragement;this.setOptionsFenetre({titre:this.moteurEdition.getTitre(),listeBoutons:this.moteurEdition.listeBoutons});this.initialiser();this.afficher(this.composeContenu());if(this.moteurEdition.avecDate){const lDateObs=this.moteurEdition.observation.date;this.getInstance(this.identDate).initialiser();this.getInstance(this.identDate).setDonnees(lDateObs?lDateObs:ObjetDate_1.GDate.getDateCourante());}} _getMoteurEditionObs(){return this.moteurEdition;} surValidation(aNumeroBouton){this.callback.appel(this.moteurEdition.surValidation(aNumeroBouton),this.moteurEdition.observation.getGenre(),this.moteurEdition.numeroObservation,aNumeroBouton===this.moteurEdition.numBoutonValider);this.fermer();} _initialiserSelecteurDate(aInstance){aInstance.setOptionsObjetCelluleDate({largeurComposant:100});} evenementSelecteurDate(aDate){if(this.moteurEdition.avecDate){this.moteurEdition.observation.date=aDate;this.moteurEdition.observation.date.setHours(0,0,0,0);}}} exports.ObjetFenetre_EditionObservation=ObjetFenetre_EditionObservation;