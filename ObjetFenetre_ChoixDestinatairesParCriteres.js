exports.ObjetFenetre_ChoixDestinatairesParCriteres=void 0;const ObjetFenetre_1=require("ObjetFenetre");const ObjetTraduction_1=require("ObjetTraduction");const GUID_1=require("GUID");const Enumere_Ressource_1=require("Enumere_Ressource");const ChoixDestinatairesParCriteres_1=require("ChoixDestinatairesParCriteres");const ChoixDestinatairesParCriteres_2=require("ChoixDestinatairesParCriteres");const Divers_css_1=;const MethodesObjet_1=require("MethodesObjet");const MoteurDestinatairesPN_1=require("MoteurDestinatairesPN");const ObjetListeElements_1=require("ObjetListeElements");const ObjetFenetre_Criteres_1=require("ObjetFenetre_Criteres");const ChoixDestinatairesParCriteres_module_css_1=;const ObjetRequeteDestinatairesParCriteres_1=require("ObjetRequeteDestinatairesParCriteres");const ObjetListe_1=require("ObjetListe");const ObjetDonneesListeFlatDesign_1=require("ObjetDonneesListeFlatDesign");const IEHtml_Bouton_css_1=;const ObjetElement_1=require("ObjetElement");const ObjetHtml_1=require("ObjetHtml");const ObjetTri_1=require("ObjetTri");class ObjetFenetre_ChoixDestinatairesParCriteres extends ObjetFenetre_1.ObjetFenetre{constructor(...aParams){super(...aParams);this.applicationSco=GApplication;this.etatUtilisateurSco=this.applicationSco.getEtatUtilisateur();this.ids={zoneCriteres:GUID_1.GUID.getId()};this.criteres=new Map();this.choixSelectionne=ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Nominatif;this.optionsFenetreChoixDestinataires=this.initOptions();this.setOptionsFenetre({listeBoutons:[ObjetTraduction_1.GTraductions.getValeur('Annuler'),ObjetTraduction_1.GTraductions.getValeur('Valider')],titre:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.ChoixDesDestinataires,largeur:490,addParametresValidation:this.addParametresValidation.bind(this)});this.moteurDestinataires=new MoteurDestinatairesPN_1.MoteurDestinatairesPN();this.textePersonnalisable={};} async setDonnees(aParams){const lParams=Object.assign({choixDisponibles:[ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Tous,ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Nominatif,ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Critere],choix:ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Nominatif,listeRessourceSelectionnee:new ObjetListeElements_1.ObjetListeElements(),listeGenresIndivAssocieAuCriteres:[(0,ChoixDestinatairesParCriteres_2.genreRessourceToTypeGenreDestinataire)(aParams.genreRessource)],genreIndivAssocieAuCriteresSelectionne:(0,ChoixDestinatairesParCriteres_2.genreRessourceToTypeGenreDestinataire)(aParams.genreRessource)},aParams);this.genreDocumentTelechargeable=lParams.genreDocumentTelechargeable;this.listeRessourceSelectionnee=lParams.listeRessourceSelectionnee;this.genreRessource=lParams.genreRessource;this.choixDisponibles=lParams.choixDisponibles;this.choixSelectionne=lParams.choix;this.listeGenresIndivAssocieAuCriteres=lParams.listeGenresIndivAssocieAuCriteres;this.genreIndivAssocieAuCriteresSelectionne=lParams.genreIndivAssocieAuCriteresSelectionne;this.criteresDispo=this.formatCriteresDispo(lParams.criteresDisponibles);this.formatCriteres(lParams.criteres);return await this.afficher(this.composeContenu());} setOptionsDestinatairesParCriteres(aOptions={}){this.optionsFenetreChoixDestinataires=Object.assign(Object.assign({},this.optionsFenetreChoixDestinataires),aOptions);return this;} setTextePersonnalisable(aTexte={}){this.textePersonnalisable=Object.assign(Object.assign({},this.textePersonnalisable),aTexte);return this;} initOptions(){return{avecBtnVisuIndividu:true,avecDestinataireObligatoire:false,forcerSansFiltreSurEleve:false,avecLibelleEnfantsDansTotalIndiv:false};} addParametresValidation(aParams){if(aParams.numeroBouton!==1){return;} return this.getResolve();} getResolve(){const lResult={choix:this.choixSelectionne};switch(this.choixSelectionne){case ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Tous:return lResult;case ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Nominatif:return Object.assign(Object.assign({},lResult),{listeRessourceSelectionnee:this.listeRessourceSelectionnee});case ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Critere:return Object.assign(Object.assign({},lResult),{criteres:this.getCriteresUpdate(),genreIndivAssocieAuCriteres:this.genreIndivAssocieAuCriteresSelectionne});}} async surValidation(ANumeroBouton){var _a;if(ANumeroBouton===1&&this.optionsFenetreChoixDestinataires.avecDestinataireObligatoire){const lVerif=ObjetFenetre_ChoixDestinatairesParCriteres.verifierChampDestinataire({choix:this.choixSelectionne,listeDestinataires:this.listeRessourceSelectionnee,listeCriteres:this.getListeCriteresDeGenre()});if(!lVerif.valide){this.applicationSco.getMessage().afficher({message:(_a=lVerif.message)!==null&&_a!==void 0?_a:''});return;}} super.surValidation(ANumeroBouton);} static verifierChampDestinataire(aParams){switch(aParams.choix){case ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Nominatif:{if(aParams.listeDestinataires.count()>0){return{valide:true};} return{valide:false,message:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.ChoisirDestinataires};} case ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Critere:{const lValide=aParams.listeCriteres.some((aParams) =>{const[lType,lInfos]=aParams;return ObjetFenetre_ChoixDestinatairesParCriteres.estCritereAvecCheckBox(lType)?lInfos.value:lInfos.liste.count()>0;});return{valide:lValide,message:lValide?undefined:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.ChoisirCriteres};} case ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Tous:{return{valide:true};}}} getCriteresUpdate(){const lCriteres=new Map();this.getCriteresDeGenre().forEach((aInfos,aGenre) =>{if(ObjetFenetre_ChoixDestinatairesParCriteres.estCritereAvecCheckBox(aGenre)){if(aInfos.value){lCriteres.set(aGenre,aInfos);}} else{if(aInfos.liste.count()>0){lCriteres.set(aGenre,Object.assign(Object.assign({},aInfos),{value:true}));}}});return lCriteres;} setCritere(aGenre,aInfos,aGenreIndivAssocieAuCriteres=this.genreIndivAssocieAuCriteresSelectionne){this.getCriteresDeGenre(aGenreIndivAssocieAuCriteres).set(aGenre,aInfos);} getCritere(aGenre,aGenreIndivAssocieAuCriteres=this.genreIndivAssocieAuCriteresSelectionne){return this.getCriteresDeGenre(aGenreIndivAssocieAuCriteres).get(aGenre);} getCriteresDeGenre(aGenreIndivAssocieAuCriteres=this.genreIndivAssocieAuCriteresSelectionne){return this.criteres.get(aGenreIndivAssocieAuCriteres);} getListeCriteresDeGenre(aGenreIndivAssocieAuCriteres=this.genreIndivAssocieAuCriteresSelectionne){return Array.from(this.criteres.get(aGenreIndivAssocieAuCriteres));} getListeCriteresDeGenreTriee(aGenreIndivAssocieAuCriteres=this.genreIndivAssocieAuCriteresSelectionne){const lListe=this.getListeCriteresDeGenre(aGenreIndivAssocieAuCriteres);ObjetTri_1.ObjetTri.trierTableau(lListe,[ObjetTri_1.ObjetTri.init(([aGenreCritere]) => this.getOrdreCritere(aGenreCritere))]);return lListe;} formatCriteres(aCriteres){if(!aCriteres||aCriteres.size===0){this.initCriteres();return;} const lPremierElement=aCriteres.values().next().value;const lEstCriteres=lPremierElement instanceof Map;if(lEstCriteres){this.initCriteres(aCriteres);} else{const lCriteres=new Map();lCriteres.set(this.genreIndivAssocieAuCriteresSelectionne,aCriteres);this.initCriteres(lCriteres);}} initCriteres(aCriteres){var _a,_b;for(const[lGenreIndiv,lListeCriteresDispo] of this.criteresDispo){const lCritere=(_a=aCriteres===null||aCriteres===void 0?void 0:aCriteres.get(lGenreIndiv))!==null&&_a!==void 0?_a:new Map();this.criteres.set(lGenreIndiv,lCritere);for(const lCritereCritere of lListeCriteresDispo){this.setCritere(lCritereCritere,(_b=this.getCritere(lCritereCritere,lGenreIndiv))!==null&&_b!==void 0?_b:this.getInfosCritereParDefaut(lGenreIndiv),lGenreIndiv);}}} getInfosCritereParDefaut(aGenre){return{genreIndivAssocieAuCriteres:aGenre,liste:new ObjetListeElements_1.ObjetListeElements(),value:false};} formatCriteresDispo(aCriteresDispo){if(!Array.isArray(aCriteresDispo)){return aCriteresDispo;} const lCriteresDispo=new Map();lCriteresDispo.set(this.genreIndivAssocieAuCriteresSelectionne,aCriteresDispo);return lCriteresDispo;} jsxModeleRadioTypeChoix(aGenre){return{getValue:() =>{return this.choixSelectionne===aGenre;},setValue:(aValue) =>{if(aValue){this.choixSelectionne=aGenre;}},getDisabled:() =>{return false;},getName:() =>{return`${this.Nom}_TypeChoix`;}};} jsxIfAvecIndivAssocieAuCriteres(aGenre){var _a;return aGenre===ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Critere&&((_a=this.listeGenresIndivAssocieAuCriteres)===null||_a===void 0?void 0:_a.length)>1;} jsxComboModelIndivAssocieAuCriteres(){return{init:(aCombo) =>{var _a;const lListe=new ObjetListeElements_1.ObjetListeElements();this.listeGenresIndivAssocieAuCriteres.forEach(aGenre =>{lListe.add(new ObjetElement_1.ObjetElement(this.getLibelleComboIndivAssocieAuCriteres(aGenre),0,aGenre));});const lIndice=(_a=lListe.getIndiceElementParFiltre(aElem => aElem.getGenre()===this.genreIndivAssocieAuCriteresSelectionne))!==null&&_a!==void 0?_a:0;aCombo.setDonneesObjetSaisie({liste:lListe,selection:lIndice});},event:(aParams) =>{if(aParams.estSelectionManuelle&&aParams.element){this.genreIndivAssocieAuCriteresSelectionne=aParams.element.getGenre();this.updateZoneCriteres();}},getDisabled:this.getDisabledCritere.bind(this)};} jsxModelBtnSelecteurRessource(){return{event:() =>{this.ouvrirFenetreSelectionPublic();},getLibelle:() =>{const lCompteur=this.listeRessourceSelectionnee.count();if(lCompteur===0){return'';} return IE.jsx.str(IE.jsx.fragment,null,lCompteur," ",this.getLibelleRessource());},getDisabled:this.getDisabledSelecteurRessource.bind(this)};} getDisabledSelecteurRessource(){return this.choixSelectionne!==ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Nominatif;} jsxModelBtnSelecteurCritere(aGenre){return{event:() =>{this.ouvrirFenetreCritere(aGenre);},getLibelle:() =>{var _a,_b,_c;const lCompteur=(_c=(_b=(_a=this.getCritere(aGenre))===null||_a===void 0?void 0:_a.liste)===null||_b===void 0?void 0:_b.count())!==null&&_c!==void 0?_c:0;return this.getLibelleSelecteurCritere(aGenre,lCompteur);},getDisabled:this.getDisabledCritere.bind(this)};} jsxGetClassCtnCriteres(){return this.getDisabledCritere()?ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.disabled:'';} getDisabledCritere(){return this.choixSelectionne!==ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Critere;} jsxModelCBCritere(aGenre){return{getValue:() =>{var _a,_b;return(_b=(_a=this.getCritere(aGenre))===null||_a===void 0?void 0:_a.value)!==null&&_b!==void 0?_b:false;},setValue:(aValue) =>{const lCritere=this.getCritere(aGenre);if(lCritere){lCritere.value=aValue;this.setCritere(aGenre,lCritere);}},getDisabled:this.getDisabledCritere.bind(this)};} jsxGetClassLabelRessource(){return this.getDisabledSelecteurRessource()?ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.disabled:'';} getLibelleSelecteurCritere(aGenre,aCompteur){const lEstSupUn=aCompteur>1;if(aCompteur===0){return'';} let lTrad;switch(aGenre){case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_AppartenanceClasse:lTrad=lEstSupUn?ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.ClassesSelec:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.ClasseSelec;break;case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_LienFamille:lTrad=lEstSupUn?ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.RubriquesSelec:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.RubriqueSelec;break;case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_Regime:lTrad=lEstSupUn?ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.RegimesSelec:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.RegimeSelec;break;case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_AutorisationDeSortie:lTrad=lEstSupUn?ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.AutorisationsSelec:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.AutorisationSelec;break;case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_NiveauResponsabilite:lTrad=lEstSupUn?ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.NiveauxSelec:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.NiveauSelec;break;case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_ProjetAccompagnement:lTrad=lEstSupUn?ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.PAsSelec:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.PASelec;break;default:;break;} if(lTrad){return lTrad.format([aCompteur.toString()]);} return'';} jsxModeleBoutonVisuIndividu(){return{event:() =>{this.ouvrirFenetreVisuIndividu();},getDisabled:() =>{return false;}};} updateZoneCriteres(){ObjetHtml_1.GHtml.setHtml(this.ids.zoneCriteres,this.composeCriteres());} composeContenu(){var _a;if(!this.criteresDispo){return'';} return(IE.jsx.str("div",{class:[Divers_css_1.StylesDivers.fullHeight,Divers_css_1.StylesDivers.flexContain,Divers_css_1.StylesDivers.cols,Divers_css_1.StylesDivers.flexGap]},IE.jsx.str("p",{class:[IE.estMobile&&Divers_css_1.StylesDivers.mTopL,Divers_css_1.StylesDivers.mBottomL]},(_a=this.textePersonnalisable.choixCritereDisponibilite)!==null&&_a!==void 0?_a:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.ChoixCritereDisponibilite.format([this.getLibelleRessource()])),IE.jsx.str("div",{class:[Divers_css_1.StylesDivers.fluidBloc]},this.composeChoixType()),IE.jsx.str("div",null,this.optionsFenetreChoixDestinataires.avecBtnVisuIndividu&&this.composeBtnVisuIndividu())));} composeBtnVisuIndividu(){var _a;return(IE.jsx.str("div",{class:[Divers_css_1.StylesDivers.flexContain,Divers_css_1.StylesDivers.justifyEnd]},IE.jsx.str("ie-bouton",{class:[IEHtml_Bouton_css_1.StylesIEHtmlBouton.themeBoutonNeutre,IEHtml_Bouton_css_1.StylesIEHtmlBouton.smallBt],"ie-model":this.jsxModeleBoutonVisuIndividu.bind(this),"ie-icon":"icon_eye_open"},(_a=this.textePersonnalisable.libelleBoutonTotalIndividu)!==null&&_a!==void 0?_a:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.TotalIndiv)));} composeChoixType(){var _a;return(IE.jsx.str("div",{class:[Divers_css_1.StylesDivers.flexContain,Divers_css_1.StylesDivers.flexCols]},(_a=this.choixDisponibles)===null||_a===void 0?void 0:_a.map((aChoix,aIndice) =>{const lEstPasLeDernier=(aIndice+1)<this.choixDisponibles.length;return(IE.jsx.str(IE.jsx.fragment,null,this.composeChoixParGenre(aChoix),lEstPasLeDernier&&IE.jsx.str("hr",{class:[ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.separateur]})));})));} composeChoixParGenre(aGenre){return(IE.jsx.str("div",{class:[Divers_css_1.StylesDivers.flexContain,Divers_css_1.StylesDivers.cols,Divers_css_1.StylesDivers.mBottomXl,Divers_css_1.StylesDivers.mTopXxl]},IE.jsx.str("div",{class:[ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.combiCriteres]},IE.jsx.str("ie-radio",{"ie-model":this.jsxModeleRadioTypeChoix.bind(this,aGenre)},this.getLibelleRadioParGenre(aGenre)),IE.jsx.str("ie-combo",{class:[ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.osCombo],"aria-label":ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.WaiGenreRessourceCritere,"ie-if":this.jsxIfAvecIndivAssocieAuCriteres.bind(this,aGenre),"ie-model":this.jsxComboModelIndivAssocieAuCriteres.bind(this)})),this.composeContenueChoix(aGenre)));} composeContenueChoix(aGenre){switch(aGenre){case ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Tous:return this.composeHTMLTous();case ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Nominatif:return this.composeHTMLNominativement();case ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Critere:return this.composeHTMLCriteres();default:;return'';}} composeHTMLTous(){return IE.jsx.str("div",{class:[ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.ctnChoix,ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.ctnTous]});} composeHTMLNominativement(){return(IE.jsx.str("div",{class:[ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.ctnChoix,ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.ctnNominativement]},IE.jsx.str("label",{class:[ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.labelSelecteur],"ie-class":this.jsxGetClassLabelRessource.bind(this)},ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.WaiSelectionDesRessources.format([this.getLibelleRessource(true)])),IE.jsx.str("div",{class:[ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.selecteur]},IE.jsx.str("ie-btnselecteur",{"ie-model":this.jsxModelBtnSelecteurRessource.bind(this),"aria-label":ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.WaiSelectionDesRessources.format([this.getLibelleRessource()]),placeholder:this.getPlaceHolderSelecteur(true)}))));} composeHTMLCriteres(){return(IE.jsx.str("div",{class:[ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.ctnChoix,ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.ctnCritere]},IE.jsx.str("p",null,ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.SerontPrisEnCompte.format([this.getLibelleRessource(true)])),IE.jsx.str("div",{id:this.ids.zoneCriteres},this.composeCriteres())));} composeCriteres(){var _a;return(IE.jsx.str("div",{"ie-class":this.jsxGetClassCtnCriteres.bind(this),class:[ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.ctnListeCriteres]},(_a=this.getListeCriteresDeGenreTriee())===null||_a===void 0?void 0:_a.map(([aGenre]) =>{return ObjetFenetre_ChoixDestinatairesParCriteres.estCritereAvecCheckBox(aGenre)?this.composeCBCritere(aGenre):this.composeSelecteurCritere(aGenre);})));} composeSelecteurCritere(aGenre){const{label,libelle,placeholder}=this.getLibelleCritere(aGenre);return(IE.jsx.str("div",{class:[ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.critere,ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.simple]},IE.jsx.str("label",{class:[]},libelle),IE.jsx.str("div",null,IE.jsx.str("ie-btnselecteur",{"ie-model":this.jsxModelBtnSelecteurCritere.bind(this,aGenre),placeholder:placeholder,"aria-label":label}))));} composeCBCritere(aGenre){return(IE.jsx.str("div",{class:[ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.critere,ChoixDestinatairesParCriteres_module_css_1.StylesChoixDestinatairesParCriteres.cb]},IE.jsx.str("ie-checkbox",{"ie-model":this.jsxModelCBCritere.bind(this,aGenre)},ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.Delegue)));} getLibelleCritere(aGenre){switch(aGenre){case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_AppartenanceClasse:return{libelle:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.Classe,label:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.WaiClasse,placeholder:this.getPlaceHolderSelecteur(false)};case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_LienFamille:return{libelle:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.Rubriques,label:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.WaiRubrique,placeholder:this.getPlaceHolderSelecteur(false)};case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_Regime:return{libelle:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.Regime,label:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.WaiRegime,placeholder:this.getPlaceHolderSelecteur(true)};case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_AutorisationDeSortie:return{libelle:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.AutorisationDeSortie,label:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.WaiAutorisationDeSortie,placeholder:this.getPlaceHolderSelecteur(false)};case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_NiveauResponsabilite:return{libelle:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.Niveau,label:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.WaiNiveau,placeholder:this.getPlaceHolderSelecteur(true)};case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_EstDelegue:return{libelle:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.Delegue,label:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.WaiDelegue,placeholder:this.getPlaceHolderSelecteur(false)};case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_ProjetAccompagnement:return{libelle:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.ProjetAcc,label:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.WaiProjetAcc,placeholder:this.getPlaceHolderSelecteur(true)};default:{return{libelle:'',label:'',placeholder:false};}}} getPlaceHolderSelecteur(aEstMasculin){return aEstMasculin?ObjetTraduction_1.GTraductions.getValeur('Aucun'):ObjetTraduction_1.GTraductions.getValeur('Aucune');} getOrdreCritere(aGenreCritere,aGenreRessource=this.genreIndivAssocieAuCriteresSelectionne){switch(aGenreRessource){case ChoixDestinatairesParCriteres_1.TypeGenreDestinataire.GD_Eleve:{switch(aGenreCritere){case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_AppartenanceClasse:return 1;case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_LienFamille:return 2;case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_Regime:return 3;case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_AutorisationDeSortie:return 4;case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_EstDelegue:return 5;case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_ProjetAccompagnement:return 6;default:{return 0;}}} case ChoixDestinatairesParCriteres_1.TypeGenreDestinataire.GD_Responsable:{switch(aGenreCritere){case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_LienFamille:return 1;case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_EstDelegue:return 2;case ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_NiveauResponsabilite:return 3;default:{return 0;}}} default:;return 0;}} getLibelleComboIndivAssocieAuCriteres(aGenre){switch(aGenre){case ChoixDestinatairesParCriteres_1.TypeGenreDestinataire.GD_Eleve:return ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.DesEleve;case ChoixDestinatairesParCriteres_1.TypeGenreDestinataire.GD_Responsable:return ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.DeResponsable;default:{return'';}}} getLibelleRadioParGenre(aGenre){switch(aGenre){case ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Tous:return ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.Tous;case ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Nominatif:return ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.Nominativement;case ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Critere:return ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.ParCriteres;default:;}} getLibelleRessource(aLowerCase=false){return ObjetFenetre_ChoixDestinatairesParCriteres.getLibelleRessource(this.genreRessource,aLowerCase);} static getLibelleRessource(aGenreRessource,aLowerCase=false){if(!MethodesObjet_1.MethodesObjet.isNumeric(aGenreRessource)){return'';} let lResult='';switch(aGenreRessource){case Enumere_Ressource_1.EGenreRessource.Eleve:lResult=ObjetTraduction_1.GTraductions.getValeur('Eleves');break;case Enumere_Ressource_1.EGenreRessource.Responsable:lResult=ObjetTraduction_1.GTraductions.getValeur('Responsables');break;default:{lResult='';break;}} return aLowerCase?lResult.toLowerCase():lResult;} async ouvrirFenetreSelectionPublic(){this.moteurDestinataires.ouvrirModaleSelectionPublic({forcerSansFiltreSurEleve:this.optionsFenetreChoixDestinataires.forcerSansFiltreSurEleve,genreRessource:this.genreRessource,listePublicDonnee:this.listeRessourceSelectionnee,clbck:(aParams) =>{if(aParams.listePublicDonnee){this.listeRessourceSelectionnee=new ObjetListeElements_1.ObjetListeElements(aParams.listePublicDonnee);}}});} async ouvrirFenetreCritere(aGenre){var _a;const lFenetre=ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_Criteres_1.ObjetFenetre_Criteres,{pere:this,initialiser(aFenetre){aFenetre.setOptionsFenetre({titre:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.TitreFenetreCritere.format([this.getLibelleCritere(aGenre).libelle])});}});lFenetre.setOptionsFenetreCriteres({uniquementClasseEnseignee:!this.optionsFenetreChoixDestinataires.forcerSansFiltreSurEleve});const lRes=await(lFenetre===null||lFenetre===void 0?void 0:lFenetre.setDonnees({genreCritere:aGenre,genreIndivAssocieAuCritere:this.genreIndivAssocieAuCriteresSelectionne,genreRessource:this.genreRessource,listeRessourceSelectionnee:(_a=this.getCritere(aGenre))===null||_a===void 0?void 0:_a.liste}));if((lRes===null||lRes===void 0?void 0:lRes.numeroBouton)===1&&lRes.selection){const lCritere=this.getCritere(aGenre);if(lCritere){lCritere.liste=lRes.selection;this.setCritere(aGenre,lCritere);}}} async ouvrirFenetreVisuIndividu(){const lDonnees=await this.getDonneesVisuIndividu();if(lDonnees){const lFenetre=ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_VisuIndividu,{pere:this,initialiser(aFenetre){aFenetre.setNombreDestinataires(lDonnees.count());}});lFenetre===null||lFenetre===void 0?void 0:lFenetre.setDonnees(lDonnees);}} async getDonneesVisuIndividu(){var _a;const lRes=await new ObjetRequeteDestinatairesParCriteres_1.ObjetRequeteDestinatairesParCriteres(this).lancerRequete({genreRequete:ChoixDestinatairesParCriteres_2.TypeGenreRequeteDestinataireParCriteres.TGR_TotalIndividus,criteres:this.getCriteresUpdate(),listeRessourceSelectionnee:this.listeRessourceSelectionnee,choix:this.choixSelectionne,genreIndivAssocieAuCritere:this.genreIndivAssocieAuCriteresSelectionne,genreRessource:this.genreRessource,genreDocumentTelechargeable:this.genreDocumentTelechargeable,options:{avecLibelleEnfants:this.optionsFenetreChoixDestinataires.avecLibelleEnfantsDansTotalIndiv}});const lDonnees=(_a=lRes===null||lRes===void 0?void 0:lRes.listeTotalIndividus)!==null&&_a!==void 0?_a:new ObjetListeElements_1.ObjetListeElements();lDonnees.setTri([ObjetTri_1.ObjetTri.init('Position'),ObjetTri_1.ObjetTri.init('Libelle')]);return lDonnees;}} exports.ObjetFenetre_ChoixDestinatairesParCriteres=ObjetFenetre_ChoixDestinatairesParCriteres;(function(ObjetFenetre_ChoixDestinatairesParCriteres){ObjetFenetre_ChoixDestinatairesParCriteres.isResolveTous=(aResolve) =>{return aResolve.choix===ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Tous&&!ObjetFenetre_ChoixDestinatairesParCriteres.isResolveCriteres(aResolve)&&!ObjetFenetre_ChoixDestinatairesParCriteres.isResolveNominativement(aResolve);};ObjetFenetre_ChoixDestinatairesParCriteres.isResolveCriteres=(aResolve) =>{return'criteres' in aResolve&&aResolve.choix===ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Critere;};ObjetFenetre_ChoixDestinatairesParCriteres.isResolveNominativement=(aResolve) =>{return'listeRessourceSelectionnee' in aResolve&&aResolve.choix===ChoixDestinatairesParCriteres_2.TypeChoixTelechargementDoc.CTD_Nominatif;};ObjetFenetre_ChoixDestinatairesParCriteres.typeGenreCritereTelechargementAvecCheckBox=[ChoixDestinatairesParCriteres_2.TypeGenreCritereTelechargement.CTMDOC_EstDelegue];ObjetFenetre_ChoixDestinatairesParCriteres.estCritereAvecCheckBox=(aCritere) =>{return ObjetFenetre_ChoixDestinatairesParCriteres.typeGenreCritereTelechargementAvecCheckBox.includes(aCritere);};let EGenreCritere;(function(EGenreCritere){EGenreCritere[EGenreCritere["Classe"]=0]="Classe";EGenreCritere[EGenreCritere["Famille"]=1]="Famille";EGenreCritere[EGenreCritere["Regime"]=2]="Regime";EGenreCritere[EGenreCritere["AutorisationDeSortie"]=3]="AutorisationDeSortie";EGenreCritere[EGenreCritere["Delegue"]=4]="Delegue";EGenreCritere[EGenreCritere["ProjetAcc"]=5]="ProjetAcc";})(EGenreCritere=ObjetFenetre_ChoixDestinatairesParCriteres.EGenreCritere||(ObjetFenetre_ChoixDestinatairesParCriteres.EGenreCritere={}));})(ObjetFenetre_ChoixDestinatairesParCriteres||(exports.ObjetFenetre_ChoixDestinatairesParCriteres=ObjetFenetre_ChoixDestinatairesParCriteres={}));class ObjetFenetre_VisuIndividu extends ObjetFenetre_1.ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.Destinataires,largeur:400,hauteurMin:600,listeBoutons:[ObjetTraduction_1.GTraductions.getValeur('Fermer')]});} construireInstances(){this.identListe=this.add(ObjetListe_1.ObjetListe,null,this.initListe);} setNombreDestinataires(aNbr){return this.setOptionsFenetre({titre:`${aNbr} ${ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.Destinataires}`});} initListe(aInstance){aInstance.setOptionsListe({skin:ObjetListe_1.ObjetListe.skin.flatDesign,ariaLabel:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.Destinataires,messageContenuVide:ChoixDestinatairesParCriteres_2.TradChoixDestinatairesParCriteres.AucunDestinataire,boutons:[{genre:ObjetListe_1.ObjetListe.typeBouton.rechercher}]});} setDonnees(aListe){this.liste=aListe;this.afficher(this.composeContenu());const linstanceListe=this.getInstance(this.identListe);this.initListe(linstanceListe);linstanceListe.setDonnees(new DonneesListe_VisuIndividu(this.liste));} composeContenu(){return IE.jsx.str(IE.jsx.fragment,null,this.liste&&IE.jsx.str("div",{class:[Divers_css_1.StylesDivers.fullHeight],id:this.getNomInstance(this.identListe)}));}} class DonneesListe_VisuIndividu extends ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecSelection:false,avecBoutonActionLigne:false});} getTitreZonePrincipale(aParams){return IE.jsx.str("p",null,aParams.article.getLibelle()," ",'classe' in aParams.article?`(${aParams.article.classe.getLibelle()})`:'');} getInfosSuppZonePrincipale(aParams){return(IE.jsx.str(IE.jsx.fragment,null,'libelleEnfants' in aParams.article&&IE.jsx.str("p",null,aParams.article.libelleEnfants)));}}