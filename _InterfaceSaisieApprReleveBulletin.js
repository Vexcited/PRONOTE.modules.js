exports._InterfaceSaisieApprReleveBulletin=void 0;const InterfacePage_1=require("InterfacePage");const InterfacePageAvecMenusDeroulants_1=require("InterfacePageAvecMenusDeroulants");const Enumere_Ressource_1=require("Enumere_Ressource");const ObjetRequeteApprBulletin_1=require("ObjetRequeteApprBulletin");const ObjetListe_1=require("ObjetListe");const Enumere_StructureAffichage_1=require("Enumere_StructureAffichage");const DonneesListe_ApprBulletin_1=require("DonneesListe_ApprBulletin");const Enumere_EvenementListe_1=require("Enumere_EvenementListe");const ObjetMoteurReleveBulletin_1=require("ObjetMoteurReleveBulletin");const UtilitaireCompetences_1=require("UtilitaireCompetences");const ObjetTraduction_1=require("ObjetTraduction");const ObjetFenetre_Liste_1=require("ObjetFenetre_Liste");const ObjetFenetre_AssistantSaisie_1=require("ObjetFenetre_AssistantSaisie");const EBoutonFenetreAssistantSaisie_1=require("EBoutonFenetreAssistantSaisie");const ObjetMoteurAssistantSaisie_1=require("ObjetMoteurAssistantSaisie");const Enumere_TypeAppreciation_1=require("Enumere_TypeAppreciation");const ObjetMoteurGrilleSaisie_1=require("ObjetMoteurGrilleSaisie");const ObjetListeElements_1=require("ObjetListeElements");const TypeReleveBulletin_1=require("TypeReleveBulletin");const Enumere_Etat_1=require("Enumere_Etat");const TypeGenreValidationCompetence_1=require("TypeGenreValidationCompetence");const ObjetElement_1=require("ObjetElement");const Invocateur_1=require("Invocateur");const Enumere_GenreImpression_1=require("Enumere_GenreImpression");const Invocateur_2=require("Invocateur");const DonneesListe_BarreNiveauxDAcquisitionsDePilier_1=require("DonneesListe_BarreNiveauxDAcquisitionsDePilier");const Enumere_BoiteMessage_1=require("Enumere_BoiteMessage");const Enumere_Action_1=require("Enumere_Action");const UtilitaireBoutonBandeau_1=require("UtilitaireBoutonBandeau");const TypePositionnement_1=require("TypePositionnement");const Divers_css_1=;class _InterfaceSaisieApprReleveBulletin extends InterfacePage_1.InterfacePage{constructor(...aParams){super(...aParams);this.etatUtilisateurSco=this.applicationSco.getEtatUtilisateur();this.parametresSco=this.applicationSco.getObjetParametres();this.param={modeChronologique:false};this.moteur=new ObjetMoteurReleveBulletin_1.ObjetMoteurReleveBulletin();this.moteurAssSaisie=new ObjetMoteurAssistantSaisie_1.ObjetMoteurAssistantSaisie();this.moteurGrille=new ObjetMoteurGrilleSaisie_1.ObjetMoteurGrilleSaisie();this.estOrientationVerticale=true;this.avecComboPeriode=true;} jsxModeleBoutonAssistantSaisie(){return{event:() =>{this._evntSurAssistant();},getTitle:() =>{return this.moteurAssSaisie.getTitleBoutonAssistantSaisie();},getSelection:() =>{return this.etatUtilisateurSco.assistantSaisieActif;}};} getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{getInfoCloture:function(){return aInstance.strInfoCloture?aInstance.strInfoCloture:'';},avecBoutonOrientationSaisie(){return!!aInstance.avecBoutonOrientationSaisie;},btnOrientationSaisie:{event(){aInstance.estOrientationVerticale=!aInstance.estOrientationVerticale;},getSelection(){return!!aInstance.estOrientationVerticale;},getTitle(){if(!!aInstance.estOrientationVerticale){return ObjetTraduction_1.GTraductions.getValeur('competences.SensDeSaisieHorizontal');} return ObjetTraduction_1.GTraductions.getValeur('competences.SensDeSaisieVertical');},getClassesMixIcon(){return UtilitaireBoutonBandeau_1.UtilitaireBoutonBandeau.getClassesMixIconSaisieHorizontalVertical(aInstance.estOrientationVerticale);}}});} getService(){return this.etatUtilisateurSco.Navigation.getRessource(Enumere_Ressource_1.EGenreRessource.Service);} getClasse(){return this.etatUtilisateurSco.Navigation.getRessource(Enumere_Ressource_1.EGenreRessource.Classe);} getPeriode(){return this.etatUtilisateurSco.Navigation.getRessource(Enumere_Ressource_1.EGenreRessource.Periode);} envoyerRequete(aParam){new ObjetRequeteApprBulletin_1.ObjetRequeteApprBulletin(this,this._actionSurRecupererDonnees.bind(this)).lancerRequete(aParam);} getListeTypesAppreciations(){this.moteurAssSaisie.getListeTypesAppreciations({typeReleveBulletin:this.typeReleveBulletin,clbck:(aListeTypesAppreciations) =>{this.listeTypesAppreciations=aListeTypesAppreciations;}});} clbckSaisieApprClasse(aParamSucces){if(!this.moteur.controleCtxAppSaisie({service:this.getService(),periode:this.getPeriode()},aParamSucces)){return;} this.moteur.updateAppClasseSurRetourSaisie(this.donnees.appreciationClasse,aParamSucces);this._afficherPiedPage(this.donnees);} saisieAppreciation(aParam,aParamRequete){const lParam={instanceListe:aParam.instanceListe,paramRequete:aParamRequete,paramCellSuivante:(aParam.suivante!==null)&&(aParam.suivante!==undefined)?aParam.suivante:{orientationVerticale:this.estOrientationVerticale},clbckEchec:(aPromiseMsg) =>{this._actualiserSurErreurSaisie({liste:aParam.instanceListe,promiseMsg:aPromiseMsg});},clbckSucces:(aParamSucces) =>{}};if(aParam.estCtxPied){$.extend(lParam,{clbckSucces:(aParamSucces) =>{this.moteur.updateAppClasseSurRetourSaisie(this.donnees.appreciationClasse,aParamSucces);this._afficherPiedPage(this.donnees);}});} else{$.extend(lParam,{clbckSucces:(aParamSucces) =>{const lDonneesListe=this.getInstance(this.identListe).getListeArticles();const lLignes=lDonneesListe.getListeElements((aLigne) =>{return(aLigne.eleve.getNumero()===aParamSucces.numeroEleve&&aLigne.service.getNumero()===aParamSucces.numeroService);});const lLigne=lLignes.get(0);let lApp;if(this.typeReleveBulletin===TypeReleveBulletin_1.TypeReleveBulletin.AppreciationsBulletinProfesseur){if(lLigne.appA&&(lLigne.appA.getGenre()===aParamSucces.rangAppr)){lApp=lLigne.appA;} else if(lLigne.appB&&(lLigne.appB.getGenre()===aParamSucces.rangAppr)){lApp=lLigne.appB;} else if(lLigne.appC&&(lLigne.appC.getGenre()===aParamSucces.rangAppr)){lApp=lLigne.appC;}} else{if(lLigne.appReleve&&(lLigne.appReleve.getGenre()===aParamSucces.rangAppr)){lApp=lLigne.appReleve;}} if(lApp){lApp.setNumero(aParamSucces.apprSaisie.getNumero());lApp.setLibelle(aParamSucces.apprSaisie.getLibelle());lApp.setEtat(Enumere_Etat_1.EGenreEtat.Aucun);}}});} this.moteur.saisieAppreciation(lParam);} getListeAnnotationsPourAvisReligion(){if((this.listeAnnotations===null)||(this.listeAnnotations===undefined)){this.listeAnnotations=new ObjetListeElements_1.ObjetListeElements();} this.listeAnnotations.insererElement(ObjetElement_1.ObjetElement.create({Libelle:'',Numero:0,Position:0,description:ObjetTraduction_1.GTraductions.getValeur('Aucun')}),0);} construireInstances(){this.identTripleCombo=this.add(InterfacePageAvecMenusDeroulants_1.ObjetAffichagePageAvecMenusDeroulants,this._evntSurDernierMenuDeroulant.bind(this),this._initTripleCombo.bind(this));if((this.identTripleCombo!==null&&this.identTripleCombo!==undefined)&&this.getInstance(this.identTripleCombo)!==null){this.IdPremierElement=this.getInstance(this.identTripleCombo).getPremierElement();} this.identListe=this.add(ObjetListe_1.ObjetListe,this._evntSurListe.bind(this),(aListe) =>{aListe.setOptionsListe({ariaLabel:() =>{var _a,_b,_c;return[
this.etatUtilisateurSco.getLibelleLongOnglet(),((_a=this.getClasse())===null||_a===void 0?void 0:_a.getLibelle())||'',this.avecComboPeriode===true?((_b=this.getPeriode())===null||_b===void 0?void 0:_b.getLibelle())||'':'',((_c=this.getService())===null||_c===void 0?void 0:_c.getLibelle())||''
].join(' ').trim();}});});this.fenetreDetailJauges=this.addFenetre(ObjetFenetre_Liste_1.ObjetFenetre_Liste,() =>{this.etatUtilisateurSco.Navigation.fenetre_BarreNiveauxDAcquisitions_estAffiche=false;},(aInstance) =>{const lColonnes=[];lColonnes.push({id:DonneesListe_BarreNiveauxDAcquisitionsDePilier_1.DonneesListe_BarreNiveauxDAcquisitionsDePilier.colonnes.domaine,titre:ObjetTraduction_1.GTraductions.getValeur('Fenetre_BarreNiveauxDacquisitions.Titre.DomaineDeFormation'),taille:300});lColonnes.push({id:DonneesListe_BarreNiveauxDAcquisitionsDePilier_1.DonneesListe_BarreNiveauxDAcquisitionsDePilier.colonnes.jauge,titre:ObjetTraduction_1.GTraductions.getValeur('Fenetre_BarreNiveauxDacquisitions.Titre.EtatAcquisition'),taille:'100%'});const lParamsListe={optionsListe:{colonnes:lColonnes}};aInstance.setOptionsFenetre({modale:false,titre:'',largeur:600,hauteur:300,listeBoutons:[ObjetTraduction_1.GTraductions.getValeur('Fermer')]});aInstance.paramsListe=lParamsListe;});this.identPiedPage=this.instancierPiedBulletin();this.instancierAssistantSaisie();this.construireFicheEleveEtFichePhoto();} construireStructureAffichageAutre(){const H=[];H.push('<div style="height:100%">');H.push('<div style="height:100%">');H.push(IE.jsx.str("div",{class:[Divers_css_1.StylesDivers.pAll],style:{paddingRight:10},id:this.getNomInstance(this.identListe)}));if(this.identPiedPage&&this.getInstance(this.identPiedPage)){H.push('<div class="Espace AlignementBas" id="',this.getNomInstance(this.identPiedPage),'"></div>');} H.push('</div>');H.push('</div>');return H.join('');} setParametresGeneraux(){this.GenreStructure=Enumere_StructureAffichage_1.EStructureAffichage.Autre;this.IdentZoneAlClient=this.identListe;this.avecBandeau=true;this.AddSurZone=[
this.identTripleCombo
];if([TypeReleveBulletin_1.TypeReleveBulletin.AppreciationsReleveProfesseur,TypeReleveBulletin_1.TypeReleveBulletin.AppreciationsBulletinProfesseur].includes(this.typeReleveBulletin)){this.AddSurZone.push({html:'<span ie-html="getInfoCloture"></span>'});} this.AddSurZone.push({separateur:true});this.addSurZoneOrientationSaisie();this.addSurZoneAssistantSaisie();this.addSurZoneFichesEleve();this.addSurZoneMrFiche();} evenementAfficherMessage(aMessage){this._masquerVisibilitePiedPage(true);this._evenementAfficherMessage(aMessage);} desactiverImpression(){Invocateur_1.Invocateur.evenement(Invocateur_2.ObjetInvocateur.events.activationImpression,Enumere_GenreImpression_1.EGenreImpression.Aucune);} selectionneEleveAutoDansPage(){const lTrouve=this.selectionnerEleveCourant();this.activerFichesEleve(lTrouve);} selectionnerEleveCourant(){let lTrouve=false;const lEleve=this.etatUtilisateurSco.Navigation.getRessource(Enumere_Ressource_1.EGenreRessource.Eleve);if(lEleve&&!lEleve.multiSelection){const lDonneesListe=this.getInstance(this.identListe).getListeArticles();for(let i=0,lNbr=lDonneesListe.count();i<lNbr;i++){if(!lTrouve){const lElement=lDonneesListe.get(i);if(lElement.eleve.getNumero()===lEleve.getNumero()){lTrouve=true;this.getInstance(this.identListe).selectionnerLigne({ligne:i,avecScroll:true});break;}}}} return lTrouve;} addSurZoneOrientationSaisie(){this.AddSurZone.push({html:UtilitaireBoutonBandeau_1.UtilitaireBoutonBandeau.getHtmlBtnSaisieHorizontalVertical('btnOrientationSaisie'),getDisplay:'avecBoutonOrientationSaisie'});} avecAssistantSaisie(){return this.moteurAssSaisie.avecAssistantSaisie({typeReleveBulletin:this.typeReleveBulletin});} instancierAssistantSaisie(){if(this.avecAssistantSaisie()){this.identFenetreAssistantSaisie=this.add(ObjetFenetre_AssistantSaisie_1.ObjetFenetre_AssistantSaisie,this._evntSurFenetreAssistantSaisie.bind(this),this.moteurAssSaisie.initialiserFenetreAssistantSaisie);}} addSurZoneAssistantSaisie(){if(this.avecAssistantSaisie()){this.AddSurZone.push({html:UtilitaireBoutonBandeau_1.UtilitaireBoutonBandeau.getHtmlBtnAssistantSaisie(this.jsxModeleBoutonAssistantSaisie.bind(this))});}} instancierPiedBulletin(){return 0;} afficherPiedPage(aParam){this._afficherPiedPage(aParam);} addSurZoneFichesEleve(){this.addSurZoneFicheEleve();} addSurZoneMrFiche(){} estColonnePositionnementEstVisible(){return false;} _initTripleCombo(aInstance){const lCombos=[Enumere_Ressource_1.EGenreRessource.Classe];if(this.avecComboPeriode===true){lCombos.push(Enumere_Ressource_1.EGenreRessource.Periode);} lCombos.push(Enumere_Ressource_1.EGenreRessource.Service);aInstance.setParametres(lCombos,true);} _evntSurDernierMenuDeroulant(){if(this.etatUtilisateurSco.Navigation.fenetre_BarreNiveauxDAcquisitions_estAffiche){this.etatUtilisateurSco.Navigation.fenetre_BarreNiveauxDAcquisitions_estAffiche=false;this.getInstance(this.fenetreDetailJauges).fermer();} this._actualiserDonnees();} _actualiserDonnees(){this.getListeTypesAppreciations();const lParam={ressource:this.getClasse(),periode:this.avecComboPeriode?this.getPeriode():null,service:this.getService()};this.envoyerRequete(lParam);} _evntSurListe(aParametres){const lIdCol=aParametres.idColonne;const lLigne=aParametres.article;const lClasse=this._getInfoClasseEleve(lLigne);switch(aParametres.genreEvenement){case Enumere_EvenementListe_1.EGenreEvenementListe.Selection:this.etatUtilisateurSco.Navigation.setRessource(Enumere_Ressource_1.EGenreRessource.Eleve,aParametres.article.eleve);this.surSelectionEleve();switch(lIdCol){case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.jaugeEval:this._ouvrirFenetreDetailJauges(lLigne);break;} break;case Enumere_EvenementListe_1.EGenreEvenementListe.Edition:switch(lIdCol){case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.evolution:this.moteur.ouvrirMenuEvolution({id:this.getInstance(this.identListe).getIdCellule(aParametres.colonne,aParametres.ligne),instance:this,clbackMenuEvolution:(aEvolution) =>{if(aEvolution){this.moteur.saisieEvolution({paramRequete:{evolution:aEvolution.getGenre(),classe:lClasse,periode:this.getPeriode(),eleve:lLigne.eleve,service:lLigne.service},instanceListe:this.getInstance(this.identListe),clbckSucces:(aParamSucces) =>{const lDonneesListe=this.getInstance(this.identListe).getListeArticles();const lLignes=lDonneesListe.getListeElements((aLigne) =>{return((aLigne.eleve.getNumero()===aParamSucces.numeroEleve)&&(aLigne.service.getNumero()===aParamSucces.numeroService));});const lLigne=lLignes.get(0);if(aParamSucces.evolutionSaisie){lLigne.listePeriodesPrec.parcourir((aEltPeriodePrec) =>{aEltPeriodePrec.evolution=aParamSucces.evolutionSaisie;});}},paramCellSuivante:{orientationVerticale:this.estOrientationVerticale},clbckEchec:(aPromiseMsg) =>{this._actualiserSurErreurSaisie({liste:this.getInstance(this.identListe),promiseMsg:aPromiseMsg});}});}}});break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.niveauAcqu:{aParametres.ouvrirMenuContextuel({genreChoixValidationCompetence:TypeGenreValidationCompetence_1.TypeGenreValidationCompetence.tGVC_Competence,genrePositionnement:TypePositionnement_1.TypePositionnementUtil.getGenrePositionnementParDefaut(lLigne.typePositionnementClasse),avecLibelleRaccourci:true,clbackMenuPositionnement:(aNiveauDAcquisition) =>{this._saisiePositionnementSurLigneEleve(lLigne,aNiveauDAcquisition);}});break;} case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.avisReligionPropose:case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.avisReligionDeliberee:{const lAvisReligion=(lIdCol===DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.avisReligionPropose)?lLigne.avisReligionPropose:lLigne.avisReligionDelibere;this.moteur.surEditionAvisReligion({article:lLigne,idColonne:lIdCol,avisReligion:lAvisReligion,listeAvis:this.listeAnnotations,surValiderEditionDonnee:(aParam) =>{const lArticle=aParam.article;switch(aParam.idColonne){case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.avisReligionPropose:lArticle.avisReligionPropose=aParam.selection;lArticle.avisReligionPropose.setEtat(Enumere_Etat_1.EGenreEtat.Modification);break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.avisReligionDeliberee:lArticle.avisReligionDelibere=aParam.selection;lArticle.avisReligionDelibere.setEtat(Enumere_Etat_1.EGenreEtat.Modification);break;} lArticle.setEtat(Enumere_Etat_1.EGenreEtat.Modification);this._envoyerSaisiePropDelib({article:lArticle,idCol:lIdCol});}});break;} case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.moyNonRepresentative:if(lLigne.estMoyNREditable){if(!lLigne.estMoyNR){GApplication.getMessage().afficher({type:Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,titre:ObjetTraduction_1.GTraductions.getValeur('Notes.TitreConfirmationMoyNR'),message:ObjetTraduction_1.GTraductions.getValeur('Notes.ConfirmationMoyNR'),callback:(aGenreAction) =>{if(aGenreAction===Enumere_Action_1.EGenreAction.Valider){this._basculerMoyNRDEleve(lLigne);}}});} else{this._basculerMoyNRDEleve(lLigne);}} break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.appreciationReleve:case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.appreciationA:case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.appreciationB:case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.appreciationC:{const lAppreciation=DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.getAppreciationDeColonne(aParametres);this.moteurAssSaisie.evenementOuvrirAssistantSaisie({instanceFenetreAssistantSaisie:this.getInstance(this.identFenetreAssistantSaisie),listeTypesAppreciations:this.listeTypesAppreciations,tabTypeAppreciation:Enumere_TypeAppreciation_1.ETypeAppreciationUtil.getTypeAppreciation(this.etatUtilisateurSco.getGenreOnglet(),lAppreciation,false),tailleMaxAppreciation:this.moteur.getTailleMaxAppreciation({estCtxPied:false,eleve:lLigne.eleve,typeReleveBulletin:this.typeReleveBulletin}),avecEtatSaisie:false});this.objCelluleAppreciation=$.extend({article:lLigne,appreciation:lAppreciation,idColonne:aParametres.idColonne,ctxPiedBulletin:false});break;}} break;case Enumere_EvenementListe_1.EGenreEvenementListe.ApresEdition:switch(lIdCol){case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.ects:{const lValeur=lLigne.ectsModifie;if((lValeur!==null)&&(lValeur!==undefined)&&(lValeur!==lLigne.ECTS)){this.moteur.saisieECTS({paramRequete:{estCalculAuto:false,classe:lClasse,periode:this.getPeriode(),eleve:lLigne.eleve,service:this.getService(),ECTS:lValeur},instanceListe:this.getInstance(this.identListe),clbckSucces:(aParamSucces) =>{const lDonneesListe=this.getInstance(this.identListe).getListeArticles();const lLignes=lDonneesListe.getListeElements((aLigne) =>{return aLigne.eleve.getNumero()===aParamSucces.numeroEleve;});const lLigne=lLignes.get(0);lLigne.ECTS=aParamSucces.ECTSSaisie;},paramCellSuivante:{orientationVerticale:this.estOrientationVerticale},clbckEchec:(aPromiseMsg) =>{this._actualiserSurErreurSaisie({liste:this.getInstance(this.identListe),promiseMsg:aPromiseMsg});}});} else{this.moteurGrille.selectionCelluleSuivante({instanceListe:this.getInstance(this.identListe),suivante:{orientationVerticale:this.estOrientationVerticale}});} break;} case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.moyProposee:if(lLigne.moyProposeeModifie.getNote()!==lLigne.moyenneProposee.getNote()){lLigne.moyenneProposee=lLigne.moyProposeeModifie;this._envoyerSaisiePropDelib({article:lLigne,idCol:lIdCol});} break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.moyDeliberee:if(lLigne.moyDelibereeModifie.getNote()!==lLigne.moyenneDeliberee.getNote()){lLigne.moyenneDeliberee=lLigne.moyDelibereeModifie;this._envoyerSaisiePropDelib({article:lLigne,idCol:lIdCol});} break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.noteLSU:if(lLigne.noteLSUModifie.getNote()!==lLigne.noteLSU.getNote()){this.moteur.saisieNoteLSU({paramRequete:{classe:lClasse,periode:this.getPeriode(),eleve:lLigne.eleve,service:this.getService(),posLSUNote:lLigne.noteLSUModifie},instanceListe:this.getInstance(this.identListe),clbckSucces:(aParamSucces) =>{const lDonneesListe=this.getInstance(this.identListe).getListeArticles();const lLignes=lDonneesListe.getListeElements((aLigne) =>{return aLigne.eleve.getNumero()===aParamSucces.numeroEleve;});const lLigne=lLignes.get(0);lLigne.noteLSU=aParamSucces.noteLSUSaisie;},paramCellSuivante:{orientationVerticale:this.estOrientationVerticale},clbckEchec:(aPromiseMsg) =>{this._actualiserSurErreurSaisie({liste:this.getInstance(this.identListe),promiseMsg:aPromiseMsg});}});} break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.avisProfesseur:this.moteur.saisieAvisProfesseur({paramRequete:{classe:lClasse,periode:this.getPeriode(),eleve:lLigne.eleve,service:this.getService(),avisProfesseur:lLigne.appAvisProfesseur},instanceListe:this.getInstance(this.identListe),clbckSucces:(aParamSucces) =>{const lDonneesListe=this.getInstance(this.identListe).getListeArticles();const lLignes=lDonneesListe.getListeElements((aLigne) =>{return aLigne.eleve.getNumero()===aParamSucces.numeroEleve;});const lLigne=lLignes.get(0);lLigne.appAvisProfesseur=aParamSucces.appAvisProfesseur;},paramCellSuivante:{orientationVerticale:this.estOrientationVerticale},clbckEchec:(aPromiseMsg) =>{this._actualiserSurErreurSaisie({liste:this.getInstance(this.identListe),promiseMsg:aPromiseMsg});}});break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.avisProfesseurParcoursup:this.moteur.saisieAvisProfesseurParcoursup({paramRequete:{eleve:lLigne.eleve,service:lLigne.service,appAvisProfParcoursup:lLigne.appAvisProfParcoursup},instanceListe:this.getInstance(this.identListe),clbckSucces:(aParamSucces) =>{const lDonneesListe=this.getInstance(this.identListe).getListeArticles();const lLignes=lDonneesListe.getListeElements((aLigne) =>{return aLigne.eleve.getNumero()===aParamSucces.numeroEleve;});const lLigne=lLignes.get(0);lLigne.appAvisProfParcoursup=aParamSucces.appAvisProfParcoursup;},paramCellSuivante:{orientationVerticale:this.estOrientationVerticale},clbckEchec:(aPromiseMsg) =>{this._actualiserSurErreurSaisie({liste:this.getInstance(this.identListe),promiseMsg:aPromiseMsg});}});break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.appreciationA:this._saisirAppreciation({appr:lLigne.appA,eleve:lLigne.eleve,service:lLigne.service,classe:lClasse});break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.appreciationB:this._saisirAppreciation({appr:lLigne.appB,eleve:lLigne.eleve,service:lLigne.service,classe:lClasse});break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.appreciationC:this._saisirAppreciation({appr:lLigne.appC,eleve:lLigne.eleve,service:lLigne.service,classe:lClasse});break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.appreciationReleve:this._saisirAppreciation({appr:lLigne.appReleve,eleve:lLigne.eleve,service:lLigne.service,classe:lClasse});break;default:break;} break;case Enumere_EvenementListe_1.EGenreEvenementListe.KeyUpListe:if(this.estColonnePositionnementEstVisible()){this._surKeyUpListe(aParametres.event);} return true;}} _surKeyUpListe(aEvent){const lNiveaux=this.parametresSco.listeNiveauxDAcquisitions&&this.parametresSco.listeNiveauxDAcquisitions.getListeElements((D) =>{return D.actifPour.contains(TypeGenreValidationCompetence_1.TypeGenreValidationCompetence.tGVC_Competence);});const lNiveau=UtilitaireCompetences_1.TUtilitaireCompetences.getNiveauAcqusitionDEventClavier(aEvent,lNiveaux,true);if(lNiveau){this._modifierNiveauDeSelectionCourante(lNiveau);}} _modifierNiveauDeSelectionCourante(aNiveau){if(!aNiveau){return;} const lListe=this.getInstance(this.identListe);const lListeElementsSelectionnes=lListe.getListeElementsSelection();if(lListeElementsSelectionnes.count()===0){return;} const lLigneEleve=lListeElementsSelectionnes.get(0);this._saisiePositionnementSurLigneEleve(lLigneEleve,aNiveau);} _saisiePositionnementSurLigneEleve(aLigneEleve,aNiveauDAcquisition,aAvecPassageLigneSuivante=true){if(aNiveauDAcquisition&&aLigneEleve.niveauAcquEditable){let lAvecChangement=false;const lListe=this.getInstance(this.identListe);const lParamsCallSuivante={orientationVerticale:this.estOrientationVerticale};if(!aLigneEleve.niveauAcqu&&aNiveauDAcquisition.getNumero()!==0){lAvecChangement=true;} else if(aLigneEleve.niveauAcqu&&aLigneEleve.niveauAcqu.getNumero()!==aNiveauDAcquisition.getNumero()){lAvecChangement=true;} if(lAvecChangement){const lClasse=this._getInfoClasseEleve(aLigneEleve);const lParamsMoteurSaisie={paramRequete:{estPourElementCompetence:false,positionnement:aNiveauDAcquisition,classe:lClasse,periode:this.getPeriode(),eleve:aLigneEleve.eleve,service:this.getService()},instanceListe:lListe,clbckSucces:(aParamSucces) =>{const lDonneesListe=this.getInstance(this.identListe).getListeArticles();const lLignes=lDonneesListe.getListeElements((aLigne) =>{return aLigne.estPere&&(aLigne.eleve.getNumero()===aParamSucces.numeroEleve);});const lLigne=lLignes.get(0);lLigne.niveauAcqu=aParamSucces.niveauAcquSaisi;},clbckEchec:(aPromiseMsg) =>{this._actualiserSurErreurSaisie({liste:this.getInstance(this.identListe),promiseMsg:aPromiseMsg});},paramCellSuivante:aAvecPassageLigneSuivante?lParamsCallSuivante:null};this.moteur.saisiePositionnement(lParamsMoteurSaisie);} else if(aAvecPassageLigneSuivante){this.moteurGrille.selectionCelluleSuivante({instanceListe:lListe,suivante:lParamsCallSuivante});}}} _basculerMoyNRDEleve(aLigneEleve){this.moteur.saisieMoyNR({paramRequete:{estMoyNR:!aLigneEleve.estMoyNR,periode:this.getPeriode(),eleve:aLigneEleve.eleve,service:this.getService()},instanceListe:this.getInstance(this.identListe),clbckSucces:(aParamSucces) =>{const lDonneesListe=this.getInstance(this.identListe).getListeArticles();const lLignes=lDonneesListe.getListeElements((aLigne) =>{return(aLigne&&aLigne.eleve?(aLigne.eleve.getNumero()===aParamSucces.numeroEleve):false);});const lLigne=lLignes.get(0);lLigne.estMoyNR=aParamSucces.estMoyNRSaisie;if((aParamSucces.estMoyAnnuelleNR!==null)&&(aParamSucces.estMoyAnnuelleNR!==undefined)){lLigne.estMoyAnnuelleNR=aParamSucces.estMoyAnnuelleNR;} this.getInstance(this.identListe).getDonneesListe().actualiserTotalMoyNR();},clbckEchec:() =>{}});} _getInfoClasse(){let lClasse=this.getClasse();if(lClasse!==null&&lClasse!==undefined&&lClasse.getNumero()!== -1&&lClasse.getGenre()!==Enumere_Ressource_1.EGenreRessource.Aucune){return lClasse;} else{let lService=this.getService();if(lService!==null&&lService!==undefined){let lClasseDuService=lService.classe;let lGpeDuService=lService.groupe;if(lGpeDuService&&lGpeDuService.existeNumero()){lGpeDuService.Genre=Enumere_Ressource_1.EGenreRessource.Groupe;return lGpeDuService;} else{if(lClasseDuService&&lClasseDuService.existeNumero()){lClasseDuService.Genre=Enumere_Ressource_1.EGenreRessource.Classe;return lClasseDuService;} else{}}}}} _getInfoClasseEleve(aLigne){if(aLigne&&aLigne.classe){return aLigne.classe;} else{return this._getInfoClasse();}} _actualiserSurErreurSaisie(aParam){const lSelection=aParam.liste.getSelectionCellule();this._actualiserDonnees();if((aParam.promiseMsg!==null)&&(aParam.promiseMsg!==undefined)){aParam.promiseMsg.then(() =>{if((lSelection!==null)&&(lSelection!==undefined)){aParam.liste.selectionnerCellule({ligne:lSelection.ligne,colonne:lSelection.colonne,avecScroll:true});}});}} _saisirAppreciation(aParam){this.saisieAppreciation({instanceListe:this.getInstance(this.identListe),estCtxPied:false,suivante:{orientationVerticale:this.estOrientationVerticale}},{classe:aParam.classe,periode:this.getPeriode(),eleve:aParam.eleve,service:aParam.service,appreciation:aParam.appr,typeGenreAppreciation:this.moteur.getTypeGenreAppreciation({estCtxPied:false,eleve:aParam.eleve,typeReleveBulletin:this.typeReleveBulletin,appreciation:aParam.appr})});} _ouvrirFenetreDetailJauges(aLigne){this.moteur.ouvrirFenetreDetailBarreNiveauxDAcquisition({instance:this.getInstance(this.fenetreDetailJauges),modeChronologique:this.param.modeChronologique,listePiliers:aLigne.listePiliers,eleve:aLigne.eleve,nbEvals:aLigne.nbEvals});} _masquerVisibilitePiedPage(aMasquer){} _afficherPiedPage(aParam){} _actionSurRecupererDonnees(aParam){this.desactiverImpression();if((aParam.message!==null)&&(aParam.message!==undefined)){this.evenementAfficherMessage(aParam.message);} else{this.donnees=aParam;this._masquerVisibilitePiedPage(false);this._afficherBulletin(aParam);this._afficherPiedPage(aParam);this._activerImpression();} this.afficherBandeau(true);} _activerImpression(){const lGenreImpression=this.moteur.getGenreImpression({typeReleveBulletin:this.typeReleveBulletin});Invocateur_1.Invocateur.evenement(Invocateur_2.ObjetInvocateur.events.activationImpression,lGenreImpression,this,lGenreImpression===Enumere_GenreImpression_1.EGenreImpression.GenerationPDF?this.getParametresPDF.bind(this):null);} getParametresPDF(){let lClasse=this._getInfoClasse();const lParam={genreGenerationPDF:this.moteur.getGenreGenerationPdf({typeReleveBulletin:this.typeReleveBulletin}),periode:this.getPeriode(),ressource:lClasse,service:this.getService(),modeChronologique:this.param.modeChronologique,avecAbreviationsNivAcquisition:(GParametres.afficherAbbreviationNiveauDAcquisition||GEtatUtilisateur.estAvecCodeCompetences())};const lDonneesListe=this.getInstance(this.identListe).getDonneesListe();if(lDonneesListe.param.avecSelectionPeriodePrec===true){$.extend(lParam,{periodePrec:lDonneesListe.param.periodePrecCourante});} else if(lDonneesListe.param.listePeriodesPrec&&lDonneesListe.param.listePeriodesPrec.count()>0){$.extend(lParam,{periodePrec:lDonneesListe.param.listePeriodesPrec.get(0)});} return lParam;} _getModeValidationAuto(aListeCols,aCol){const lInfosCol=this.moteur.getInfosCol(aListeCols,aCol);switch(aCol){case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.noteLSU:return lInfosCol.modeValidSigmaLSU;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.niveauAcqu:return lInfosCol.modeValidSigmaPos;} return null;} _getListeElevesPourValidationAuto(aDonnees,aCol){const lListeEleves=new ObjetListeElements_1.ObjetListeElements();aDonnees.parcourir((aLigne) =>{switch(aCol){case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.noteLSU:if(aLigne.noteLSUEditable){lListeEleves.addElement(aLigne.eleve);} break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.niveauAcqu:if(aLigne.niveauAcquEditable){lListeEleves.addElement(aLigne.eleve);} break;case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.ects:if(aLigne.estPere&&aLigne.ECTSEditable===true){const lElt=aLigne.eleve;lElt.classe=this._getInfoClasseEleve(aLigne);lElt.service=aLigne.service;lListeEleves.addElement(lElt);} break;}});return lListeEleves;} _surClbckCalculAutoLSU(){this._actualiserDonnees();} _afficherBulletin(aParam){const lDonneesListe=aParam.listeLignes;this.strInfoCloture=aParam.strInfoCloture||'';this.avecBoutonOrientationSaisie=!!aParam.avecBtnOrientationSaisie;let lFusionner=false;lDonneesListe.parcourir((aLigne) =>{if(!!aLigne.listePiliers){aLigne.listePiliers.parcourir((aPilierEleve) =>{aPilierEleve.listeNiveaux=UtilitaireCompetences_1.TUtilitaireCompetences.regroupeNiveauxDAcquisitions(aPilierEleve.listeNiveauxChronologiques);});} if(aLigne.estService&&aLigne.estPere){lFusionner=((aLigne.fusionAppr!==null)&&(aLigne.fusionAppr!==undefined))?aLigne.fusionAppr:false;} else{if(!aLigne.estService&&!aLigne.estPere){aLigne.fusionAppr=lFusionner;}}});const lParamDonneesListe={instanceListe:this.getInstance(this.identListe),listeColVisibles:aParam.listeColonnes,total:aParam.ligneTotal,typeReleveBulletin:this.typeReleveBulletin,tailleMaxAppreciation:this.moteur.getTailleMaxAppreciation({estCtxPied:false,typeReleveBulletin:this.typeReleveBulletin}),modeChronologique:this.param.modeChronologique,clbckJauge:() =>{this.param.modeChronologique=!this.param.modeChronologique;this.getInstance(this.identListe).getDonneesListe().param.modeChronologique=this.param.modeChronologique;this.getInstance(this.identListe).actualiser(true);if(this.etatUtilisateurSco.Navigation.fenetre_BarreNiveauxDAcquisitions_estAffiche){const lEleve=this.etatUtilisateurSco.Navigation.getRessource(Enumere_Ressource_1.EGenreRessource.Eleve);const lLignes=lDonneesListe.getListeElements((aLigne) =>{return(aLigne.eleve.getNumero()===lEleve.getNumero())&&aLigne.estService;});if(lLignes.count()>0){const lLigne=lLignes.get(0);this._ouvrirFenetreDetailJauges(lLigne);}}},clbckSigmaECTS:() =>{this.moteur.surBoutonCalculAutoECTS(this._getParamBtnCalculAutoECTS(lDonneesListe,aParam.listeColonnes));},clbckSigmaLSU:() =>{this.moteur.surBoutonCalculAuto(this._getParamBtnCalculAuto({donneesListe:lDonneesListe,col:DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.noteLSU,listeColonnes:aParam.listeColonnes}));},clbckSigmaPos:() =>{this.moteur.surBoutonCalculAuto(this._getParamBtnCalculAuto({donneesListe:lDonneesListe,col:DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.niveauAcqu,listeColonnes:aParam.listeColonnes}));},baremeNotationNiveau:(aParam.NoteBareme!==null)&&(aParam.NoteBareme!==undefined)?aParam.NoteBareme:GParametres.baremeNotation};const lInfosCol=this.moteur.getInfosCol(aParam.listeColonnes,DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.periodePrec);if(lInfosCol!==null){const lAvecComboSelectionPeriode=(aParam.listePeriodesPrec!==null)&&(aParam.listePeriodesPrec!==undefined)&&aParam.listePeriodesPrec.count()>1;$.extend(lParamDonneesListe,{avecSelectionPeriodePrec:lAvecComboSelectionPeriode,listePeriodesPrec:aParam.listePeriodesPrec,clbckSelectionPeriode:() =>{this.getInstance(this.identListe).actualiser(true);}});} this.listeAnnotations=aParam.listeAnnotations;this.getListeAnnotationsPourAvisReligion();this.getInstance(this.identListe).setDonnees(new DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin(lDonneesListe,lParamDonneesListe));this.selectionneEleveAutoDansPage();} _getParamBtnCalculAuto(aParam){const lCol=aParam.col;const lListeEleves=this._getListeElevesPourValidationAuto(aParam.donneesListe,lCol);const lInfosCol=this.moteur.getInfosCol(aParam.listeColonnes,lCol);switch(lCol){case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.niveauAcqu:case DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.noteLSU:return{listeEleves:lListeEleves,modeCalculAuto:this._getModeValidationAuto(aParam.listeColonnes,lCol),clbckCalculAuto:this._surClbckCalculAutoLSU.bind(this),messageValidationAutoPositionnementSelonDevoir:lInfosCol.messageValidationAutoPositionnementSelonDevoir};} return null;} _getParamBtnCalculAutoECTS(aLignesApprBulletin,aListeColonnes){const lCol=DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.ects;const lListeEleves=this._getListeElevesPourValidationAuto(aLignesApprBulletin,lCol);const lInfosCol=this.moteur.getInfosCol(aListeColonnes,lCol);return{seuilECTS:lInfosCol.seuilECTS,nbrECTSService:lInfosCol.nbECTSService,listeEleves:lListeEleves,periode:this.getPeriode(),instanceListe:this.getInstance(this.identListe),instance:this,clbckCalculAuto:this._surClbckCalculAutoLSU.bind(this)};} _evntSurAssistant(){this.moteurAssSaisie.evntBtnAssistant({instanceListe:this.getInstance(this.identListe),instancePied:null});} _evntSurFenetreAssistantSaisie(aNumeroBouton){const lParam={instanceFenetreAssistantSaisie:this.getInstance(this.identFenetreAssistantSaisie),eventcall:() =>{this.getInstance(this.identListe).actualiser(true);},evntClbck:this.surEvntAssSaisie.bind(this)};this.moteurAssSaisie.evenementAssistantSaisie(aNumeroBouton,lParam);} _validerAppreciation(aParam,aParamSaisie){const lContexte=aParamSaisie.contexte;if(this.moteurAssSaisie.avecAssistantSaisieActif({typeReleveBulletin:this.typeReleveBulletin})){this.moteurAssSaisie.validerDonneesSurValider({article:lContexte.article,appreciation:lContexte.appreciation,eltSelectionne:aParam.eltSelectionne});} this._saisirAppreciation({eleve:lContexte.article.eleve,service:lContexte.article.service,classe:this._getInfoClasseEleve(lContexte.article),appr:lContexte.appreciation});} surEvntAssSaisie(aParam){const lContexte=this.objCelluleAppreciation;const lListe=this.getInstance(this.identListe);if(lListe!==null&&lListe!==undefined){let lClbck;switch(aParam.cmd){case EBoutonFenetreAssistantSaisie_1.EBoutonFenetreAssistantSaisie.Valider:lClbck=() =>{this._validerAppreciation(aParam,{contexte:lContexte});};break;case EBoutonFenetreAssistantSaisie_1.EBoutonFenetreAssistantSaisie.PasserEnSaisie:lClbck=() =>{this.moteurAssSaisie.passerEnSaisie({instanceListe:lListe,idColonne:lContexte.idColonne});};break;case EBoutonFenetreAssistantSaisie_1.EBoutonFenetreAssistantSaisie.Fermer:lClbck=null;break;default:;} this.moteurAssSaisie.saisirModifAssSaisieAvantTraitement({estAssistantModifie:aParam.estAssistantModifie,pere:this,clbck:lClbck});}} _envoyerSaisiePropDelib(aParam){const lArticle=aParam.article;const lEstAvisReligion=(aParam.idCol===DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.avisReligionPropose)||(aParam.idCol===DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.avisReligionDeliberee);const lEstProposee=(aParam.idCol===DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.avisReligionPropose)||(aParam.idCol===DonneesListe_ApprBulletin_1.DonneesListe_ApprBulletin.colonnes.moyProposee);const lParamRequete={classe:this.getClasse(),periode:this.getPeriode(),eleve:lArticle.eleve,service:lArticle.service,estAvisReligion:lEstAvisReligion,estProposee:lEstProposee};if(lEstProposee){if(lEstAvisReligion){$.extend(lParamRequete,{avisReligionPropose:lArticle.avisReligionPropose});} else{$.extend(lParamRequete,{moyenneProposee:lArticle.moyenneProposee});}} else{if(lEstAvisReligion){$.extend(lParamRequete,{avisReligionDelibere:lArticle.avisReligionDelibere});} else{$.extend(lParamRequete,{moyenneProposee:lArticle.moyenneProposee,moyenneDeliberee:lArticle.moyenneDeliberee});}} this.moteur.saisieMoyPropDelib({paramRequete:lParamRequete,instanceListe:this.getInstance(this.identListe),clbckSucces:(aParamSucces) =>{const lDonneesListe=this.getInstance(this.identListe).getListeArticles();const lLignes=lDonneesListe.getListeElements((aLigne) =>{return(aLigne.eleve.getNumero()===aParamSucces.numeroEleve&&aLigne.service.getNumero()===aParamSucces.numeroService);});const lLigne=lLignes.get(0);if(lEstProposee){if(lEstAvisReligion){lLigne.avisReligionPropose=aParamSucces.avisReligionPropose;} else{lLigne.moyenneProposee=aParamSucces.moyenneProposee;}} else{if(lEstAvisReligion){lLigne.avisReligionDelibere=aParamSucces.avisReligionDelibere;} else{lLigne.moyenneDeliberee=aParamSucces.moyenneDeliberee;}}},paramCellSuivante:{orientationVerticale:this.estOrientationVerticale},clbckEchec:(aPromiseMsg) =>{this._actualiserSurErreurSaisie({liste:this.getInstance(this.identListe),promiseMsg:aPromiseMsg});}});}} exports._InterfaceSaisieApprReleveBulletin=_InterfaceSaisieApprReleveBulletin;