exports.ObjetFenetre_Correspondance=void 0;const MethodesObjet_1=require("MethodesObjet");const Enumere_Etat_1=require("Enumere_Etat");const Enumere_EvenementObjetSaisie_1=require("Enumere_EvenementObjetSaisie");const ObjetCelluleDate_1=require("ObjetCelluleDate");const ObjetDate_1=require("ObjetDate");const ObjetFenetre_1=require("ObjetFenetre");const ObjetTraduction_1=require("ObjetTraduction");const ObjetSaisiePN_1=require("ObjetSaisiePN");const ObjetCelluleBouton_1=require("ObjetCelluleBouton");const ObjetCelluleBouton_2=require("ObjetCelluleBouton");const Enumere_Event_1=require("Enumere_Event");const DonneesListe_SelectionDemandeur_1=require("DonneesListe_SelectionDemandeur");const ObjetFenetre_Liste_1=require("ObjetFenetre_Liste");const DonneesListe_Simple_FlatDesign_1=require("DonneesListe_Simple_FlatDesign");const Enumere_Ressource_1=require("Enumere_Ressource");const UtilitaireHtml_1=require("UtilitaireHtml");const ObjetListeElements_1=require("ObjetListeElements");const ObjetDroitsPN_1=require("ObjetDroitsPN");const Enumere_DocumentJoint_1=require("Enumere_DocumentJoint");const Enumere_BoiteMessage_1=require("Enumere_BoiteMessage");const Enumere_Action_1=require("Enumere_Action");const ObjetHtml_1=require("ObjetHtml");const UtilitaireUrl_1=require("UtilitaireUrl");const Enumere_Espace_1=require("Enumere_Espace");const ObjetFenetre_Correspondance_css_1=;const ObjetNavigateur_1=require("ObjetNavigateur");const AccessApp_1=require("AccessApp");const ObjetListe_1=require("ObjetListe");class ObjetFenetre_Correspondance extends ObjetFenetre_1.ObjetFenetre{constructor(...aParams){super(...aParams);this.avecDocuments=[Enumere_Espace_1.EGenreEspace.Professeur,Enumere_Espace_1.EGenreEspace.Mobile_Professeur].includes(GEtatUtilisateur.GenreEspace);this.applicationSco=(0,AccessApp_1.getApp)();this.idGroupeEnvoiReception=this.Nom+'_groupeEnvoiReception';this.idListeDocuments=this.Nom+'_documentsjoints';this.idLabelAuteur=this.Nom+'_labelAuteur';} construireInstances(){this.identDate=this.add(ObjetCelluleDate_1.ObjetCelluleDate,this.evenementSelecteurDate,this._initialiserSelecteurDate);this.identType=this.add(ObjetSaisiePN_1.ObjetSaisiePN,this.evenementComboType,this._initialiserComboType);this.identAuteur=this.add(ObjetCelluleBouton_1.ObjetCelluleBouton,this._evntAuteur,this._initAuteur);this.identFenetreAuteur=this.addFenetre(ObjetFenetre_Liste_1.ObjetFenetre_Liste,this._evntFenetreAuteur,this._initFenetreAuteur);} jsxModeleBoutonChoixInterlocuteur(){return{event:() =>{this._evenementBtnSelectionInterlocuteur();},getTitle:() =>{return ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.SelectionnerInterlocuteur');},getDisabled:() =>{return(!this.donneesSaisie||!this.donneesSaisie.listeInterlocuteurs||this.donneesSaisie.listeInterlocuteurs.count()<=1);}};} jsxModelInputInterlocuteur(){return{getValue:() =>{return!!this.correspondance?(this.correspondance.interlocuteur||''):'';},setValue:(aValue) =>{if(!!this.correspondance){this.correspondance.interlocuteur=aValue;}}};} jsxModelCommentaire(){return{getValue:() =>{return!!this.correspondance?(this.correspondance.commentaire||''):'';},setValue:(aValue) =>{if(!!this.correspondance){this.correspondance.commentaire=aValue;}}};} jsxIfAvecDocuments(){return this.avecDocuments;} getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{btnUpload:{getOptionsSelecFile:function(){return{genrePJ:Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier,genreRessourcePJ:Enumere_Ressource_1.EGenreRessource.DocJointEleve,interdireDoublonsLibelle:false,maxFiles:0,maxSize:aInstance.applicationSco.droits.get(ObjetDroitsPN_1.TypeDroits.tailleMaxDocJointEtablissement)};},addFiles:function(aElt){aInstance.listePJEleve.addElement(aElt.eltFichier);aInstance.correspondance.listePJ.addElement(aElt.eltFichier);aInstance.redessinerDocumentsFournis(aInstance.correspondance.listePJ);},getDisabled:function(){return false;},getLibelle(){return ObjetTraduction_1.GTraductions.getValeur('AjouterDesPiecesJointes');},getIcone(){return'icon_piece_jointe';}},chipsDocJoint:{eventBtn:function(aIndice){let lElement=aInstance.correspondance.listePJ?aInstance.correspondance.listePJ.get(aIndice):null;if(lElement){const message=IE.jsx.str("div",{"ie-ellipsis-fixe":true},ObjetTraduction_1.GTraductions.getValeur('selecteurPJ.msgConfirmPJ',[lElement.getLibelle()]));GApplication.getMessage().afficher({type:Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,message:message,callback:(aAccepte) =>{if(aAccepte===Enumere_Action_1.EGenreAction.Valider){lElement.setEtat(Enumere_Etat_1.EGenreEtat.Suppression);aInstance.redessinerDocumentsFournis(aInstance.correspondance.listePJ);}}});}}}});} redessinerDocumentsFournis(aListe){let lHTML='';if(aListe&&aListe.count()){lHTML=UtilitaireUrl_1.UtilitaireUrl.construireListeUrls(aListe,{separateur:' ',IEModelChips:'chipsDocJoint',genreRessource:Enumere_Ressource_1.EGenreRessource.DocJointEleve,argsIEModelChips:[],maxWidth:300});} ObjetHtml_1.GHtml.setHtml(this.idListeDocuments,lHTML,{controleur:this.controleur});} resetDonneesAffichage(){(this.getInstance(this.identType)).reset();} setDonnees(aCorrespondance,aDonneesSaisieCorrespondance,aListePJEleve){this.resetDonneesAffichage();this.donneesSaisie=aDonneesSaisieCorrespondance;this.correspondance=MethodesObjet_1.MethodesObjet.dupliquer(aCorrespondance);this.listePJEleve=MethodesObjet_1.MethodesObjet.dupliquer(aListePJEleve);$('#'+this.idGroupeEnvoiReception.escapeJQ()+' > input').off('change').on('change',this._evenementRadioDemiJournee.bind(this,true));if(aDonneesSaisieCorrespondance){this.getInstance(this.identType).setDonnees(aDonneesSaisieCorrespondance.listeTypes);let lLibelle='';if(this.correspondance.element&&this.correspondance.element.respAdmin&&this.correspondance.element.respAdmin.getGenre()!==Enumere_Ressource_1.EGenreRessource.Aucune){lLibelle=this.correspondance.element.respAdmin.getLibelle();}(this.getInstance(this.identAuteur)).setLibelle(lLibelle);this.getInstance(this.identAuteur).setActif(true);} if(aCorrespondance.getEtat()===1){this.correspondance.date=ObjetDate_1.GDate.getDateCourante();(this.getInstance(this.identType)).setSelectionParIndice(0);this.getInstance(this.identDate).setDonnees(this.correspondance.date);} else{this.getInstance(this.identDate).setDonnees(this.correspondance.date);} let lIndiceType;if(this.correspondance.type&&this.correspondance.type.getGenre()>0){lIndiceType=aDonneesSaisieCorrespondance.listeTypes.getIndiceParNumeroEtGenre(null,this.correspondance.type.Genre);} else{lIndiceType=aDonneesSaisieCorrespondance.listeTypes.getIndiceParLibelle(this.correspondance.Libelle);}(this.getInstance(this.identType)).setSelectionParIndice(lIndiceType?lIndiceType:0);$('#'+this.idGroupeEnvoiReception.escapeJQ()).find('input').removeAttr('checked');if(this.correspondance.getEtat()!==Enumere_Etat_1.EGenreEtat.Creation){$('#'+this.idGroupeEnvoiReception.escapeJQ()).find('input').inputDisabled(true);(this.getInstance(this.identType)).setActif(false);} if(!this.correspondance.listePJ){this.correspondance.listePJ=new ObjetListeElements_1.ObjetListeElements();} this.redessinerDocumentsFournis(this.correspondance.listePJ);let lTypeCorrespondance;if(this.correspondance){lTypeCorrespondance=this.correspondance.avecReponseCourrier;} $('#'+this.idGroupeEnvoiReception.escapeJQ()).find('input[value="'+lTypeCorrespondance+'"]').attr('checked','checked');this.afficher();} evenementComboType(aParams){if(aParams.genreEvenement===Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie.selection){this.correspondance.Libelle=aParams.element.getLibelle();this.correspondance.type=MethodesObjet_1.MethodesObjet.dupliquer(aParams.element);}} composeContenu(){const lGroupeRadiosBoutons={id:this.idGroupeEnvoiReception,ariaLabel:ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.TypeCorrespondance'),listeRadios:[{libelle:ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.Envoi'),value:false},{libelle:ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.Reponse'),value:true}],selectedValue:0};return IE.jsx.str("div",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.FenetreCorrespondance},IE.jsx.str("div",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.LigneFormulaire},UtilitaireHtml_1.UtilitaireHtml.composeGroupeRadiosBoutons(lGroupeRadiosBoutons)),IE.jsx.str("div",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.LigneFormulaire},IE.jsx.str("label",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.ZoneLibelleChamp},ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.TypeContact')),IE.jsx.str("div",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.ZoneChamp},IE.jsx.str("div",{id:this.getNomInstance(this.identType)}))),IE.jsx.str("div",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.LigneFormulaire},IE.jsx.str("label",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.ZoneLibelleChamp},ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.Date')),IE.jsx.str("div",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.ZoneChamp},IE.jsx.str("div",{id:this.getNomInstance(this.identDate),style:"width:100%;"}))),IE.jsx.str("div",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.LigneFormulaire},IE.jsx.str("label",{id:this.idLabelAuteur,class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.ZoneLibelleChamp},ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.Auteur')),IE.jsx.str("div",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.ZoneChamp},IE.jsx.str("div",{id:this.getNomInstance(this.identAuteur)}))),IE.jsx.str("div",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.LigneFormulaire},IE.jsx.str("label",{for:"inputInterlocuteur",class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.ZoneLibelleChamp},ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.Interlocuteur')),IE.jsx.str("div",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.ZoneChamp},IE.jsx.str("input",{id:"inputInterlocuteur",type:"text",class:['style-input',ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.inputInterlocuteur],"ie-model":this.jsxModelInputInterlocuteur.bind(this)}),IE.jsx.str("div",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.btnSelectInterlocuteurWrapper},IE.jsx.str("ie-btnicon",{"ie-model":this.jsxModeleBoutonChoixInterlocuteur.bind(this),class:"bt-activable icon_plus_cercle"})))),IE.jsx.str("label",{for:"textareaCommentaire",class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.ZoneCommentaire},ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.SaisirCommentaires')),IE.jsx.str("div",null,IE.jsx.str("textarea",{class:ObjetFenetre_Correspondance_css_1.StylesObjetFenetre_Correspondance.textareaCommentaire,"ie-model":this.jsxModelCommentaire.bind(this),id:"textareaCommentaire"})),IE.jsx.str("div",{class:"pj-global-conteneur m-y-l","ie-if":this.jsxIfAvecDocuments.bind(this)},IE.jsx.str("ie-btnselecteur",{"ie-model":"btnUpload","ie-selecfile":true,class:"pj",role:"button"}),IE.jsx.str("div",{class:"pj-liste-conteneur",id:this.idListeDocuments})));} surValidation(aNumeroBouton){this.callback.appel(aNumeroBouton,this.correspondance,this.listePJEleve);this.fermer();} _evenementRadioDemiJournee(aTypeCommunication){if(!!this.correspondance){this.correspondance.avecReponseCourrier=(aTypeCommunication===true);}} _initAuteur(aInstance){aInstance.setOptionsObjetCelluleBouton({ariaDescribedBy:this.idLabelAuteur,estSaisissable:false,avecZoneSaisie:false,genreBouton:ObjetCelluleBouton_2.EGenreBoutonCellule.Aucun,classTexte:'Gras',largeur:'100%',hauteur:17});} _initFenetreAuteur(aInstance){const lParamsListe={optionsListe:{hauteurAdapteContenu:true,hauteurMaxAdapteContenu:500,skin:ObjetListe_1.ObjetListe.skin.flatDesign,arialabel:ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.SelectionnerAuteur')}};const lInstance=this;aInstance.verifierActivationBtnValider=(aBouton) =>{let lBoutonActif=false;if(aBouton.element.index===0){return true;} lInstance.donneesSaisie.listePublic.parcourir((aElement) =>{if(aElement.selectionne){lBoutonActif=true;}});return lBoutonActif;};aInstance.setOptionsFenetre({titre:ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.SelectionnerAuteur'),largeur:400,hauteur:700,listeBoutons:[ObjetTraduction_1.GTraductions.getValeur('Annuler'),ObjetTraduction_1.GTraductions.getValeur('Valider')],modeActivationBtnValider:aInstance.modeActivationBtnValider.autre});aInstance.paramsListe=lParamsListe;} _evntAuteur(aGenreEvent){if((aGenreEvent===Enumere_Event_1.EEvent.SurKeyUp&&ObjetNavigateur_1.Navigateur.isToucheSelection())||(aGenreEvent===Enumere_Event_1.EEvent.SurMouseDown)){let lIndice= -1;this._resetPublic(lIndice);this.estSelectionSurveillant=true;this.getInstance(this.identFenetreAuteur).setDonnees(new DonneesListe_SelectionDemandeur_1.DonneesListe_SelectionDemandeur_Fd(this.donneesSaisie.listePublic),true);}} _evntFenetreAuteur(aGenreBouton,aSelection){if((aGenreBouton===1)&&this.correspondance){const lElm=this.donneesSaisie.listePublic.get(aSelection);this.correspondance.element.respAdmin=lElm;if(this.correspondance.element.respAdmin){this.correspondance.element.respAdmin.setEtat(Enumere_Etat_1.EGenreEtat.Modification);} let lLibelle='';if(this.correspondance.element&&this.correspondance.element.respAdmin){lLibelle=this.correspondance.element.respAdmin.getLibelle();}(this.getInstance(this.identAuteur)).setLibelle(lLibelle);}} _resetPublic(aIndiceSelection){const lIndice=aIndiceSelection;this.donneesSaisie.listePublic.parcourir((aPublic,aIndice) =>{if(aPublic.estUnDeploiement){aPublic.estDeploye=false;} if(aIndice===lIndice){if(aPublic.pere){aPublic.pere.estDeploye=true;}}});} _initialiserSelecteurDate(aInstance){aInstance.setOptionsObjetCelluleDate({largeurComposant:'100%'});} evenementSelecteurDate(aDate){if(!ObjetDate_1.GDate.estJourEgal(this.correspondance.date,aDate)){this.correspondance.setEtat(Enumere_Etat_1.EGenreEtat.Modification);this.correspondance.date=aDate;}} _initialiserComboType(aInstance){aInstance.setOptionsObjetSaisie({longueur:'100%',labelWAICellule:ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.TypeContact')});} _evenementBtnSelectionInterlocuteur(){const lListeInterlocuteurs=(!!this.donneesSaisie?this.donneesSaisie.listeInterlocuteurs:null);if(!!lListeInterlocuteurs&&!!this.correspondance){const lThis=this;const lFenetreListeInterlocuteurs=ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_Liste_1.ObjetFenetre_Liste,{pere:this,evenement:function(aNumeroBouton,aIndiceSelection){if(aNumeroBouton!== -1){const lInterlocuteurSelectionnee=lListeInterlocuteurs.get(aIndiceSelection);if(!!lInterlocuteurSelectionnee){lThis.correspondance.interlocuteur=lInterlocuteurSelectionnee.getLibelle();}}},initialiser:function(aInstance){const lParamsListe={optionsListe:{hauteurAdapteContenu:true,hauteurMaxAdapteContenu:500,skin:ObjetListe_1.ObjetListe.skin.flatDesign,ariaLabel:ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.SelectionnerInterlocuteur')}};aInstance.setOptionsFenetre({titre:ObjetTraduction_1.GTraductions.getValeur('FenetreCorrespondance.SelectionnerInterlocuteur'),largeur:300,hauteur:400,listeBoutons:[ObjetTraduction_1.GTraductions.getValeur('Annuler'),ObjetTraduction_1.GTraductions.getValeur('Valider')],avecTailleSelonContenu:true});aInstance.paramsListe=lParamsListe;}});lFenetreListeInterlocuteurs.setDonnees(new DonneesListe_Simple_FlatDesign_1.DonneesListe_Simple_Fd(lListeInterlocuteurs),true);}}} exports.ObjetFenetre_Correspondance=ObjetFenetre_Correspondance;