exports.FicheEditionInfoSond_Mobile=void 0;const MethodesObjet_1=require("MethodesObjet");const MoteurInfoSondage_1=require("MoteurInfoSondage");const ObjetIdentite_1=require("ObjetIdentite");const ObjetHtml_1=require("ObjetHtml");const GUID_1=require("GUID");const ObjetTraduction_1=require("ObjetTraduction");const Enumere_Etat_1=require("Enumere_Etat");const tag_1=require("tag");const Toast_1=require("Toast");const UtilitaireUrl_1=require("UtilitaireUrl");const Enumere_Action_1=require("Enumere_Action");const Enumere_BoiteMessage_1=require("Enumere_BoiteMessage");const ObjetDate_1=require("ObjetDate");const ObjetSelection_1=require("ObjetSelection");const MoteurDestinataires_1=require("MoteurDestinataires");const ObjetFenetre_1=require("ObjetFenetre");const FenetreEditionDestinatairesParEntites_1=require("FenetreEditionDestinatairesParEntites");const FenetreEditionDestinatairesParIndividus_1=require("FenetreEditionDestinatairesParIndividus");const Enumere_DocumentJoint_1=require("Enumere_DocumentJoint");const ObjetListeElements_1=require("ObjetListeElements");const ObjetCelluleDate_1=require("ObjetCelluleDate");const ObjetFenetre_ActionContextuelle_1=require("ObjetFenetre_ActionContextuelle");;const ObjetRequeteJSON_1=require("ObjetRequeteJSON");const Divers_css_1=;class FicheEditionInfoSond_Mobile extends ObjetFenetre_1.ObjetFenetre{constructor(){super(...arguments);this.id={titre:GUID_1.GUID.getId(),listePJ:GUID_1.GUID.getId(),nbEntiteClasse:GUID_1.GUID.getId(),nbEntiteGpe:GUID_1.GUID.getId(),nbIndividus:GUID_1.GUID.getId(),nbProfs:GUID_1.GUID.getId(),nbPersonnels:GUID_1.GUID.getId(),nbResponsables:GUID_1.GUID.getId()};this.forcerAR=false;} getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{avecBtnListeDiffusion(){return aInstance.avecListeDiffusion;},btnListeDiffusion:{event(){aInstance.surBtnListeDiffusion().then((aListeSelec) =>{if(aListeSelec&&aListeSelec.count()>0){aListeSelec.parcourir((aDiffusion) =>{aDiffusion.listePublicIndividu.parcourir((aElement) =>{if(!aInstance.donnee.listePublicIndividu.getElementParElement(aElement)){aInstance.donnee.listePublicIndividu.addElement(MethodesObjet_1.MethodesObjet.dupliquer(aElement));aInstance.donnee.avecModificationPublic=true;}});});aInstance.updateCompteursDestinataires();}});}},getEntiteClasse:{getLibelle(){return`${ObjetTraduction_1.GTraductions.getValeur('infoSond.parClasses')}<span class="strNumber" id="${aInstance.id.nbEntiteClasse}"> (0) </span> ${ObjetTraduction_1.GTraductions.getValeur('infoSond.ouGroupes')}<span class="strNumber" id="${aInstance.id.nbEntiteGpe}"> (0) </span>`;},getIcone(){return`icon_group`;}},getSelectRessource:{getIcone(){return`icon_group`;}},nodeSelectDestParEntite:function(){$(this.node).on('click',function(){const lFenetre=ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(FenetreEditionDestinatairesParEntites_1.FenetreEditionDestinatairesParEntites,{pere:aInstance,evenement:function(aNumeroBouton,aDonnees){if(aNumeroBouton===1){aInstance.donnee=aDonnees.donnee;aInstance.updateCompteursDestinataires();}},initialiser:function(aInstanceFenetre){aInstanceFenetre.setUtilitaires(aInstance.utilitaires);aInstanceFenetre.setOptions({avecCBElevesRattaches:aInstance.options?aInstance.options.avecCBElevesRattaches:false});aInstanceFenetre.setOptionsFenetre({modale:true,titre:ObjetTraduction_1.GTraductions.getValeur('destinataires.destsParEntites'),listeBoutons:[ObjetTraduction_1.GTraductions.getValeur('Annuler'),ObjetTraduction_1.GTraductions.getValeur('Valider')]});}});lFenetre.setDonnees({donnee:aInstance.donnee});});},getIndividu:{getLibelle(){return`${ObjetTraduction_1.GTraductions.getValeur('infoSond.aTitreIndiv')}<span class="strNumber" id="${aInstance.id.nbIndividus}"> (0)</span>`;},getIcone(){return`icon_user`;}},nodeSelectDestParIndiv:function(){$(this.node).on('click',function(){const lFenetre=ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(FenetreEditionDestinatairesParIndividus_1.FenetreEditionDestinatairesParIndividus,{pere:aInstance,evenement:function(aNumeroBouton,aDonnees){if(aNumeroBouton===1){aInstance.donnee=aDonnees.donnee;aInstance.updateCompteursDestinataires();}},initialiser:function(aInstanceFenetre){aInstanceFenetre.setUtilitaires(aInstance.utilitaires);aInstanceFenetre.setOptions({avecGestionEleves:aInstance.options?aInstance.options.avecGestionEleves:true,avecGestionPersonnels:aInstance.options?aInstance.options.avecGestionPersonnels:true,avecGestionStages:aInstance.options?aInstance.options.avecGestionStages:true,avecGestionIPR:aInstance.options?aInstance.options.avecGestionIPR:true});aInstanceFenetre.avecListeDiffusion=aInstance.avecListeDiffusion;aInstanceFenetre.surBtnListeDiffusion=aInstance.surBtnListeDiffusion;aInstanceFenetre.setOptionsFenetre({modale:true,titre:ObjetTraduction_1.GTraductions.getValeur('destinataires.destsATitreIndiv'),listeBoutons:[ObjetTraduction_1.GTraductions.getValeur('Annuler'),ObjetTraduction_1.GTraductions.getValeur('Valider')]});}});lFenetre.setDonnees({donnee:aInstance.donnee});});},nodeSelectDest_RespToResp:function(){$(this.node).on('click',function(){aInstance.openModaleSelectionPublic({genreRessource:aInstance.utilitaires.genreRessource.getRessourceClasse(),listePublicDonnee:aInstance.donnee.listePublicIndividu,clbck:function(aParam){aInstance.donnee.listePublicIndividu=aParam.listePublicDonnee;aInstance.donnee.avecModificationPublic=aParam.avecModificationPublic;aInstance.updateCompteursDestinataires();}});});},nodeSelectDestPrimaire_RespClasses:function(aGenreRessource){$(this.node).on('click',function(){aInstance.openModaleSelectRespClasses({genreRessource:aGenreRessource,donnee:aInstance.donnee,clbck:() =>{aInstance.utilitaires.moteurDestinataires.surSelectEntitesPrimaireRespClasses({donnee:aInstance.donnee});aInstance.updateCompteursDestinataires();}});});},nodeSelectDestPrimaire_Public:function(aGenreRessource){$(this.node).on('click',function(){aInstance.openModaleSelectionPublic({genreRessource:aGenreRessource,listePublicDonnee:aInstance.donnee.listePublicIndividu,clbck:function(aParam){aInstance.donnee.listePublicIndividu=aParam.listePublicDonnee;aInstance.donnee.avecModificationPublic=aParam.avecModificationPublic;aInstance.updateCompteursDestinataires();}});});},cbPrimaire_Directeur:{getValue:function(){return aInstance.donnee.avecDirecteur;},setValue:function(aValue){aInstance.donnee.avecDirecteur=aValue;aInstance.donnee.avecModificationPublic=true;},getDisabled:function(){return false;}},nodeTitre:function(){$(this.node).on('focusin',function(){ObjetHtml_1.GHtml.setSelectionEdit(aInstance.id.titre);});},titre:{getValue:function(){return(aInstance.donnee!==null&&aInstance.donnee!==undefined)?aInstance.donnee.getLibelle():'';},setValue:function(aValue){aInstance.donnee.setLibelle(aValue);},getDisabled:function(){return aInstance.donnee.estVerrouille;},node:function(){$(this.node).attr('placeholder',ObjetTraduction_1.GTraductions.getValeur('infoSond.redigerTitre'));}},contenu:{getValue:function(){return aInstance.getValueContenu();},setValue:function(aValue){aInstance.setValueContenu(aValue);},getDisabled:function(){return aInstance.donnee.estVerrouille;}},cbAR:{getValue:function(){let lResult=false;if((aInstance.donnee!==null)&&(aInstance.donnee!==undefined)&&(aInstance.donnee.estInformation)&&(aInstance.donnee.listeQuestions.getNbrElementsExistes()>0)){const lContenu=aInstance.donnee.listeQuestions.getPremierElement();lResult=lContenu.avecAR;} return lResult;},setValue:function(){if((aInstance.donnee!==null)&&(aInstance.donnee!==undefined)&&(aInstance.donnee.estInformation)&&(aInstance.donnee.listeQuestions.getNbrElementsExistes()>0)){const lContenu=aInstance.donnee.listeQuestions.getPremierElement();lContenu.avecAR=!lContenu.avecAR;lContenu.setEtat(Enumere_Etat_1.EGenreEtat.Modification);}},getDisabled:function(){return((aInstance.donnee!==null)&&(aInstance.donnee!==undefined))?!aInstance.donnee.estInformation:true;}},selecteurPJ:function(){$(this.node).on('click',function(){if((aInstance.donnee!==null)&&(aInstance.donnee!==undefined)&&(aInstance.donnee.estInformation)&&(aInstance.donnee.listeQuestions.getNbrElementsExistes()>0)){const lContenu=aInstance.donnee.listeQuestions.getPremierElement();aInstance._evntSurEditPJ({instance:aInstance,element:aInstance.donnee,genre:Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier,listePiecesJointes:aInstance.listePJ,listePJContexte:lContenu.listePiecesJointes,maxSize:aInstance.maxSizePJ,listePeriodes:null,dateCoursDeb:null,validation:function(aParamsFenetre,aListeFichiers,aAvecSaisie){if(aAvecSaisie&&aInstance.donnee!==null&&aInstance.donnee!==undefined&&aInstance.donnee.estInformation&&(aInstance.donnee.listeQuestions.getNbrElementsExistes()>0)){if(aListeFichiers){aInstance.listePJCree.add(aListeFichiers);} const lContenu=aInstance.donnee.listeQuestions.getPremierElement();lContenu.setEtat(Enumere_Etat_1.EGenreEtat.Modification);} aInstance.actualiserListePJ();}});}});},btnPJ:{getIcone(){return'icon_piece_jointe';},getLibelle(){return ObjetTraduction_1.GTraductions.getValeur('infoSond.ajouterPJ');}},chipsPJ:{eventBtn:function(aIndice){if((aInstance.donnee!==null)&&(aInstance.donnee!==undefined)&&(aInstance.donnee.estInformation)&&(aInstance.donnee.listeQuestions.getNbrElementsExistes()>0)){const lContenu=aInstance.donnee.listeQuestions.getPremierElement();const lPJ=lContenu.listePiecesJointes.get(aIndice);if(lPJ){GApplication.getMessage().afficher({type:Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,message:ObjetTraduction_1.GTraductions.getValeur('selecteurPJ.msgConfirmPJ',[lPJ.getLibelle()]),callback:function(aAccepte){if(aAccepte!==Enumere_Action_1.EGenreAction.Valider){return;} lPJ.setEtat(Enumere_Etat_1.EGenreEtat.Suppression);lContenu.setEtat(Enumere_Etat_1.EGenreEtat.Modification);ObjetHtml_1.GHtml.setHtml(aInstance.id.listePJ,aInstance._construireHtmlListePJ(),aInstance.controleur);}});}}}},radioPublication:{getValue:function(aBool){return!!aInstance.donnee&&(aInstance.donnee.publie===aBool);},setValue:function(aBool){aInstance.donnee.publie=aBool;aInstance.instanceCalendrierDebPublication.setActif(!!aInstance.donnee.publie);aInstance.instanceCalendrierFinPublication.setActif(!!aInstance.donnee.publie);}},cbPublicationPageEtablissement:{getValue(){return!!aInstance.donnee&&aInstance.donnee.estInformation&&!!aInstance.donnee.publicationPageEtablissement;},setValue(aValue){if(!!aInstance.donnee&&aInstance.donnee.estInformation){aInstance.donnee.publicationPageEtablissement=aValue;}},getDisabled(){return!aInstance.donnee||!aInstance.donnee.publie;}},pourPageEtablissement:function(){if(aInstance.options.avecPublicationPageEtablissement&&!!aInstance.donnee&&aInstance.donnee.estInformation&&!aInstance.donnee.estModele&&!aInstance.pourPunitionIncident){return true;} return false;}});} setUtilitaires(aUtilitaires){this.utilitaires=aUtilitaires;this.moteurCP=new MoteurInfoSondage_1.MoteurInfoSondage(this.utilitaires);this.moteurDestinataires=new MoteurDestinataires_1.MoteurDestinataires(this.utilitaires);} construireInstances(){this.instanceCalendrierDebPublication=this.instancierCalendrier((aDate) =>{if(this.donnee.publie===true&&!ObjetDate_1.GDate.estJourEgal(aDate,this.donnee.dateDebut)){this.donnee.dateDebut=aDate;if(this.donnee.dateDebut>this.donnee.dateFin){this.donnee.dateFin=this.donnee.dateDebut;this.instanceCalendrierFinPublication.setDonnees(this.donnee.dateFin);}}},this);this.instanceCalendrierFinPublication=this.instancierCalendrier((aDate) =>{if(this.donnee.publie===true&&!ObjetDate_1.GDate.estJourEgal(aDate,this.donnee.dateFin)){this.donnee.dateFin=aDate;if(this.donnee.dateFin<this.donnee.dateDebut){this.donnee.dateDebut=this.donnee.dateFin;this.instanceCalendrierDebPublication.setDonnees(this.donnee.dateDebut);}}},this);this.instanceSelectCategorie=this.instancierSelecteur((aParam) =>{this.donnee.categorie=aParam.element;},this,{avecBoutonsPrecedentSuivant:false,labelWAICellule:ObjetTraduction_1.GTraductions.getValeur('infoSond.categorie')});} composeDate(aParam){const H=[];H.push('<div id="',aParam.id,'" class="',aParam.classCss,'"></div>');return H.join('');} composeSelecteur(aParam){const H=[];H.push('<label class="ie-titre-petit">',ObjetTraduction_1.GTraductions.getValeur('infoSond.categorie'),'</label>');H.push('<div id="',aParam.id,'" class="',aParam.classCss,'"></div>');return H.join('');} updateContenu(){this.instanceCalendrierDebPublication.initialiser();this.instanceCalendrierDebPublication.setDonnees(this.donnee.dateDebut);this.instanceCalendrierDebPublication.setActif(!!this.donnee.publie);this.instanceCalendrierFinPublication.initialiser();this.instanceCalendrierFinPublication.setDonnees(this.donnee.dateFin);this.instanceCalendrierFinPublication.setActif(!!this.donnee.publie);this.updateSelecteur({liste:this.listeCategories,donnee:this.donnee.categorie,instanceSelect:this.instanceSelectCategorie});this.updateCompteursDestinataires();} instancierCalendrier(aEvnt,aPere){const lInstance=ObjetIdentite_1.Identite.creerInstance(ObjetCelluleDate_1.ObjetCelluleDate,{pere:aPere,evenement:aEvnt.bind(aPere)});lInstance.setParametresFenetre(window.GParametres.PremierLundi,ObjetDate_1.GDate.getJourSuivant(window.GParametres.PremiereDate,-100),ObjetDate_1.GDate.getJourSuivant(window.GParametres.DerniereDate,100));return lInstance;} instancierSelecteur(aEvnt,aPere,aParam){const lInstance=ObjetIdentite_1.Identite.creerInstance(ObjetSelection_1.ObjetSelection,{pere:aPere,evenement:aEvnt.bind(aPere)});lInstance.setParametres(aParam);return lInstance;} updateSelecteur(aParam){if(aParam.liste){let lIndiceParDefaut=0;const lDonnee=aParam.donnee;if(lDonnee!==null&&lDonnee!==undefined){lIndiceParDefaut=aParam.liste.getIndiceElementParFiltre((aElt) =>{if(aParam.comparerGenre===true){return aElt.getGenre()===lDonnee.getGenre();} else{return(aElt.getNumero()===lDonnee.getNumero());}});} aParam.instanceSelect.setDonnees(aParam.liste,lIndiceParDefaut);}} setOptions(aOptions){this.options=aOptions;return this;} setDonnees(aParam){Promise.resolve().then(() =>{return this.utilitaires.moteurGestionPJ.getDonneesEditionInformation();}).then((aDonnees) =>{this.listePJCree=new ObjetListeElements_1.ObjetListeElements();this.listePJ=this.utilitaires.moteurGestionPJ.getListePJEtablissement();this.maxSizePJ=aParam.maxSizePJ;this.listeCategories=aDonnees.listeCategories;this.indiceCategorieParDefaut=this.listeCategories.getIndiceElementParFiltre((aElement) =>{return aElement.estDefaut;});if(this.indiceCategorieParDefaut=== -1){this.indiceCategorieParDefaut=0;} if(aParam.forcerAR!==null&&aParam.forcerAR!==undefined){this.forcerAR=aParam.forcerAR;} if((aParam.donnee!==null)&&(aParam.donnee!==undefined)){this.donneeOrigine=aParam.donnee;} else{this.donneeOrigine=this.moteurCP.initialiserNouveauItem({categorie:this.listeCategories.get(this.indiceCategorieParDefaut),genresPublic:aParam.genresPublic,listePublic:(aParam.cours&&aParam.date)?aDonnees.listeEleves:(aParam.listePublic?aParam.listePublic:(aDonnees&&aDonnees.listePublic?aDonnees.listePublic:undefined)),genreReponse:aParam.genreReponse,estInformation:aParam.estInfo,dateFinDerniereDate:true,publie:aParam.publie});} this.donnee=MethodesObjet_1.MethodesObjet.dupliquer(this.donneeOrigine);this.afficher(this.composeContenu());this.updateContenu();if(this._estCasParentsDelegues()){this.utilitaires.moteurDestinataires.automatiserSelectionPublic({genreRessource:this.utilitaires.genreRessource.getRessourceClasse(),donnee:this.donnee,clbck:() =>{this.updateCompteursDestinataires();}});}});} composeContenu(){return this.construireHtml();} updateCompteursDestinataires(){const lNbClasses=this.donnee.listePublicEntite.getListeElements((D) =>{return D.getGenre()===this.utilitaires.genreRessource.getRessourceClasse();}).getNbrElementsExistes();ObjetHtml_1.GHtml.setHtml(this.id.nbEntiteClasse,this._construireHtmlNb(lNbClasses));const lNbGpe=this.donnee.listePublicEntite.getListeElements((D) =>{return D.getGenre()===this.utilitaires.genreRessource.getRessourceGroupe();}).getNbrElementsExistes();ObjetHtml_1.GHtml.setHtml(this.id.nbEntiteGpe,this._construireHtmlNb(lNbGpe));if(this.utilitaires.genreEspace.estPourPrimaire()){const lNbResponsables=this.donnee.listePublicIndividu.getListeElements((D) =>{return D.getGenre()===this.utilitaires.genreRessource.getRessourceParent();}).getNbrElementsExistes();ObjetHtml_1.GHtml.setHtml(this.id.nbResponsables,this._construireHtmlNb(lNbResponsables));const lNbProfs=this.donnee.listePublicIndividu.getListeElements((D) =>{return D.getGenre()===this.utilitaires.genreRessource.getRessourceProf();}).getNbrElementsExistes();ObjetHtml_1.GHtml.setHtml(this.id.nbProfs,this._construireHtmlNb(lNbProfs));const lNbPersonnels=this.donnee.listePublicIndividu.getListeElements((D) =>{return D.getGenre()===this.utilitaires.genreRessource.getRessourcePersonnel();}).getNbrElementsExistes();ObjetHtml_1.GHtml.setHtml(this.id.nbPersonnels,this._construireHtmlNb(lNbPersonnels));} else if(this._estCasParentsDelegues()){const lNbResponsables=this.donnee.listePublicIndividu.getListeElements((D) =>{return D.getGenre()===this.utilitaires.genreRessource.getRessourceClasse();}).getNbrElementsExistes();ObjetHtml_1.GHtml.setHtml(this.id.nbResponsables,this._construireHtmlNb(lNbResponsables));} else{const lNbIndiv=this.donnee.listePublicIndividu.getNbrElementsExistes();ObjetHtml_1.GHtml.setHtml(this.id.nbIndividus,this._construireHtmlNb(lNbIndiv));}} construireHtml(){const H=[];let lSansBordure=(this.options.avecPublicationPageEtablissement&&!!this.donnee&&this.donnee.estInformation&&!this.donnee.estModele&&!this.pourPunitionIncident);H.push('<div class="FicheEditionInfoSond_Mobile">');if((this.donnee!==null)&&(this.donnee!==undefined)){H.push('<div class="field-contain">');H.push(this._construireHtmlDestinataires());H.push('</div>');if(!this.donnee.estVerrouille){H.push('<div class="field-contain">');H.push(this.composeSelecteur({id:this.instanceSelectCategorie.getNom(),classCss:''}));H.push('</div>');H.push('<div class="field-contain">');const lLibelleTitre=ObjetTraduction_1.GTraductions.getValeur('infoSond.libelleTitre');H.push('<label class="ie-titre-petit">',lLibelleTitre,'</label>');H.push(this.moteurCP.composeFormText({id:this.id.titre,node:'nodeTitre',model:'titre',classCss:'',ariaLabel:lLibelleTitre}));H.push('</div>');if((this.donnee.estInformation)&&(this.donnee.listeQuestions.getNbrElementsExistes()>0)){H.push('<div class="field-contain">');H.push('<label class="ie-titre-petit">',ObjetTraduction_1.GTraductions.getValeur('infoSond.Contenu'),'</label>');H.push((0,tag_1.tag)('div',{contenteditable:'true','ie-model':'contenu',class:['contenteditable_index','as-textarea'],placeholder:ObjetTraduction_1.GTraductions.getValeur('infoSond.redigerContenuInfo')},''));if(this.avecBtnSignature()){H.push(IE.jsx.str("div",{class:[Divers_css_1.StylesDivers.flexContain,Divers_css_1.StylesDivers.justifyEnd,Divers_css_1.StylesDivers.mTopL]},IE.jsx.str("ie-bouton",{"ie-model":this.jsxModelBoutonSignature.bind(this),"ie-icon":"icon_signature",class:"themeBoutonNeutre"},ObjetTraduction_1.GTraductions.getValeur('actualites.HintAjouterSignature'))));} H.push();H.push('</div>');H.push('<div class="pj-global-conteneur p-x-l m-bottom-l">');H.push('<ie-btnselecteur ',ObjetHtml_1.GHtml.composeAttr('ie-node','selecteurPJ',[]),' ie-model="btnPJ" class="pj" role="button">');H.push('</ie-btnselecteur>');H.push(`<div class="pj-liste-conteneur" id="${this.id.listePJ}">`,this._construireHtmlListePJ(),'</div>');H.push('</div>');}} else{H.push('<div class="taille-m item msgContenuNonModifiable">',ObjetTraduction_1.GTraductions.getValeur('actualites.Edition.NonModifiable'),'</div>');} if(this.forcerAR!==true){H.push('<div class="field-contain">');H.push('<ie-checkbox class="first-capitalize" ie-model="cbAR">',ObjetTraduction_1.GTraductions.getValeur('actualites.Edition.AvecAR'),'</ie-checkbox>');H.push('</div>');} H.push(`<div class="field-contain flex-contain cols flex-gap-l">`);H.push('<ie-radio ie-model="radioPublication(false)" class="itemPublication">',ObjetTraduction_1.GTraductions.getValeur('actualites.NonPubliee'),'</ie-radio>');H.push('<ie-radio ie-model="radioPublication(true)" class="itemPublication last">',ObjetTraduction_1.GTraductions.getValeur('actualites.Publier'),'</ie-radio>');H.push(`</div>`);IE.log.addLog(`Message ${lSansBordure}`);H.push(`<div class="field-contain ${lSansBordure?``:`no-line`} flex-contain flex-center flex-gap">`);H.push('<span>',ObjetTraduction_1.GTraductions.getValeur('Du'),'</span>');H.push(this.composeDate({id:this.instanceCalendrierDebPublication.getNom()}));H.push('<span>',ObjetTraduction_1.GTraductions.getValeur('Au'),'</span>');H.push(this.composeDate({id:this.instanceCalendrierFinPublication.getNom()}));H.push('</div>');H.push('<div class="field-contain" ie-display="pourPageEtablissement">');H.push('<ie-checkbox ie-model="cbPublicationPageEtablissement">',ObjetTraduction_1.GTraductions.getValeur('actualites.Edition.publicationPageEtablissement'),'</ie-checkbox>');H.push('</div>');H.push('</div>');} H.push('</div>');return H.join('');} openModaleSelectRespClasses(aParam){this.utilitaires.moteurDestinataires.ouvrirModaleSelectionRessource(aParam);} openModaleSelectionPublic(aParam){this.utilitaires.moteurDestinataires.ouvrirModaleSelectionPublic(aParam);} surValidation(aGenreBouton){const lEstValidation=(aGenreBouton===1);if(lEstValidation){const lControleContenu=this._controlerContenu();if(!lControleContenu){Toast_1.Toast.afficher({msg:ObjetTraduction_1.GTraductions.getValeur('actualites.MsgAucunContenu'),type:Toast_1.ETypeToast.info});return;} if(!!this.donnee.publie){const lControleDetinataires=this.moteurDestinataires.controlerSurValidation({donnee:this.donnee});if(!lControleDetinataires){return;}} this.donnee.setEtat(this.moteurCP.verifierEtatModification({donnee:this.donnee,donneeOrigine:this.donneeOrigine}));} if(lEstValidation){this.toastMessage=ObjetTraduction_1.GTraductions.getValeur('actualites.PublicationEffective');if(this.donnee.publie===false){this.toastMessage=ObjetTraduction_1.GTraductions.getValeur('actualites.BrouillonEnregistre');} this.moteurCP.validerEdition({donnee:this.donnee,listePJ:this.listePJ,envoyerRequete:(aObjetSaisie) =>{this.envoyerRequete({listePJ:this.listePJ,listePJCree:this.listePJCree,paramRequete:aObjetSaisie,clbckSurReussite:this.finaliserValidation.bind(this)});}});} else{this.finaliserValidation(aGenreBouton);}} finaliserValidation(aGenreBouton,aJSONReponse,aJSONRapport){if(!!aJSONReponse&&aJSONReponse===ObjetRequeteJSON_1.EGenreReponseSaisie.succes){Toast_1.Toast.afficher({msg:this.toastMessage,type:Toast_1.ETypeToast.succes});} this.fermer();const lParam={donnee:(aGenreBouton===0?this.donneeOrigine:this.donnee),eltCree:aJSONRapport!==null&&aJSONRapport!==undefined&&aJSONRapport.infoSondCree!==null&&aJSONRapport.infoSondCree!==undefined?aJSONRapport.infoSondCree:null};this.callback.appel(aGenreBouton,lParam);} _evntSurEditPJ(aParam){const lAvecCloud=GEtatUtilisateur.avecCloudDisponibles();const lTabActions=[];lTabActions.push({libelle:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.piecesJointes.FichierParmiUtilises'),icon:'icon_file_alt',event:() =>{this.utilitaires.moteurGestionPJ.ouvrirModaleSelectionPJ(aParam);},class:'bg-green-claire'});if(lAvecCloud){lTabActions.push({libelle:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.piecesJointes.FichierDepuisCloud'),icon:'icon_cloud',event:() =>{this.utilitaires.moteurGestionPJ.ouvrirFenetreChoixListeCloud(aParam);},class:'bg-orange-claire'});if(GEtatUtilisateur.avecCloudENEJDisponible()){const lActionENEJ=ObjetFenetre_ActionContextuelle_1.ObjetFenetre_ActionContextuelle.getActionENEJ(() =>{this.utilitaires.moteurGestionPJ.ouvrirFenetreChoixFichierCloud(Object.assign(Object.assign({},aParam),{service:GEtatUtilisateur.getCloudENEJ()}));});if(lActionENEJ){lTabActions.push(lActionENEJ);}}} ObjetFenetre_ActionContextuelle_1.ObjetFenetre_ActionContextuelle.ouvrir(lTabActions,{pere:this});} actualiserListePJ(){ObjetHtml_1.GHtml.setHtml(this.id.listePJ,this._construireHtmlListePJ(),this.controleur);} jsxModelBoutonSignature(){return{event:() =>{const lSignature=this.options.strSignature;const lContent=this.getValueContenu();this.setValueContenu(lContent?lContent+lSignature:lSignature);},getDisabled:() =>{return this.donnee.estVerrouille;}};} _estCasParentsDelegues(){return this.utilitaires.genreEspace.estEspaceParent(GEtatUtilisateur.GenreEspace);} _construireHtmlListePJ(){const H=[];const lQuestion=this.donnee.listeQuestions.getPremierElement();H.push(UtilitaireUrl_1.UtilitaireUrl.construireListeUrls(lQuestion.listePiecesJointes,{IEModelChips:'chipsPJ'}));return H.join('');} _construireHtmlNb(aNb){return' ('+aNb+') ';} _construireHtmlDestinataires(){const H=[];const lIdLabel=GUID_1.GUID.getId();H.push('<label id="',lIdLabel,'" class="ie-titre-petit">',ObjetTraduction_1.GTraductions.getValeur('infoSond.destinataires'),'</label>');if(this.utilitaires.genreEspace.estPourPrimaire()){H.push('<div class="m-bottom-l" ie-if="avecBtnListeDiffusion"><ie-bouton class="small-bt themeBoutonNeutre" ie-model="btnListeDiffusion">',ObjetTraduction_1.GTraductions.getValeur('listeDiffusion.btnListeDiffusion'),'</ie-bouton></div>');H.push(this.utilitaires.moteurDestinataires.construireHtmlDestPrimaireResponsables({node:'nodeSelectDestPrimaire_Public',idCompteur:this.id.nbResponsables}));H.push(this.utilitaires.moteurDestinataires.construireHtmlDestPrimaireProfs({node:'nodeSelectDestPrimaire_Public',idCompteur:this.id.nbProfs}));H.push(this.utilitaires.moteurDestinataires.construireHtmlDestPrimairePersonnels({node:'nodeSelectDestPrimaire_Public',idCompteur:this.id.nbPersonnels}));H.push(this.utilitaires.moteurDestinataires.construireHtmlDestPrimaireDirecteur({node:'cbPrimaire_Directeur',str:ObjetTraduction_1.GTraductions.getValeur('actualites.Directeur')}));} else if(this._estCasParentsDelegues()){H.push(this.utilitaires.moteurDestinataires.construireHtmlDestRespToResp({node:'nodeSelectDest_RespToResp',idCompteur:this.id.nbResponsables}));} else{H.push(`<ie-btnselecteur class="m-bottom" ie-model="getEntiteClasse" ie-node="nodeSelectDestParEntite()" aria-labelledby="${lIdLabel}"></ie-btnselecteur>`);H.push(`<ie-btnselecteur ie-model="getIndividu" ie-node="nodeSelectDestParIndiv()" aria-labelledby="${lIdLabel}"></ie-btnselecteur>`);} return H.join('');} _controlerContenu(){let lEstContenuVide=false;if((this.donnee!==null)&&(this.donnee!==undefined)&&(this.donnee.estInformation)&&(this.donnee.listeQuestions.getNbrElementsExistes()>0)){const lContenu=this.donnee.listeQuestions.getPremierElement();const lStr=lContenu.texte.trim();const lContenuEscape=$(ObjetHtml_1.GHtml.htmlToDOM((0,tag_1.tag)('div',lStr))).text().trim();lEstContenuVide=(lContenuEscape==='');} return!lEstContenuVide;} avecBtnSignature(){var _a;return!!this.options.strSignature&&((_a=this.donnee)===null||_a===void 0?void 0:_a.estInformation);} getValueContenu(){let lResult='';if((this.donnee!==null)&&(this.donnee!==undefined)&&(this.donnee.estInformation)&&(this.donnee.listeQuestions.getNbrElementsExistes()>0)){const lContenu=this.donnee.listeQuestions.getPremierElement();lResult=lContenu.texte;} return lResult;} setValueContenu(aValue){if((this.donnee!==null)&&(this.donnee!==undefined)&&(this.donnee.estInformation)&&(this.donnee.listeQuestions.getNbrElementsExistes()>0)){const lContenu=this.donnee.listeQuestions.getPremierElement();lContenu.texte=aValue;lContenu.setEtat(Enumere_Etat_1.EGenreEtat.Modification);}}} exports.FicheEditionInfoSond_Mobile=FicheEditionInfoSond_Mobile;