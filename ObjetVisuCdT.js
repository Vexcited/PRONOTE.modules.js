exports.ObjetVisuCdT=void 0;const ObjetIdentite_Mobile_1=require("ObjetIdentite_Mobile");const GUID_1=require("GUID");const ObjetMoteurCahierDeTextes_1=require("ObjetMoteurCahierDeTextes");const ObjetTraduction_1=require("ObjetTraduction");const GestionnaireBlocSaisieTAF_1=require("GestionnaireBlocSaisieTAF");const GestionnaireBlocSaisieContenu_1=require("GestionnaireBlocSaisieContenu");const GestionnaireBlocSaisieEltPgm_1=require("GestionnaireBlocSaisieEltPgm");const TypeOptionPublicationCDT_1=require("TypeOptionPublicationCDT");const ObjetPanelEditionContenu_1=require("ObjetPanelEditionContenu");const ObjetPanelEditionTAF_1=require("ObjetPanelEditionTAF");const ObjetIdentite_1=require("ObjetIdentite");const BlocCard_1=require("BlocCard");const Enumere_Etat_1=require("Enumere_Etat");const ObjetMoteurFormSaisieMobile_1=require("ObjetMoteurFormSaisieMobile");const ObjetHtml_1=require("ObjetHtml");const ObjetMenuContextuel_1=require("ObjetMenuContextuel");const ObjetPosition_1=require("ObjetPosition");const Enumere_Action_1=require("Enumere_Action");const Enumere_BoiteMessage_1=require("Enumere_BoiteMessage");const ObjetFenetre_ListeTAFFaits_1=require("ObjetFenetre_ListeTAFFaits");const ObjetCelluleDate_1=require("ObjetCelluleDate");const ObjetDate_1=require("ObjetDate");const ObjetDroitsPN_1=require("ObjetDroitsPN");const ObjetChaine_1=require("ObjetChaine");const ObjetFenetre_1=require("ObjetFenetre");const ObjetFenetre_PostIt_1=require("ObjetFenetre_PostIt");const UtilitaireSaisieCDT_1=require("UtilitaireSaisieCDT");const MethodesObjet_1=require("MethodesObjet");;const AccessApp_1=require("AccessApp");const IEHtml_Ripple_css_1=;class ObjetVisuCdT extends ObjetIdentite_Mobile_1.ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.ids={page:GUID_1.GUID.getId(),zoneTAFSeance:GUID_1.GUID.getId(),zoneContenuSeance:GUID_1.GUID.getId(),zoneEltPgmSeance:GUID_1.GUID.getId(),zoneTAFProchaineSeance:GUID_1.GUID.getId(),boutonPlus:GUID_1.GUID.getId(),zonePublicationCdT:GUID_1.GUID.getId(),imgNonPub:GUID_1.GUID.getId(),zonePub:GUID_1.GUID.getId(),btnCmd:GUID_1.GUID.getId()};this.data=null;this.dimensions={largeurMenuCtx:250};this.applicationSco=(0,AccessApp_1.getApp)();this.interfaceMobile=this.applicationSco.getInterfaceMobile();this.genreTabSelectionne=ObjetVisuCdT.genreTab.tafSeance;this.moteurCDT=new ObjetMoteurCahierDeTextes_1.ObjetMoteurCDT();this._instancierGestionnaires();this._instancierPanelsEdition();const lThis=this;this.identDatePublication=ObjetIdentite_1.Identite.creerInstance(ObjetCelluleDate_1.ObjetCelluleDate,{pere:this,evenement:function(aDate){const lChangement=!ObjetDate_1.GDate.estDateEgale(lThis.datePublication,aDate);if(lChangement){lThis.CdT.setEtat(Enumere_Etat_1.EGenreEtat.Modification);lThis.CdT.datePublication=aDate;lThis.callback.appel({evnt:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.publierDate,data:lThis.CdT,ctx:{}});}}});} getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{btnOnglet:{event(aGenre){aInstance.genreTabSelectionne=aGenre;const lId=aInstance._getIdDeGenre(aGenre);$('.content--active').each((aNum,aElt) =>{aElt.classList.remove('content--active');});$('.tab--active').each((aNum,aElt) =>{aElt.classList.remove('tab--active');});$('.tabicon--active').each((aNum,aElt) =>{aElt.classList.remove('tabicon--active');});$('#'+lId.escapeJQ()).each((aNum,aElt) =>{aElt.classList.add('content--active');});const lIdTab=lId+'_tab';$('#'+lIdTab.escapeJQ()).each((aNum,aElt) =>{aElt.classList.add('tab--active');});$('#'+lIdTab.escapeJQ()+' > span > i').each((aNum,aElt) =>{aElt.classList.add('tabicon--active');});},getDisabled:function(){return false;}},publierCdt:{getValue(){return aInstance._estCdTPublie();},setValue:function(aValue){if(aInstance._estPublicationCdTEditable()){aInstance.CdT.publie=aValue;aInstance.CdT.datePublication=aValue?(aInstance.CdT.datePublication?aInstance.CdT.datePublication:ObjetDate_1.GDate.getDateCourante()):null;aInstance.CdT.setEtat(Enumere_Etat_1.EGenreEtat.Modification);aInstance._actualiserImgPublication();aInstance.callback.appel({evnt:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.publierCdT,data:aInstance.CdT,ctx:{}});}},getDisabled:function(){return!aInstance._estPublicationCdTEditable();}},verrouCdt:{getValue:function(){return aInstance._estCdTVerrouille();},setValue:function(){},getDisabled:function(){return true;}},getNodePage:function(){if(!aInstance._estCdTVerrouille()||aInstance.applicationSco.parametresUtilisateur.get('CDT.Commentaire.ActiverSaisie')){$('#'+aInstance.interfaceMobile.idZonePrincipale).ieHtmlAppend(IE.jsx.str("div",{id:aInstance.ids.boutonPlus,class:['is-sticky btn-float primary messagerieNouveauMessage',IEHtml_Ripple_css_1.StylesIEHtmlRipple.ieRipple,IEHtml_Ripple_css_1.StylesIEHtmlRipple.ieRippleClaire],"ie-event":"click->btnPlus.surCreer()","ie-display":"btnPlus.estVisible"}),{controleur:this.controleur});$(this.node).on('destroyed',() =>{$('#'+aInstance.ids.boutonPlus.escapeJQ()).remove();});}},btnPlus:{surCreer:function(){if(aInstance.genreTabSelectionne===ObjetVisuCdT.genreTab.contenuSeance&&aInstance.applicationSco.parametresUtilisateur.get('CDT.Commentaire.ActiverSaisie')){ObjetMenuContextuel_1.ObjetMenuContextuel.afficher({pere:aInstance,id:aInstance.ids.boutonPlus,options:{largeurMin:100},initCommandes:function(aInstanceMenu){aInstanceMenu.add(ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.SaisirContenu'),!aInstance._estCdTVerrouille(),() =>{aInstance._ouvrirCreationSelonTab(ObjetVisuCdT.genreTab.contenuSeance);},{icon:'icon_contenu_cours'});aInstanceMenu.add(ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.postIt.seanceSuivante.saisir'),true,() =>{aInstance._ouvrirCreationNoteProchaineSeance();},{icon:'icon_comment'});}});} else{aInstance._ouvrirCreationSelonTab(aInstance.genreTabSelectionne);}},estVisible:function(){return aInstance._estTabAvecCreation(aInstance.genreTabSelectionne)&&!aInstance._estCdTVerrouille();}},btnCommandes:{event:function(){ObjetMenuContextuel_1.ObjetMenuContextuel.afficher({pere:aInstance,id:{x:ObjetPosition_1.GPosition.getLeft(aInstance.ids.btnCmd)-aInstance.dimensions.largeurMenuCtx-5,y:ObjetPosition_1.GPosition.getTop(aInstance.ids.btnCmd)},evenement:function(){},initCommandes:function(aInstanceMenu){aInstance.setOptions({largeurMin:aInstance.dimensions.largeurMenuCtx});aInstanceMenu.add(ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.CopierCDT'),(!!(aInstance.cours.utilisable&&aInstance.cours.AvecCdT)),() =>{aInstance.cahierDeTextesCopie=aInstance.CdT;aInstance.callback.appel({evnt:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.copierCdT,data:aInstance.CdT,ctx:{}});},{icon:'icon_copier_liste'});aInstanceMenu.add(ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.CollerCDT'),(!(!aInstance.cahierDeTextesCopie||!aInstance.cours.utilisable||(aInstance.CdT&&aInstance.CdT.verrouille))),() =>{if((aInstance.cahierDeTextesCopie!==null)&&(aInstance.cahierDeTextesCopie!==undefined)&&(aInstance.CdT!==null)&&(aInstance.CdT!==undefined)&&(aInstance.cahierDeTextesCopie.getNumero()!==aInstance.CdT.getNumero())){if(aInstance.cours&&aInstance.cours.utilisable&&aInstance.cours.AvecCdT){aInstance.applicationSco.getMessage().afficher({type:Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,message:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.ConfirmerCollerCahierSurExistant'),callback:function(aGenreAction){if(aGenreAction===Enumere_Action_1.EGenreAction.Valider){aInstance.callback.appel({evnt:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.collerCdT,data:aInstance.CdT,ctx:{}});}}});} else{aInstance.callback.appel({evnt:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.collerCdT,data:aInstance.CdT,ctx:{}});}}},{icon:'icon_coller_liste'});aInstanceMenu.add(ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.SupprimerCDT'),!!(aInstance.cours.AvecCdT&&!aInstance.CdT.verrouille&&aInstance.cours.utilisable),() =>{aInstance.applicationSco.getMessage().afficher({type:Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,message:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.msgConfirmationSupprimerContenu'),callback:function(aGenreAction){if(aGenreAction===Enumere_Action_1.EGenreAction.Valider){aInstance.CdT.setEtat(Enumere_Etat_1.EGenreEtat.Suppression);aInstance.callback.appel({evnt:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.deleteCdT,data:aInstance.CdT,ctx:{}});}}});},{icon:'icon_trash'});if(aInstance.applicationSco.parametresUtilisateur.get('CDT.Commentaire.ActiverSaisie')){aInstanceMenu.addSeparateur();aInstanceMenu.add(ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.postIt.commentairePrive.menuCtx'),!!(aInstance.cours.utilisable),() =>{aInstance._ouvrirCreationCommentairePrive();},{icon:'icon_post_it_rempli'});}}});}},btnCommentaire:{avec(){return aInstance.CdT.commentairePrive&&aInstance.applicationSco.parametresUtilisateur.get('CDT.Commentaire.ActiverSaisie');},model:{event(){aInstance._ouvrirCreationCommentairePrive();},getTitle(){return ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.postIt.commentairePrive.hintBtn');}}},editionNoteProchaineSeance(){$(this.node).eventValidation(() =>{aInstance._ouvrirCreationNoteProchaineSeance();});},afficherNoteCoursPrecedent:{event(){if(!!aInstance.fenetreNotePourSeance){aInstance.fenetreNotePourSeance.fermer();} aInstance.fenetreNotePourSeance=ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_1.ObjetFenetre,{pere:aInstance,initialiser:(aInstanceFenetre) =>{aInstanceFenetre.setOptionsFenetre({titre:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.postIt.pourCetteSeance.titre')});}});aInstance.fenetreNotePourSeance.afficher(ObjetChaine_1.GChaine.replaceRCToHTML(aInstance.data.CoursPrecedent.noteProchaineSeance));},getTitle(){return ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.postIt.pourCetteSeance.titre');}}});} actualiserDataCdT(aParam){this.data=aParam.cdt;this.CdT=aParam.cdt.CahierDeTextes;this.CdT.publie=!!(this.CdT.datePublication);this.cours=aParam.cours;this._actualiserPublication();switch(aParam.evnt){case ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.createContenu:case ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.editContenu:case ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.deleteContenu:case ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.editNoteProchaineSeance:this._actualiserContenus();break;case ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.createTAF:case ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.editTAF:case ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.deleteTAF:this._actualiserTafs();break;case ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.deleteCdT:case ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.collerCdT:this._actualiserContenus();this._actualiserTafs();break;}} setDonnees(aParam){this.data=aParam.cdt;this.CdT=aParam.cdt.CahierDeTextes;this.CdT.publie=!!(this.CdT.datePublication);this.tafsSeance=aParam.tafs;this.general=aParam.general;this.cours=aParam.cours;this.cahierDeTextesCopie=aParam.cahierDeTextesCopie;this.avecElementsProgramme=this.data.avecElementsProgramme;this.DateCoursDeb=this.data.DateCoursDeb;this.DateCoursFin=this.data.DateCoursFin;this._actualiserOptionsGestionnaires();this.afficher();this._refreshBlocs();this.actualiserDatePublication();} construireAffichage(){const H=[];if((this.data!==null)&&(this.data!==undefined)){const lTabOnglets=[{avecIcone:true,icone:'icon_saisie_appreciation',avecLibelle:false,libelle:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.TAFPourSeance'),selection:true,genre:0,id:this.ids.zoneTAFSeance},{avecIcone:true,icone:'icon_contenu_cours',avecLibelle:false,libelle:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.ContenusSeance'),selection:false,genre:1,id:this.ids.zoneContenuSeance} ];if(this.avecElementsProgramme){lTabOnglets.push({avecIcone:true,icone:'icon_book',avecLibelle:false,libelle:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.EltPgmSeance'),selection:false,genre:2,id:this.ids.zoneEltPgmSeance});} lTabOnglets.push({avecIcone:true,icone:'icon_taf',avecLibelle:false,libelle:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.TAFAVenir'),selection:false,genre:3,id:this.ids.zoneTAFProchaineSeance});H.push('<div class="ObjetVisuCdT" id="',this.ids.page,'" ie-node="getNodePage">');H.push(this._construireZoneCdT());H.push(this._construireTabsScrollable({onglets:lTabOnglets}));H.push('<section class="content content--active" id="',this.ids.zoneTAFSeance,'">',this._construireTAFSeance(),'</section>');H.push('<section class="content" id="',this.ids.zoneContenuSeance,'">',this._construireContenuSeance(),'</section>');H.push('<section class="content" id="',this.ids.zoneEltPgmSeance,'">',this._construireEltPgmeSeance(),'</section>');H.push('<section class="content" id="',this.ids.zoneTAFProchaineSeance,'">',this._construireTAFProchaineSeance(),'</section>');H.push('</div>');} return H.join('');} actualiserFicheTAFDuCours(aParam){this.tafsSeance=aParam.tafs;this._actualiserTafsSeance();} actualiserDatePublication(){if(this.identDatePublication&&this._estPublicationVisible()&&!this._estPublieAuto()){this.identDatePublication.setParametresFenetre(GParametres.PremierLundi,GParametres.PremiereDate,this.cours.DateDuCours);this.identDatePublication.initialiser();if(this.CdT){const lDate=this.CdT.datePublication?this.CdT.datePublication:ObjetDate_1.GDate.getDateCourante();this.identDatePublication.setActif(this._estCdTPublie());this.identDatePublication.setOptionsObjetCelluleDate({domaineValide:this.applicationSco.droits.get(ObjetDroitsPN_1.TypeDroits.cours.domaineConsultationEDT)});this.identDatePublication.setDonnees(lDate);}}} _estTabAvecCreation(aGenre){switch(aGenre){case ObjetVisuCdT.genreTab.tafSeance:return false;case ObjetVisuCdT.genreTab.contenuSeance:return true;case ObjetVisuCdT.genreTab.eltPgmSeance:return false;case ObjetVisuCdT.genreTab.tafProchaineSeance:return true;}} async _ouvrirCreationSelonTab(aGenre){switch(aGenre){case ObjetVisuCdT.genreTab.contenuSeance:this._ouvrirEditionContenu({estCreation:true,contenu:this.moteurCDT.creerContenuParDefaut()});break;case ObjetVisuCdT.genreTab.eltPgmSeance:;break;case ObjetVisuCdT.genreTab.tafProchaineSeance:{const lAvecAutorisationCreationTaf=await UtilitaireSaisieCDT_1.UtilitaireSaisieCDT.autoriserCreationTAF(this.data);if(lAvecAutorisationCreationTaf){const lTaf=this.moteurCDT.creerTAFParDefaut({date:this.data.dateCoursSuivantTAF||this.data.DateTravailAFaire});if(!this.applicationSco.parametresUtilisateur.get('CDT.TAF.AffecterParDefautElevesDetaches')){const lListeTousEleves=MethodesObjet_1.MethodesObjet.dupliquer(this.moteurCDT.getListeTousEleves({listeClassesEleves:this.data.listeClassesEleves}));const lListeElevesDetachesEtEnCours=UtilitaireSaisieCDT_1.UtilitaireSaisieCDT.getListeElevesDetachesEtEnCours(lListeTousEleves);const lEstPourTous=(lListeTousEleves.count()===lListeElevesDetachesEtEnCours.listeEnCours.count())&&(lListeTousEleves.getIndiceElementParFiltre((aElement) => aElement.estElevesDetachesDuCours)=== -1);lTaf.estPourTous=lEstPourTous;lTaf.pourTousLesEleves=lEstPourTous;lListeElevesDetachesEtEnCours.listeEnCours.parcourir((D) =>{D.setEtat(Enumere_Etat_1.EGenreEtat.Modification);lTaf.listeEleves.addElement(D);});} this._ouvrirEditionTAF({estCreation:true,taf:lTaf});} break;}}} _actualiserPublication(){ObjetHtml_1.GHtml.setHtml(this.ids.zonePublicationCdT,this._construirePublication(this._estCdTPublie(),this._estPublicationCdTEditable()),{controleur:this.controleur});this.actualiserDatePublication();} _actualiserContenus(){ObjetHtml_1.GHtml.setHtml(this.ids.zoneContenuSeance,this._construireContenuSeance(),{controleur:this.controleur});this._refreshBlocs();} _actualiserTafs(){ObjetHtml_1.GHtml.setHtml(this.ids.zoneTAFProchaineSeance,this._construireTAFProchaineSeance(),{controleur:this.controleur});this._refreshBlocs();} _construireTabsScrollable(aParam){const H=[];H.push('<div class="tabBar" role="tablist">');for(let i=0,lNbr=aParam.onglets.length;i<lNbr;i++){const lOnglet=aParam.onglets[i];const lId=this._getIdDeGenre(lOnglet.genre);const lIdOnglet=lId+'_tab';H.push('<ie-bouton ie-model="btnOnglet(',''+lOnglet.genre,')" class="tab themeTabBar ',(lOnglet.selection?'tab--active':''),'" role="tab" aria-selected="true" tabindex="0" id="',lIdOnglet,'">');H.push('<span>');if(lOnglet.avecIcone){H.push('<i class="tabicon ',lOnglet.icone,' ',(lOnglet.selection?'tabicon--active':''),'" role="presentation"></i>');} if(lOnglet.avecLibelle){H.push('<span>',lOnglet.libelle,'</span>');} H.push('</span>');H.push('</ie-bouton>');} H.push('</div>');return H.join('');} _getIdDeGenre(aGenre){switch(aGenre){case ObjetVisuCdT.genreTab.tafSeance:return this.ids.zoneTAFSeance;case ObjetVisuCdT.genreTab.contenuSeance:return this.ids.zoneContenuSeance;case ObjetVisuCdT.genreTab.eltPgmSeance:return this.ids.zoneEltPgmSeance;case ObjetVisuCdT.genreTab.tafProchaineSeance:return this.ids.zoneTAFProchaineSeance;}} _estPublicationVisible(){return this.CdT.existeNumero();} _construireZoneCdT(){const H=[];H.push('<section class="ZoneCdT">');H.push('<div class="fluid-bloc">');H.push('<div class="flex-contain flex-center flex-gap" id="',this.ids.zonePublicationCdT,'">',this._construirePublication(this._estCdTPublie(),this._estPublicationCdTEditable()),'</div>');if(this._estCdTVerrouille()){H.push(this._construireVerrouVisa());} H.push('</div>');H.push('<div ie-if="btnCommentaire.avec"><ie-btnicon ie-model="btnCommentaire.model" class="icon_post_it_rempli bt-activable m-right-l"></ie-btnicon></div>');H.push('<div style="width:.8rem;" id="',this.ids.btnCmd,'"><ie-btnicon ie-model="btnCommandes" class="icon_ellipsis_vertical btnCmd" title="',ObjetTraduction_1.GTraductions.getValeur('liste.BtnAction'),'"></ie-btnicon></div>');H.push('</section>');return H.join('');} _construireSectionDonnees(aParam){const lListeDonnees=aParam.listeDonnees;const H=[];H.push('<header><h3>',aParam.titre,aParam.boutonTitre||'','</h3></header>');if(lListeDonnees!==null&&lListeDonnees!==undefined&&lListeDonnees.count()>0){const lStrListeBlocs=[];lListeDonnees.parcourir((aData) =>{lStrListeBlocs.push(this._composeBlocArticle({data:aData,gestionnaire:aParam.gestionnaire}).html);});H.push(lStrListeBlocs.join(''));} else{H.push(this._composeBlocArticle({msgAucun:aParam.msgAucun,gestionnaire:aParam.gestionnaire}).html);} return H.join('');} _construireTAFSeance(){return this._construireSectionDonnees({titre:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.TAFPourSeance'),listeDonnees:this.tafsSeance,gestionnaire:this.gestionnaireBlocsTAFsSeance,msgAucun:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.AucunTAFPourSeance')});} _construireContenuSeance(){const H=[];H.push(this._construireSectionDonnees({titre:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.ContenusSeance'),boutonTitre:!!this.data.CoursPrecedent&&!!this.data.CoursPrecedent.noteProchaineSeance&&this.applicationSco.parametresUtilisateur.get('CDT.Commentaire.ActiverSaisie')?`<ie-btnicon class="icon_comment bt-activable m-left-xl" ie-model="afficherNoteCoursPrecedent"></ie-btnicon>`:'',listeDonnees:this.CdT.listeContenus,gestionnaire:this.gestionnaireBlocsContenus,msgAucun:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.AucunContenuSaisi')}));if(!!this.CdT.noteProchaineSeance&&this.applicationSco.parametresUtilisateur.get('CDT.Commentaire.ActiverSaisie')){H.push(this._constuireNoteProchaineSeance());} return H.join('');} _construireEltPgmeSeance(){if(this.CdT.listeElementsProgrammeCDT&&this.CdT.listeElementsProgrammeCDT.getNbrElementsExistes()){this.CdT.listeElementsProgrammeCDT.trier();} return this._construireSectionDonnees({titre:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.EltPgmSeance'),listeDonnees:this.CdT.listeElementsProgrammeCDT,gestionnaire:this.gestionnaireBlocsEltPgm,msgAucun:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.AucunEltPgm')});} _construireTAFProchaineSeance(){return this._construireSectionDonnees({titre:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.TAFAVenir'),listeDonnees:this.CdT.ListeTravailAFaire,gestionnaire:this.gestionnaireBlocsTAFsProchaineSeance,msgAucun:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.AucunTAFSaisi')});} _instancierPanelsEdition(){this.instancePanelEditionContenu=ObjetIdentite_1.Identite.creerInstance(ObjetPanelEditionContenu_1.ObjetPanelEditionContenu,{pere:this,evenement:this._evntSurEditionContenu.bind(this)});this.instancePanelEditionTAF=ObjetIdentite_1.Identite.creerInstance(ObjetPanelEditionTAF_1.ObjetPanelEditionTAF,{pere:this,evenement:this._evntSurEditionTAF.bind(this)});} _ouvrirEditionContenu(aParam){const lParametrePanelContenu={estCreation:aParam.estCreation,contenu:aParam.contenu,listeCategories:this.general.ListeCategories,listeDocumentsJoints:this.data.ListeDocumentsJoints,listePeriodes:this.general.ListePeriodes,dateCoursDeb:this.data.DateCoursDeb,matiere:this.data.CahierDeTextes.Matiere};this.instancePanelEditionContenu.setOptionsPanelEditionContenu({avecSaisiePJ:this.general.PublierDocuments,avecSaisieSitesWeb:this.general.PublierUrl,avecCloud:this.general.PublierCloud,avecKiosque:this.general.PublierKiosque});this.instancePanelEditionContenu.setDonnees(lParametrePanelContenu);const lHtmlPanel=this.instancePanelEditionContenu.getHtmlPanel();this.interfaceMobile.openPanel(lHtmlPanel,{controleur:this.instancePanelEditionContenu.controleur,optionsFenetre:this.instancePanelEditionContenu.getOptionsFenetre()});this.instancePanelEditionContenu.updateContent();} _ouvrirEditionEltPgme(...aParam){} _evntSurEditionContenu(aParam){switch(aParam.commande){case ObjetMoteurFormSaisieMobile_1.EGenreEvntForm.annuler:break;case ObjetMoteurFormSaisieMobile_1.EGenreEvntForm.valider:if(aParam.estCreation){this.CdT.listeContenus.addElement(aParam.data);} else{this.CdT.listeContenus.addElement(aParam.data,this.CdT.listeContenus.getIndiceParElement(aParam.data));} this.CdT.setEtat(Enumere_Etat_1.EGenreEtat.Modification);this.callback.appel({evnt:aParam.estCreation?ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.createContenu:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.editContenu,data:this.CdT,ctx:{element:aParam.data}});break;case ObjetMoteurFormSaisieMobile_1.EGenreEvntForm.supprimer:this.CdT.listeContenus.addElement(aParam.data,this.CdT.listeContenus.getIndiceParElement(aParam.data));this.CdT.setEtat(Enumere_Etat_1.EGenreEtat.Modification);this.callback.appel({evnt:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.deleteContenu,data:this.CdT,ctx:{}});break;default:;} this.interfaceMobile.closePanel();} _evntSurEditionTAF(aParam){switch(aParam.commande){case ObjetMoteurFormSaisieMobile_1.EGenreEvntForm.annuler:break;case ObjetMoteurFormSaisieMobile_1.EGenreEvntForm.valider:if(aParam.estCreation){this.CdT.ListeTravailAFaire.addElement(aParam.data);} else{this.CdT.ListeTravailAFaire.addElement(aParam.data,this.CdT.ListeTravailAFaire.getIndiceParElement(aParam.data));} this.CdT.setEtat(Enumere_Etat_1.EGenreEtat.Modification);this.callback.appel({evnt:aParam.estCreation?ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.createTAF:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.editTAF,data:this.CdT,ctx:{element:aParam.data}});break;case ObjetMoteurFormSaisieMobile_1.EGenreEvntForm.supprimer:this.CdT.ListeTravailAFaire.addElement(aParam.data,this.CdT.ListeTravailAFaire.getIndiceParElement(aParam.data));this.CdT.setEtat(Enumere_Etat_1.EGenreEtat.Modification);this.callback.appel({evnt:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.deleteTAF,data:this.CdT,ctx:{}});break;default:;} this.interfaceMobile.closePanel();} _ouvrirEditionTAF(aParam){const lParametresPanelTAF={taf:aParam.taf,estCreation:aParam.estCreation,listeClassesEleves:this.data.listeClassesEleves,listeDocumentsJoints:this.data.ListeDocumentsJoints,listePeriodes:this.general.ListePeriodes,dateCoursDeb:this.data.DateCoursDeb,CDTPublie:this._estCdTPublie(),matiere:this.data.CahierDeTextes.Matiere};this.instancePanelEditionTAF.setOptionsPanelEditionTAF({avecSaisiePJ:this.general.PublierDocuments,avecSaisieSitesWeb:this.general.PublierUrl,avecCloud:this.general.PublierCloud,avecKiosque:this.general.PublierKiosque});this.instancePanelEditionTAF.setDonnees(lParametresPanelTAF);const lHtmlPanel=this.instancePanelEditionTAF.getHtmlPanel();this.interfaceMobile.openPanel(lHtmlPanel,{controleur:this.instancePanelEditionTAF.controleur,optionsFenetre:this.instancePanelEditionTAF.getOptionsFenetre()});this.instancePanelEditionTAF.updateContent();} _instancierGestionnaires(){this.gestionnaireBlocsTAFsSeance=ObjetIdentite_1.Identite.creerInstance(GestionnaireBlocSaisieTAF_1.GestionnaireBlocSaisieTAF,{pere:this,evenement:(aDataBloc) =>{this._ouvrirSuiviRendusTAFs({taf:aDataBloc});}});this.gestionnaireBlocsTAFsProchaineSeance=ObjetIdentite_1.Identite.creerInstance(GestionnaireBlocSaisieTAF_1.GestionnaireBlocSaisieTAF,{pere:this,evenement:(aDataBloc,aGenreEvnt) =>{switch(aGenreEvnt){case BlocCard_1.EGenreEvntBlocCard.edition:this._ouvrirEditionTAF({estCreation:false,taf:aDataBloc});break;}}});this.gestionnaireBlocsContenus=ObjetIdentite_1.Identite.creerInstance(GestionnaireBlocSaisieContenu_1.GestionnaireBlocSaisieContenu,{pere:this,evenement:(aDataBloc,aGenreEvnt) =>{switch(aGenreEvnt){case BlocCard_1.EGenreEvntBlocCard.edition:this._ouvrirEditionContenu({estCreation:false,contenu:aDataBloc});break;}}});this.gestionnaireBlocsEltPgm=ObjetIdentite_1.Identite.creerInstance(GestionnaireBlocSaisieEltPgm_1.GestionnaireBlocSaisieEltPgm,{pere:this,evenement:(aDataBloc,aGenreEvnt) =>{switch(aGenreEvnt){case BlocCard_1.EGenreEvntBlocCard.edition:this._ouvrirEditionEltPgme({estCreation:false,eltPgme:aDataBloc});break;}}});} _actualiserOptionsGestionnaires(){this.gestionnaireBlocsTAFsSeance.setOptions({editable:false,avecDonneLe:true,avecPourLe:false,avecSuiviRendu:true,listeClassesEleves:this.data.listeClassesEleves});this.gestionnaireBlocsTAFsProchaineSeance.setOptions({editable:!this._estCdTVerrouille(),avecDonneLe:false,avecPourLe:true,avecSuiviRendu:false,listeClassesEleves:this.data.listeClassesEleves});this.gestionnaireBlocsContenus.setOptions({editable:!this._estCdTVerrouille()});this.gestionnaireBlocsEltPgm.setOptions({editable:false});} _refreshBlocs(){if(this.tafsSeance!==null&&this.tafsSeance!==undefined&&this.tafsSeance.count()>0){this.gestionnaireBlocsTAFsSeance.refresh();} if(this.CdT.ListeTravailAFaire!==null&&this.CdT.ListeTravailAFaire!==undefined&&this.CdT.ListeTravailAFaire.count()>0){this.gestionnaireBlocsTAFsProchaineSeance.refresh();} if(this.CdT.listeContenus!==null&&this.CdT.listeContenus!==undefined&&this.CdT.listeContenus.count()>0){this.gestionnaireBlocsContenus.refresh();} if(this.CdT.listeElementsProgrammeCDT!==null&&this.CdT.listeElementsProgrammeCDT!==undefined&&this.CdT.listeElementsProgrammeCDT.count()>0){this.gestionnaireBlocsEltPgm.refresh();}} _composeBlocArticle(aParam){const H=[];let lBloc;if(aParam.data!==null&&aParam.data!==undefined){lBloc=aParam.gestionnaire.composeBloc(aParam.data);} else{lBloc=aParam.gestionnaire.composeBlocMsg(aParam.msgAucun);} H.push(lBloc.html);return{html:H.join(''),controleur:lBloc.controleur};} _construirePublication(aCoche,aActif){const H=[];if(this._estPublicationVisible()){H.push('<div id="',this.ids.imgNonPub,'" class="',this._getImgPublicationSelonEtat(aCoche,aActif),'"></div>');H.push('<ie-checkbox id="',this.ids.zonePub,'" class="EspaceGauche" ie-model="publierCdt">',ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.publie'),'</ie-checkbox>');H.push('<div id="'+this.identDatePublication.getNom()+'"></div>');} return H.join('');} _estPublieAuto(){return new Date()>(this.applicationSco.parametresUtilisateurBase.optionPublicationCDT===TypeOptionPublicationCDT_1.TypeOptionPublicationCDT.OPT_PublicationDebutCours?this.DateCoursDeb:this.DateCoursFin);} _estCdTPublie(){return this.CdT.existeNumero()&&(this.CdT.publie||this._estPublieAuto());} _estPublicationCdTEditable(){return!this._estPublieAuto()&&!this._estCdTVerrouille();} _getImgPublicationSelonEtat(aPublie,aActif){return(aActif===true)?(aPublie===true?'Image_Publie':'Image_NonPublie'):(aPublie===true?'Image_Publie_Grise':'Image_NonPublie_Grise');} _actualiserImgPublication(){const lCoche=this._estCdTPublie();const lActif=this._estPublicationCdTEditable();$('#'+this.ids.imgNonPub.escapeJQ()).removeClass('Image_Publie Image_NonPublie Image_Publie_Grise Image_NonPublie_Grise').addClass(this._getImgPublicationSelonEtat(lCoche,lActif));} _estCdTVerrouille(){return this.CdT?this.CdT.verrouille:true;} _construireVerrouVisa(){const H=[];H.push('<div class="flex-contain flex-center flex-gap">');H.push('<i class="icon_lock verrou" role="presentation"></i>');H.push('<ie-checkbox ie-model="verrouCdt">',ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.CDTViseEtVerrouille'),'</ie-checkbox>');H.push('</div>');return H.join('');} _ouvrirSuiviRendusTAFs(aParam){ObjetFenetre_ListeTAFFaits_1.ObjetFenetre_ListeTAFFaits.ouvrir({pere:this,evenement:() =>{this.callback.appel({evnt:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.actualiserFicheTAFDuCours,data:this.CdT,ctx:{}});}},aParam.taf);} _actualiserTafsSeance(){ObjetHtml_1.GHtml.setHtml(this.ids.zoneTAFSeance,this._construireTAFSeance(),{controleur:this.controleur});this._refreshBlocs();} _constuireNoteProchaineSeance(){const H=[];H.push(`<div class="m-all-xl" ie-node="editionNoteProchaineSeance">`,`<header><h3>${ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.postIt.seanceSuivante.titre')}</h3></header>`,`<p>${ObjetChaine_1.GChaine.replaceRCToHTML(this.CdT.noteProchaineSeance)}</p>`,`</div>`);return H.join('');} _ouvrirCreationNoteProchaineSeance(){ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_PostIt_1.ObjetFenetre_PostIt,{pere:this,initialiser:(aInstanceFenetre) =>{aInstanceFenetre.setOptionsFenetre({titre:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.postIt.seanceSuivante.titre')});},evenement:(aNoteProchaineSeance) =>{this.CdT.noteProchaineSeance=aNoteProchaineSeance;this.CdT.setEtat(Enumere_Etat_1.EGenreEtat.Modification);this.callback.appel({evnt:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.editNoteProchaineSeance,data:this.CdT});}}).setDonnees({texte:this.CdT.noteProchaineSeance,label:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.postIt.seanceSuivante.label'),taillePostIt:this.CdT.taillePostIt});} _ouvrirCreationCommentairePrive(){ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_PostIt_1.ObjetFenetre_PostIt,{pere:this,initialiser:(aInstanceFenetre) =>{aInstanceFenetre.setOptionsFenetre({titre:ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.postIt.commentairePrive.titre')});},evenement:(aCommentairePrive) =>{this.CdT.commentairePrive=aCommentairePrive;this.CdT.setEtat(Enumere_Etat_1.EGenreEtat.Modification);this.callback.appel({evnt:ObjetMoteurCahierDeTextes_1.EGenreEvntCdT.editCommentairePrive,data:this.CdT});}}).setDonnees({texte:this.CdT.commentairePrive,label:ObjetTraduction_1.GTraductions.getValeur('Commentaire')+' ('+ObjetTraduction_1.GTraductions.getValeur('CahierDeTexte.postIt.commentairePrive.infoTitre')+')',taillePostIt:this.CdT.taillePostIt});}} exports.ObjetVisuCdT=ObjetVisuCdT;(function(ObjetVisuCdT){let genreTab;(function(genreTab){genreTab[genreTab["tafSeance"]=0]="tafSeance";genreTab[genreTab["contenuSeance"]=1]="contenuSeance";genreTab[genreTab["eltPgmSeance"]=2]="eltPgmSeance";genreTab[genreTab["tafProchaineSeance"]=3]="tafProchaineSeance";})(genreTab=ObjetVisuCdT.genreTab||(ObjetVisuCdT.genreTab={}));})(ObjetVisuCdT||(exports.ObjetVisuCdT=ObjetVisuCdT={}));