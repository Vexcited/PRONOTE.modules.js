exports.ObjetFenetre_SaisieCollecte=void 0;const ObjetFenetre_1=require("ObjetFenetre");const ObjetTraduction_1=require("ObjetTraduction");const Enumere_Ressource_1=require("Enumere_Ressource");const ObjetCelluleDate_1=require("ObjetCelluleDate");const Divers_css_1=;const MoteurDestinatairesPN_1=require("MoteurDestinatairesPN");const ObjetListeElements_1=require("ObjetListeElements");const ObjetFenetre_ChoixDestinatairesParCriteres_1=require("ObjetFenetre_ChoixDestinatairesParCriteres");const ObjetElement_1=require("ObjetElement");const Enumere_EvenementObjetSaisie_1=require("Enumere_EvenementObjetSaisie");const ChoixDestinatairesParCriteres_1=require("ChoixDestinatairesParCriteres");const MethodesObjet_1=require("MethodesObjet");const Couleurs_css_1=;const Casier_module_css_1=;const Enumere_Etat_1=require("Enumere_Etat");const TypeCasier_1=require("TypeCasier");const UtilitaireCasier_1=require("UtilitaireCasier");const AccessApp_1=require("AccessApp");const IEHtml_Bouton_css_1=;const ObjetDate_1=require("ObjetDate");const Enumere_BoiteMessage_1=require("Enumere_BoiteMessage");const Enumere_Action_1=require("Enumere_Action");class ObjetFenetre_SaisieCollecte extends ObjetFenetre_1.ObjetFenetre{constructor(...aParams){super(...aParams);this.applicationSco=(0,AccessApp_1.getApp)();this.etatUtilisateurSco=this.applicationSco.getEtatUtilisateur();this.moteurDestinataires=new MoteurDestinatairesPN_1.MoteurDestinatairesPN();this.genreDepot=UtilitaireCasier_1.UtilitaireCasier.getGenreDepotParDefault();this.criteres=new Map();this.setOptionsFenetre({avecTailleSelonContenu:true,listeBoutons:[ObjetTraduction_1.GTraductions.getValeur('Annuler'),ObjetTraduction_1.GTraductions.getValeur('Valider')],largeur:450,addParametresValidation:this.addParametresValidation.bind(this)});} static getTitreFenetre(aType,aPourCreation){if(!aPourCreation){return ObjetTraduction_1.GTraductions.getValeur('Casier.modifierCollecte');} switch(aType){case TypeCasier_1.TypeGenreCumulDocEleve.gcdeEleve:return ObjetTraduction_1.GTraductions.getValeur('Casier.nouvelleCollecteEleve');case TypeCasier_1.TypeGenreCumulDocEleve.gcdeRespEleve:return ObjetTraduction_1.GTraductions.getValeur('Casier.nouvelleCollecteRespEleve');case TypeCasier_1.TypeGenreCumulDocEleve.gcdeResp:return ObjetTraduction_1.GTraductions.getValeur('Casier.nouvelleCollecteResp');default:;break;}} construireInstances(){this.identDateDepot=this.add(ObjetCelluleDate_1.ObjetCelluleDate,this.evenementDateDepot,this.initDateDepot);} async setDonnees(aParams){var _a;this.donnees=MethodesObjet_1.MethodesObjet.dupliquer(aParams.donnees);this.genreRessourceSelection=aParams.genreRessourceSelection;this.genreRessourceFinal=aParams.genreRessourceFinal;this.genreDepot=UtilitaireCasier_1.UtilitaireCasier.deduireGenreDepot(this.donnees);if(this.donnees.getEtat()===Enumere_Etat_1.EGenreEtat.Creation){this.champsEditables=[];} else{this.champsEditables=this.donnees.listeChampsEditables.filter(({valeur}) => valeur).map(({typeColonne}) => typeColonne);if(this.champsEditables.length<=0){}} this.criteres=(_a=aParams.criteres)!==null&&_a!==void 0?_a:new Map();const lResult=this.afficher(this.composeContenu());const lInstanceDate=this.getInstance(this.identDateDepot);lInstanceDate.initialiser();if(ObjetDate_1.GDate.estDateJourAvant(ObjetDate_1.GDate.aujourdhui,ObjetDate_1.GDate.premiereDate)){lInstanceDate.setParametresFenetre(null,ObjetDate_1.GDate.aujourdhui);} if(this.genreDepot===UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.DepotAvecDate){this.dateDepot=this.donnees.dateEcheance;lInstanceDate.setDonnees(this.dateDepot);} return await lResult;} composeContenu(){if(!this.donnees){return'';} const lColsL=[Divers_css_1.StylesDivers.flexContain,Divers_css_1.StylesDivers.flexCols,Divers_css_1.StylesDivers.flexGapL];const lColsM=[Divers_css_1.StylesDivers.flexContain,Divers_css_1.StylesDivers.flexCols,Divers_css_1.StylesDivers.flexGap];const lCtnBase=['field-contain',Divers_css_1.StylesDivers.pYL];const lCtn=[...lCtnBase];const lStyleSelecteur={width:!IE.estMobile&&'20rem'};return(IE.jsx.str("div",null,IE.jsx.str("p",{class:[Divers_css_1.StylesDivers.mBottomL]},"*",ObjetTraduction_1.GTraductions.getValeur('ChampsObligatoires')),IE.jsx.str("div",{class:lCtn},IE.jsx.str("label",null,ObjetTraduction_1.GTraductions.getValeur('Casier.aDeposerPar'),"*"),IE.jsx.str("ie-btnselecteur",{style:lStyleSelecteur,"aria-required":'true',"aria-label":ObjetTraduction_1.GTraductions.getValeur('Casier.aDeposerPar'),"ie-model":this.jsxModelBtnSelecteurDestinataires.bind(this)})),IE.jsx.str("div",{class:lCtn},IE.jsx.str("div",{class:[...lColsL,Divers_css_1.StylesDivers.fluidBloc]},IE.jsx.str("div",null,IE.jsx.str("label",{class:['m-bottom']},ObjetTraduction_1.GTraductions.getValeur('Casier.nomDeLaCollecte'),"*"),IE.jsx.str("ie-textareamax",{maxlength:100,"aria-required":'true',"ie-model":this.jsxModeleNomCollecte.bind(this),placeholder:ObjetTraduction_1.GTraductions.getValeur('Casier.placeholderNomDeLaCollecte'),style:{minHeight:!IE.estMobile&&'3.7rem'},"aria-label":ObjetTraduction_1.GTraductions.getValeur('Casier.nomDeLaCollecte')})),IE.jsx.str("div",null,IE.jsx.str("label",{class:['m-bottom']},ObjetTraduction_1.GTraductions.getValeur('Casier.typeDeCollecte'),"*"),IE.jsx.str("ie-combo",{"ie-model":this.jsxComboModelTypeCollecte.bind(this),"aria-required":'true',"aria-label":ObjetTraduction_1.GTraductions.getValeur('Casier.typeDeCollecte')})))),IE.jsx.str("div",{class:lCtn,"ie-display":this.jsxDisplayDateCollecte.bind(this)},IE.jsx.str("div",{class:[Divers_css_1.StylesDivers.flexContain,Divers_css_1.StylesDivers.flexCenter,Divers_css_1.StylesDivers.flexGapL]},IE.jsx.str("p",null,ObjetTraduction_1.GTraductions.getValeur('Casier.depotJusquauSansDate'),"*"),IE.jsx.str("div",{id:this.getNomInstance(this.identDateDepot),"aria-required":'true',"aria-label":ObjetTraduction_1.GTraductions.getValeur('Casier.depotJusquauSansDate')}))),IE.jsx.str("div",{class:lCtn},IE.jsx.str("div",{class:[...lColsM,Divers_css_1.StylesDivers.fullWidth]},IE.jsx.str("label",{class:['m-bottom']},ObjetTraduction_1.GTraductions.getValeur('Casier.notifierLes',[ObjetFenetre_ChoixDestinatairesParCriteres_1.ObjetFenetre_ChoixDestinatairesParCriteres.getLibelleRessource(this.genreRessourceFinal,true)])),IE.jsx.str("div",{class:[Divers_css_1.StylesDivers.flexContain,Divers_css_1.StylesDivers.justifyBetween]},IE.jsx.str("ie-checkbox",{"ie-model":this.jsxModelCheckboxNotif.bind(this)},ObjetTraduction_1.GTraductions.getValeur('Casier.notificationActivee')),IE.jsx.str("ie-bouton",{class:[IEHtml_Bouton_css_1.StylesIEHtmlBouton.themeBoutonNeutre,IEHtml_Bouton_css_1.StylesIEHtmlBouton.smallBt],"ie-model":this.jsxModelBoutonModaliteNotif.bind(this)},ObjetTraduction_1.GTraductions.getValeur('Casier.definirModalites'))))),IE.jsx.str("div",{class:[...lCtnBase,Divers_css_1.StylesDivers.labelUp]},IE.jsx.str("label",null,ObjetTraduction_1.GTraductions.getValeur('Casier.donnerAccesACetteCollecte')," :"),IE.jsx.str("div",{class:lColsL},IE.jsx.str("ie-btnselecteur",{style:lStyleSelecteur,"aria-label":ObjetTraduction_1.GTraductions.getValeur('WAI.SelectionProfesseur'),"ie-model":this.jsxModelBtnSelecteurAccesCollecte.bind(this,true)}),IE.jsx.str("ie-btnselecteur",{style:lStyleSelecteur,"aria-label":ObjetTraduction_1.GTraductions.getValeur('WAI.SelectionPersonnel'),"ie-model":this.jsxModelBtnSelecteurAccesCollecte.bind(this,false)})))));} getDisabledChamp(aTypeColonne){if(aTypeColonne===TypeCasier_1.TypeColonneDocumentsEleve.CDE_Notification){return this.getDisabledNotif();} return this.champsEditables.length===0?false:!this.champsEditables.includes(aTypeColonne);} getDisabledNotif(){switch(this.genreDepot){case UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.SansDepot:return true;case UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.DepotAvecDate:return!this.dateDepot||ObjetDate_1.GDate.getNbrJoursEntreDeuxDates(ObjetDate_1.GDate.aujourdhui,this.dateDepot)<0;case UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.DepotSansDate:return false;}} estDeposerParLeResponsable(){return this.donnees.getGenre()===TypeCasier_1.TypeGenreCumulDocEleve.gcdeResp;} jsxModelBtnSelecteurDestinataires(){return{event:() =>{this.ouvrirFenetreChoixDestinataires();},getLibelle:() =>{return UtilitaireCasier_1.UtilitaireCasier.getLibelleSelecteurRessource(this.donnees.destinataires,this.genreRessourceSelection,{avecCompteurCriteresVide:true});},getDisabled:() =>{return this.getDisabledChamp(this.estDeposerParLeResponsable()?TypeCasier_1.TypeColonneDocumentsEleve.CDE_Responsables:TypeCasier_1.TypeColonneDocumentsEleve.CDE_Eleves);}};} getLibelleEspace(){return UtilitaireCasier_1.UtilitaireCasier.getLibelleEspace(this.genreRessourceFinal);} getListeComboTypeCollecte(){const lliste=new ObjetListeElements_1.ObjetListeElements();const lLibelleEspace=this.getLibelleEspace();lliste.add(new ObjetElement_1.ObjetElement(ObjetTraduction_1.GTraductions.getValeur('Casier.depotAvecDateLimite',[lLibelleEspace]),-1,UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.DepotAvecDate));lliste.add(new ObjetElement_1.ObjetElement(ObjetTraduction_1.GTraductions.getValeur('Casier.depotSansDateLimite',[lLibelleEspace]),-1,UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.DepotSansDate));lliste.add(new ObjetElement_1.ObjetElement(ObjetTraduction_1.GTraductions.getValeur('Casier.pasDeDepotEnLigne'),-1,UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.SansDepot));return lliste;} getSelectionComboTypeCollecte(){const lListe=this.getListeComboTypeCollecte();const lIndice=lListe.getIndiceElementParFiltre(aElement => aElement.getGenre()===this.genreDepot);return lIndice!==null&&lIndice!==void 0?lIndice:0;} jsxComboModelTypeCollecte(){return{init:(aCombo) =>{if(!IE.estMobile){aCombo.setOptionsObjetSaisie({longueur:250});} aCombo.setDonneesObjetSaisie({liste:this.getListeComboTypeCollecte(),selection:this.getSelectionComboTypeCollecte()});},event:(aParams) =>{if(aParams.genreEvenement===Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie.selection){this.genreDepot=aParams.element.getGenre();}},getDisabled:() =>{return this.getDisabledChamp(TypeCasier_1.TypeColonneDocumentsEleve.CDE_DateDepot);}};} jsxModeleNomCollecte(){return{getValue:() =>{var _a,_b;return(_b=(_a=this.donnees)===null||_a===void 0?void 0:_a.getLibelle())!==null&&_b!==void 0?_b:'';},setValue:(aValue) =>{if(this.donnees){this.donnees.setLibelle(aValue);}},getDisabled:() =>{return this.getDisabledChamp(TypeCasier_1.TypeColonneDocumentsEleve.CDE_Libelle);}};} jsxDisplayDateCollecte(){return this.genreDepot===UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.DepotAvecDate;} jsxModelBoutonModaliteNotif(){return{event:() =>{this.ouvrirFenetreNotif();},getDisabled:() =>{return this.getDisabledChamp(TypeCasier_1.TypeColonneDocumentsEleve.CDE_Notification);}};} jsxModelCheckboxNotif(){return{getValue:() =>{var _a,_b,_c;return(_c=(_b=(_a=this.donnees)===null||_a===void 0?void 0:_a.notification)===null||_b===void 0?void 0:_b.avecNotif)!==null&&_c!==void 0?_c:false;},setValue:(aValue) =>{var _a;if((_a=this.donnees)===null||_a===void 0?void 0:_a.notification){const lAvecOuvertureFenetreModalite=this.donnees.notification.avecNotif===false&&aValue;this.donnees.notification.avecNotif=aValue;if(lAvecOuvertureFenetreModalite){this.ouvrirFenetreNotif();}}},getDisabled:() =>{return this.getDisabledChamp(TypeCasier_1.TypeColonneDocumentsEleve.CDE_Notification);}};} jsxModelBtnSelecteurAccesCollecte(aPourProf){const lGenre=aPourProf?Enumere_Ressource_1.EGenreRessource.Enseignant:Enumere_Ressource_1.EGenreRessource.Personnel;return{event:() =>{this.ouvrirFenetreSelectionPublic(lGenre);},getLibelle:() =>{var _a,_b,_c,_d;const lCompteur=(_d=(_c=(_b=(_a=this.donnees)===null||_a===void 0?void 0:_a.listeIndividuAccesAutorise)===null||_b===void 0?void 0:_b.getListeElements(aElem => aElem.getGenre()===lGenre))===null||_c===void 0?void 0:_c.count())!==null&&_d!==void 0?_d:0;return IE.jsx.str(IE.jsx.fragment,null,lCompteur," ",aPourProf?ObjetTraduction_1.GTraductions.getValeur('Professeurs'):ObjetTraduction_1.GTraductions.getValeur('Personnels'));},getDisabled:() =>{return this.getDisabledChamp(TypeCasier_1.TypeColonneDocumentsEleve.CDE_AutorisationAcces);}};} evenementDateDepot(aDate){if(this.donnees){this.dateDepot=aDate;this.resetNotif();}} initDateDepot(aInstance){aInstance.setOptions({placeHolder:ObjetTraduction_1.GTraductions.getValeur('Casier.choixDate'),ariaDescription:ObjetTraduction_1.GTraductions.getValeur('Casier.depotJusquauSansDate'),largeurComposant:!IE.estMobile&&100});} ouvrirFenetreSelectionPublic(aGenre){var _a,_b;this.moteurDestinataires.ouvrirModaleSelectionPublic({genreRessource:aGenre,listePublicDonnee:(_a=this.donnees)===null||_a===void 0?void 0:_a.listeIndividuAccesAutorise.getListeElements(aElement => aElement.getGenre()===aGenre),listeRessourceDesactiver:(_b=this.donnees)===null||_b===void 0?void 0:_b.listeIndividuAccesAutorise.getListeElements(aElement => aElement.isDisabled),clbck:(aParams) =>{if(aParams.listePublicDonnee&&this.donnees){const lListe=this.donnees.listeIndividuAccesAutorise.getListeElements(aElement => aElement.getGenre()!==aGenre);lListe.add(aParams.listePublicDonnee);this.donnees.listeIndividuAccesAutorise=lListe;}}});} avecRelanceVisible(){return this.genreDepot===UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.DepotAvecDate;} async ouvrirFenetreNotif(){const lFenetre=ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_NotificationCollecte,{pere:this});lFenetre.setOptionsFenetre({afficheRelance:this.avecRelanceVisible()});const lRes=await(lFenetre===null||lFenetre===void 0?void 0:lFenetre.setDonnees(Object.assign({genreRessource:this.genreRessourceFinal,dateDepot:this.dateDepot},MethodesObjet_1.MethodesObjet.dupliquer(this.donnees.notification))));if(lRes.numeroBouton===1){this.donnees.notification={avecNotif:lRes.avecNotif,avecRelance:lRes.avecRelance,dateNotif:lRes.dateNotif,nbrJourRelance:lRes.nbrJourRelance};}} resetNotif(){this.donnees.notification=UtilitaireCasier_1.UtilitaireCasier.getNotificationParDefaut();} getTexteFenetreChoixDestinataires(aType){switch(aType){case TypeCasier_1.TypeGenreDestinataireCollecte.gdcEleve:return{titre:ObjetTraduction_1.GTraductions.getValeur('Casier.titreFenetreSelectionCollecte'),texteExplicatif:ObjetTraduction_1.GTraductions.getValeur('Casier.texteExplicatifEleve'),btnTotalIndividu:ObjetTraduction_1.GTraductions.getValeur('Casier.btnTotalFenetreSelectionCollecte')};case TypeCasier_1.TypeGenreDestinataireCollecte.gdcEleveResp:return{titre:ObjetTraduction_1.GTraductions.getValeur('Casier.titreFenetreSelectionCollecte'),texteExplicatif:ObjetTraduction_1.GTraductions.getValeur('Casier.texteExplicatifRespEleve'),btnTotalIndividu:ObjetTraduction_1.GTraductions.getValeur('Casier.btnTotalFenetreSelectionCollecte')};case TypeCasier_1.TypeGenreDestinataireCollecte.gdcResponsable:return{titre:ObjetTraduction_1.GTraductions.getValeur('Casier.titreFenetreSelectionCollecte'),texteExplicatif:ObjetTraduction_1.GTraductions.getValeur('Casier.texteExplicatifResp'),btnTotalIndividu:ObjetTraduction_1.GTraductions.getValeur('Casier.btnTotalFenetreSelectionCollecte')};default:;return null;}} async ouvrirFenetreChoixDestinataires(){var _a;const lFenetre=ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(ObjetFenetre_ChoixDestinatairesParCriteres_1.ObjetFenetre_ChoixDestinatairesParCriteres,{pere:this,initialiser:(aInstanceFenetre) =>{const lTexte=this.getTexteFenetreChoixDestinataires(this.donnees.genreDestinataireCollecte);if(lTexte){aInstanceFenetre.setOptionsFenetre({titre:lTexte.titre});aInstanceFenetre.setTextePersonnalisable({choixCritereDisponibilite:lTexte.texteExplicatif,libelleBoutonTotalIndividu:lTexte.btnTotalIndividu});}}});lFenetre.setOptionsDestinatairesParCriteres({avecDestinataireObligatoire:true,forcerSansFiltreSurEleve:true,avecLibelleEnfantsDansTotalIndiv:this.donnees.genreDestinataireCollecte===TypeCasier_1.TypeGenreDestinataireCollecte.gdcResponsable});const lParams={genreRessource:this.genreRessourceSelection,choix:this.donnees.destinataires.typeChoixTelechargement,genreDocumentTelechargeable:ChoixDestinatairesParCriteres_1.TypeGenreDocumentTelechargeable.TDT_NatureDocument,criteresDisponibles:this.criteres.get((0,ChoixDestinatairesParCriteres_1.genreRessourceToTypeGenreDestinataire)(this.genreRessourceSelection))};if(this.donnees.destinataires.listeCriteres){const lCriteres=new Map();if(this.donnees.destinataires.listeGenresIndivAssocieAuCriteres.length>1){return;}(_a=this.donnees.destinataires.listeCriteres)===null||_a===void 0?void 0:_a.forEach(aCritere =>{var _a,_b;if(aCritere.genreIndivAssocieAuCriteres!==(0,ChoixDestinatairesParCriteres_1.genreRessourceToTypeGenreDestinataire)(this.genreRessourceSelection)){return;} const lListe=(_a=aCritere.listeElements)!==null&&_a!==void 0?_a:new ObjetListeElements_1.ObjetListeElements();lCriteres.set(aCritere.genre,{liste:lListe,value:(_b=aCritere.value)!==null&&_b!==void 0?_b:true,genreIndivAssocieAuCriteres:aCritere.genreIndivAssocieAuCriteres});});lParams.criteres=lCriteres;} if(this.donnees.destinataires.listeDestinataires){lParams.listeRessourceSelectionnee=this.donnees.destinataires.listeDestinataires;} const lRes=await(lFenetre===null||lFenetre===void 0?void 0:lFenetre.setDonnees(lParams));if(lRes.numeroBouton===1){this.donnees.destinataires.typeChoixTelechargement=lRes.choix;let lListeDestinataires=new ObjetListeElements_1.ObjetListeElements();let lListeCriteres=[];switch(true){case ObjetFenetre_ChoixDestinatairesParCriteres_1.ObjetFenetre_ChoixDestinatairesParCriteres.isResolveNominativement(lRes):lListeDestinataires=lRes.listeRessourceSelectionnee;break;case ObjetFenetre_ChoixDestinatairesParCriteres_1.ObjetFenetre_ChoixDestinatairesParCriteres.isResolveCriteres(lRes):lListeCriteres=Array.from(lRes.criteres).map(([aGenre,aInfos]) =>{return{listeElements:aInfos.liste,genre:aGenre,value:aInfos.value,genreIndivAssocieAuCriteres:aInfos.genreIndivAssocieAuCriteres};});break;} this.donnees.destinataires.listeDestinataires=lListeDestinataires;this.donnees.destinataires.listeCriteres=lListeCriteres;}} verificationChamps(){const lChamp=UtilitaireCasier_1.UtilitaireCasier.verifierChampDestinataire(this.donnees.destinataires);if(!lChamp.valide){return{valide:lChamp.valide,message:ChoixDestinatairesParCriteres_1.TradChoixDestinatairesParCriteres.ChoisirDestinataires};} if(this.donnees.getLibelle().trim().length<=0){return{valide:false,message:ObjetTraduction_1.GTraductions.getValeur('Casier.saisirUnNom')};} if(this.genreDepot===UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.DepotAvecDate){if(!this.getInstance(this.identDateDepot).getDate()){return{valide:false,message:ObjetTraduction_1.GTraductions.getValeur('Casier.choisirUneDate')};}} return{valide:true};} async surValidation(ANumeroBouton){var _a;if(ANumeroBouton===1){const lVerif=this.verificationChamps();if(!lVerif.valide){this.applicationSco.getMessage().afficher({message:(_a=lVerif.message)!==null&&_a!==void 0?_a:''});return;}} super.surValidation(ANumeroBouton);} addParametresValidation(aParams){if(aParams.numeroBouton!==1){return;} this.donnees.sansDateLimite=this.genreDepot===UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.DepotSansDate;this.donnees.sansDepotEspace=this.genreDepot===UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.SansDepot;if(this.genreDepot===UtilitaireCasier_1.UtilitaireCasier.GenreDepotCollecte.DepotAvecDate){this.donnees.dateEcheance=this.dateDepot;} return{collecte:this.donnees};}} exports.ObjetFenetre_SaisieCollecte=ObjetFenetre_SaisieCollecte;class ObjetFenetre_NotificationCollecte extends ObjetFenetre_1.ObjetFenetre{constructor(...aParams){super(...aParams);this.avecDonnees=false;this.idText=this.Nom+'_Text';this.nbrMinRelance=1;this.nbrMaxRelance=1;this.setOptionsFenetre({listeBoutons:[ObjetTraduction_1.GTraductions.getValeur('Annuler'),ObjetTraduction_1.GTraductions.getValeur('Valider')],largeur:600,titre:ObjetTraduction_1.GTraductions.getValeur('Casier.modalitesNotif'),addParametresValidation:this.addParametresValidation.bind(this),afficheRelance:false});} construireInstances(){this.identDate=this.add(ObjetCelluleDate_1.ObjetCelluleDate,(aDate) =>{this.dateNotif=aDate;});} setMinMaxNotif(aDateDepotCollecte){this.nbrMinRelance=1;if(!aDateDepotCollecte){this.nbrMaxRelance=1;return;} const lNbrMaxRelance=Math.min(99,Math.max(ObjetDate_1.GDate.getNbrJoursEntreDeuxDates(this.dateNotif,aDateDepotCollecte)-1,0));this.nbrMaxRelance=lNbrMaxRelance;} async setDonnees(aParams){var _a,_b,_c;this._paramsDuplique=aParams;this.avecDonnees=true;this.avecNotif=(_a=aParams.avecNotif)!==null&&_a!==void 0?_a:false;this.dateNotif=(_b=aParams.dateNotif)!==null&&_b!==void 0?_b:ObjetDate_1.GDate.aujourdhui;this.avecRelance=(_c=aParams.avecRelance)!==null&&_c!==void 0?_c:false;this.genreRessource=aParams.genreRessource;this.setMinMaxNotif(aParams.dateDepot);this.nbrJourRelance=aParams.nbrJourRelance>=0?aParams.nbrJourRelance.toString():this.nbrMinRelance.toString();const lResult=this.afficher(this.composeContenu());this.init();return await lResult;} init(){const lInstanceDate=this.getInstance(this.identDate);lInstanceDate.initialiser();if(ObjetDate_1.GDate.estDateJourAvant(this.dateNotif,ObjetDate_1.GDate.premiereDate)){lInstanceDate.setParametresFenetre(null,this.dateNotif);} lInstanceDate.setDonnees(this.dateNotif);} addParametresValidation(aParams){if(aParams.numeroBouton!==1){return;} return{avecNotif:this.avecNotif,dateNotif:this.dateNotif,avecRelance:this.avecRelance,nbrJourRelance:parseInt(this.nbrJourRelance)};} composeContenu(){if(!this.avecDonnees){return'';} const lCols=[Divers_css_1.StylesDivers.flexContain,Divers_css_1.StylesDivers.flexCols];const lLibelleEspace=UtilitaireCasier_1.UtilitaireCasier.getLibelleEspace(this.genreRessource);const lFlex=[Divers_css_1.StylesDivers.flexResponsive];return(IE.jsx.str("div",{class:[...lCols,Divers_css_1.StylesDivers.flexGapXl]},IE.jsx.str("div",{class:[...lCols,Divers_css_1.StylesDivers.flexGapL]},IE.jsx.str("p",null,ObjetTraduction_1.GTraductions.getValeur('Casier.notifDescription1',[lLibelleEspace]))),IE.jsx.str("div",{class:lFlex},IE.jsx.str("ie-checkbox",{"ie-model":this.jsxModeleCheckboxNotif.bind(this)},ObjetTraduction_1.GTraductions.getValeur('Casier.notifActiveePourLe')," :"),IE.jsx.str("div",{class:[Divers_css_1.StylesDivers.dateNotif]},IE.jsx.str("div",{id:this.getNomInstance(this.identDate)}))),this.optionsFenetre.afficheRelance&&(IE.jsx.str("div",{class:[...lCols]},IE.jsx.str("div",{class:[...lFlex,!IE.estMobile&&Divers_css_1.StylesDivers.mLeftBig]},IE.jsx.str("ie-checkbox",{"ie-model":this.jsxModeleCheckboxRelanceNotif.bind(this)},ObjetTraduction_1.GTraductions.getValeur('Casier.notifRelance')," :"),IE.jsx.str("div",{class:[Divers_css_1.StylesDivers.flexContain,Divers_css_1.StylesDivers.flexGap,Divers_css_1.StylesDivers.flexCenter,IE.estMobile&&Divers_css_1.StylesDivers.justifyBetween,IE.estMobile&&Divers_css_1.StylesDivers.rowReverse]},IE.jsx.str("input",{type:"text","aria-label":ObjetTraduction_1.GTraductions.getValeur('Casier.WAI.SelecJour'),"ie-model":this.jsxModelRelance.bind(this),"ie-mask":`/[^0-9 ]/g`,inputMode:"numeric"
,style:{width:'3rem'},"aria-describedby":this.idText}),IE.jsx.str("p",{class:[IE.estMobile&&Divers_css_1.StylesDivers.tailleM],"ie-class":this.jsxGetClassRelance.bind(this,true),"ie-attr":this.jsxFuncAttrTextRelance.bind(this)},IE.estMobile?ObjetTraduction_1.GTraductions.getValeur('Casier.nombreJoursAvantDepot'):ObjetTraduction_1.GTraductions.getValeur('Casier.joursAvantDepot')))),IE.jsx.str("p",{id:this.idText,class:[!IE.estMobile&&Divers_css_1.StylesDivers.mLeftBig,'m-y-l'],"ie-class":this.jsxGetClassRelance.bind(this,false),"ie-attr":this.jsxFuncAttrTextRelance.bind(this)},ObjetTraduction_1.GTraductions.getValeur('Casier.minMaxInput',[this.nbrMinRelance,this.nbrMaxRelance]))))));} async surValidation(ANumeroBouton){if(ANumeroBouton===1){if(this.avecRelance){const lNbrJourRelance=parseInt(this.nbrJourRelance);const lEstValide=MethodesObjet_1.MethodesObjet.isNumber(lNbrJourRelance)&&lNbrJourRelance>=this.nbrMinRelance&&lNbrJourRelance<=this.nbrMaxRelance;if(!lEstValide){(0,AccessApp_1.getApp)().getMessage().afficher({message:ObjetTraduction_1.GTraductions.getValeur('Casier.messageErreurRelance',[this.nbrMinRelance,this.nbrMaxRelance])});return;}} const lAvecModifNotif=(this._paramsDuplique.avecNotif!==this.avecNotif)||(ObjetDate_1.GDate.estJourEgal(this._paramsDuplique.dateNotif,this.dateNotif));const lAvecMessageValidation=this.avecNotif&&ObjetDate_1.GDate.estJourCourant(this.dateNotif)&&lAvecModifNotif;if(lAvecMessageValidation){const lReponse=await(0,AccessApp_1.getApp)().getMessage().afficher({message:ObjetTraduction_1.GTraductions.getValeur('Casier.envoiDirectNotif',[UtilitaireCasier_1.UtilitaireCasier.getLibelleEspace(this.genreRessource)]),type:Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation});if(lReponse!==Enumere_Action_1.EGenreAction.Valider){return;}}} super.surValidation(ANumeroBouton);} jsxModelRelance(){return{getValue:() =>{return this.nbrJourRelance.toString();},setValue:(aValue) =>{this.nbrJourRelance=aValue;const lVal=parseInt(aValue);if(MethodesObjet_1.MethodesObjet.isNumber(lVal)){if(lVal<this.nbrMinRelance){this.nbrJourRelance=this.nbrMinRelance.toString();} else if(lVal>this.nbrMaxRelance){this.nbrJourRelance=this.nbrMaxRelance.toString();}}},getDisabled:() =>{return this.getDisabledRelance();}};} jsxGetClassRelance(aAvecNoir=true){return this.getDisabledRelance()?Casier_module_css_1.StylesCasier.colorDisabled:(aAvecNoir?Couleurs_css_1.StylesCouleurs.Noir:'');} jsxFuncAttrTextRelance(){return{ariaDisabled:this.getDisabledRelance()};} jsxModeleCheckboxNotif(){return{getValue:() =>{var _a;return(_a=this.avecNotif)!==null&&_a!==void 0?_a:false;},setValue:(aValue) =>{this.avecNotif=aValue;},getDisabled:() =>{return false;}};} jsxModeleCheckboxRelanceNotif(){return{getValue:() =>{var _a;return(_a=this.avecRelance)!==null&&_a!==void 0?_a:false;},setValue:(aValue) =>{this.avecRelance=aValue;},getDisabled:() =>{return this.getDisabledRelance();}};} getDisabledRelance(){return!this.avecNotif||this.nbrMaxRelance<=0;}}